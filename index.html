<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…· - å®Œæ•´ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --info-color: #4895ef;
            --warning-color: #f72585;
            --github-color: #24292e;
            --light-color: #f8f9fa;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease-out;
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 40px;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 0.6s ease-out;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 25px 30px;
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite linear;
        }

        .card-header h2 {
            font-size: 1.6rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .card-body {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(67, 97, 238, 0.1);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title .badge {
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: var(--transition);
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            transform: translateY(-1px);
        }

        textarea {
            min-height: 150px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
            line-height: 1.5;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            color: white;
        }

        .btn-github {
            background: linear-gradient(135deg, var(--github-color) 0%, #2d333b 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #b5179e 100%);
            color: white;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* ä¿®å¤æ–‡ä»¶ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .file-upload-container {
            margin-bottom: 20px;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #fafbff;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 180px;
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: #e8edff;
        }

        .file-upload-area .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .file-upload-area p {
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 1.1rem;
        }

        .file-upload-area small {
            color: #718096;
            font-size: 13px;
        }

        #fileInput {
            display: none;
        }

        /* ä¿®å¤æ–‡ä»¶ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #e8f4fd 0%, #d1e9ff 100%);
            border-radius: 8px;
            border: 1px solid #b6e0fe;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .file-info.show {
            display: block;
        }

        .file-info-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info-text {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-name {
            font-weight: 600;
            color: #2d3748;
        }

        .file-size {
            font-size: 13px;
            color: #718096;
        }

        /* ä¿®å¤ç§»é™¤æ–‡ä»¶æŒ‰é’®æ ·å¼ */
        .remove-file-btn {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #c53030;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .remove-file-btn:hover {
            background: linear-gradient(135deg, #feb2b2 0%, #fc8181 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(252, 129, 129, 0.3);
        }

        .github-config {
            background: linear-gradient(135deg, #f6f8fa 0%, #f0f4f8 100%);
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #e1e4e8;
        }

        .github-config h4 {
            color: #24292e;
            margin-bottom: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .result-header h3 {
            color: #2d3748;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .result-content {
            max-height: 350px;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            color: #4a5568;
        }

        .result-content.empty {
            color: #a0aec0;
            font-style: italic;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s ease-out;
            border-left: 4px solid transparent;
        }

        .status-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-left-color: #28a745;
            display: block;
        }

        .status-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-left-color: #dc3545;
            display: block;
        }

        .status-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border-left-color: #17a2b8;
            display: block;
        }

        .status-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-left-color: #ffc107;
            display: block;
        }

        .help-text {
            font-size: 13px;
            color: #718096;
            margin-top: 6px;
            line-height: 1.4;
        }

        .config-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .github-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .github-buttons {
                grid-template-columns: 1fr;
            }
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 50px;
            padding: 20px;
            font-size: 14px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .source-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }

        .github-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .main-grid {
                gap: 30px;
            }
            
            .card-body {
                padding: 20px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
        }

        .workflow-steps {
            margin-top: 20px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .step-number {
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .step-desc {
            font-size: 13px;
            color: #718096;
            line-height: 1.4;
        }

        .token-info {
            background: linear-gradient(135deg, #e8f4fd 0%, #d1e9ff 100%);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #b6e0fe;
            font-size: 12px;
            color: #2c5282;
        }

        .token-info a {
            color: #2b6cb0;
            text-decoration: none;
        }

        .token-info a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…· - å®Œæ•´ç‰ˆ</h1>
            <p>ç”ŸæˆVlessèŠ‚ç‚¹ + GitHubè®¢é˜…æ–‡ä»¶è‡ªåŠ¨åŒæ­¥ï¼Œå…¨æµç¨‹ä¸€é”®æ‰§è¡Œ</p>
        </header>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šæ•°æ®è¾“å…¥å’Œé…ç½® -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“</span>
                        CSVæ•°æ®æº
                        <span id="sourceBadge" class="source-badge">æœªé€‰æ‹©</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="section">
                        <div class="section-title">
                            <span>ğŸ“¤ ä¸Šä¼ CSVæ–‡ä»¶</span>
                            <span class="badge">ä¼˜å…ˆä½¿ç”¨</span>
                        </div>
                        
                        <div class="file-upload-container">
                            <div class="file-upload-area" id="dropArea">
                                <div class="upload-icon">ğŸ“</div>
                                <p><strong>æ‹–æ”¾CSVæ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©</strong></p>
                                <small>æ”¯æŒ.csvæˆ–.txtæ–‡ä»¶æ ¼å¼</small>
                                <input type="file" id="fileInput" accept=".csv,.txt">
                            </div>
                            
                            <div id="fileInfo" class="file-info">
                                <div class="file-info-content">
                                    <div class="file-info-text">
                                        <span id="fileName" class="file-name"></span>
                                        <span id="fileSize" class="file-size"></span>
                                    </div>
                                    <button type="button" id="removeFileBtn" class="remove-file-btn">
                                        <span>ğŸ—‘ï¸</span> ç§»é™¤æ–‡ä»¶
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="help-text">
                            <strong>âš ï¸ æ³¨æ„ï¼š</strong>ä¸Šä¼ CSVæ–‡ä»¶åï¼Œç³»ç»Ÿå°†ä¼˜å…ˆä»æ–‡ä»¶çš„Aåˆ—(ç¬¬1åˆ—)æå–IPï¼ŒHåˆ—(ç¬¬8åˆ—)æå–ç«¯å£
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ğŸ“ æˆ–ç²˜è´´CSVå†…å®¹</span>
                            <span class="badge">å¤‡ç”¨é€‰é¡¹</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="csvInput">CSVæ•°æ®å†…å®¹ï¼š</label>
                            <textarea id="csvInput" placeholder="æ¯è¡Œä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š
â€¢ IP,ç«¯å£ï¼ˆé€—å·åˆ†éš”ï¼‰
â€¢ IP:ç«¯å£ï¼ˆå†’å·åˆ†éš”ï¼‰
â€¢ IP ç«¯å£ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
â€¢ åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰

ç¤ºä¾‹ï¼š
8.209.202.241,443
104.238.162.245:8080
45.76.123.234 8443
108.61.123.45"></textarea>
                            <div class="help-text">
                                âš ï¸ å½“ä¸Šä¼ äº†CSVæ–‡ä»¶æ—¶ï¼Œæ­¤å¤„çš„ç²˜è´´å†…å®¹å°†è¢«å¿½ç•¥ï¼Œä¼˜å…ˆä½¿ç”¨æ–‡ä»¶æ•°æ®
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>âš™ï¸ èŠ‚ç‚¹é…ç½®</span>
                        </div>
                        
                        <div class="config-row">
                            <div class="form-group">
                                <label for="defaultPort">é»˜è®¤ç«¯å£</label>
                                <input type="number" id="defaultPort" value="443" min="1" max="65535">
                                <div class="help-text">å½“CSVä¸­æœªæä¾›ç«¯å£æ—¶ä½¿ç”¨</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="remarksPrefix">åˆ«åå‰ç¼€</label>
                                <input type="text" id="remarksPrefix" value="è‡ªé€‰" placeholder="å¦‚ï¼šè‡ªé€‰">
                                <div class="help-text">å¤‡ç”¨åˆ«åå‰ç¼€ï¼ˆå½“IPå±åœ°æ— æ³•è¯†åˆ«æ—¶ä½¿ç”¨ï¼‰</div>
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="forcePort443">
                            <label for="forcePort443"><strong>å¼ºåˆ¶ä½¿ç”¨443ç«¯å£</strong></label>
                        </div>
                        <div class="help-text">
                            âœ“ å¯ç”¨ï¼šæ‰€æœ‰èŠ‚ç‚¹ç»Ÿä¸€ä½¿ç”¨443ç«¯å£ï¼Œå¿½ç•¥CSVä¸­çš„ç«¯å£ä¿¡æ¯<br>
                            â–¡ ç¦ç”¨ï¼šä½¿ç”¨CSVä¸­çš„ç«¯å£ï¼Œä»…å½“CSVæ— ç«¯å£æ—¶ä½¿ç”¨é»˜è®¤ç«¯å£
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="autoLocation" checked>
                            <label for="autoLocation"><strong>è‡ªåŠ¨è¯†åˆ«IPå±åœ°</strong></label>
                        </div>
                        <div class="help-text">
                            âœ“ å¯ç”¨ï¼šè‡ªåŠ¨è¯†åˆ«IPæ‰€å±åœ°åŒºï¼Œç”Ÿæˆå¦‚"æ–°åŠ å¡01"ã€"ç¾å›½02"ç­‰åˆ«å
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ğŸš€ ç”Ÿæˆæ“ä½œ</span>
                        </div>
                        
                        <button id="generateBtn" class="btn btn-primary btn-block">
                            <span>âš¡</span> ç”ŸæˆVlessèŠ‚ç‚¹
                        </button>
                        
                        <div class="loading" id="loading">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                        </div>
                        
                        <div id="status" class="status-message"></div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>âš™ï¸ é«˜çº§é…ç½®</span>
                        </div>
                        
                        <div class="config-row">
                            <div class="form-group">
                                <label for="uuid">ç”¨æˆ·ID (UUID)</label>
                                <input type="text" id="uuid" value="471a8e64-7b21-4703-b1d1-45a221098459">
                            </div>
                            
                            <div class="form-group">
                                <label for="host">ä¼ªè£…åŸŸå</label>
                                <input type="text" id="host" value="knny.dpdns.org">
                            </div>
                            
                            <div class="form-group">
                                <label for="sni">SNIåŸŸå</label>
                                <input type="text" id="sni" value="knny.dpdns.org">
                            </div>
                            
                            <div class="form-group">
                                <label for="fp">æµè§ˆå™¨æŒ‡çº¹</label>
                                <input type="text" id="fp" value="chrome">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“æœè¾“å‡ºå’ŒGitHubåŒæ­¥ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“Š</span>
                        ç”Ÿæˆç»“æœ & GitHubåŒæ­¥
                        <span id="resultCount" class="badge">0èŠ‚ç‚¹</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="section">
                        <div class="result-header">
                            <h3>ğŸ”— VlessèŠ‚ç‚¹é“¾æ¥</h3>
                            <button id="copyVlessBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶å…¨éƒ¨
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="vless-links" class="result-content empty">Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                        
                        <div class="github-stats" id="githubStats" style="display: none;">
                            <div class="stat-item">
                                <span class="stat-label">æœ¬åœ°èŠ‚ç‚¹</span>
                                <span class="stat-value" id="localNodes">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">è¿œç¨‹èŠ‚ç‚¹</span>
                                <span class="stat-value" id="remoteNodes">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">åˆå¹¶åèŠ‚ç‚¹</span>
                                <span class="stat-value" id="mergedNodes">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å»é‡åèŠ‚ç‚¹</span>
                                <span class="stat-value" id="uniqueNodes">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ğŸ“¦ å…¶ä»–è¾“å‡ºæ ¼å¼</span>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="showJsonBtn" class="btn btn-info">
                                <span>ğŸ“„</span> JSONé…ç½®
                            </button>
                            <button id="showSubBtn" class="btn btn-primary">
                                <span>ğŸ”—</span> è®¢é˜…é“¾æ¥
                            </button>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ğŸ’¾ ä¸‹è½½ç»“æœ</span>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="downloadVlessBtn" class="btn btn-success">
                                <span>â¬‡ï¸</span> ä¸‹è½½Vlessé“¾æ¥
                            </button>
                            <button id="downloadAllBtn" class="btn btn-info">
                                <span>ğŸ“</span> ä¸‹è½½å…¨éƒ¨æ–‡ä»¶
                            </button>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ğŸ™ GitHubè®¢é˜…åŒæ­¥</span>
                        </div>
                        
                        <div class="github-config">
                            <h4><span>ğŸ”§</span> GitHubé…ç½®</h4>
                            <div class="form-group">
                                <label for="githubToken">GitHubä¸ªäººè®¿é—®ä»¤ç‰Œï¼š</label>
                                <input type="password" id="githubToken" placeholder="è¾“å…¥GitHub Personal Access Token">
                                <div class="help-text">
                                    éœ€è¦repoæƒé™ï¼Œç”¨äºæäº¤æ–‡ä»¶åˆ°GitHubä»“åº“
                                    <a href="https://github.com/settings/tokens" target="_blank">è·å–ä»¤ç‰Œ</a>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="githubRepo">GitHubä»“åº“ï¼š</label>
                                <input type="text" id="githubRepo" value="daizhouhui/CustomNode">
                                <div class="help-text">æ ¼å¼ï¼šç”¨æˆ·å/ä»“åº“å</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="githubBranch">åˆ†æ”¯ï¼š</label>
                                <input type="text" id="githubBranch" value="main">
                            </div>
                            
                            <div class="form-group">
                                <label for="githubFile">è®¢é˜…æ–‡ä»¶è·¯å¾„ï¼š</label>
                                <input type="text" id="githubFile" value="node.txt">
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="saveToken" checked>
                                <label for="saveToken">ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨</label>
                            </div>
                            
                            <div class="token-info">
                                <strong>âš ï¸ å®‰å…¨æç¤ºï¼š</strong>ä»¤ç‰Œå°†ä¿å­˜åˆ°æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä»…ç”¨äºGitHub APIè°ƒç”¨ã€‚
                                å»ºè®®ä½¿ç”¨ä»…å…·æœ‰å¿…è¦æƒé™çš„ä»¤ç‰Œï¼Œå¹¶å®šæœŸæ›´æ–°ã€‚
                            </div>
                        </div>
                        
                        <div class="workflow-steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <div class="step-title">ä¸‹è½½è®¢é˜…æ–‡ä»¶</div>
                                    <div class="step-desc">ä»GitHub Pagesä¸‹è½½ç°æœ‰çš„Base64è®¢é˜…æ–‡ä»¶</div>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <div class="step-title">åˆå¹¶å»é‡</div>
                                    <div class="step-desc">å°†æœ¬åœ°ç”Ÿæˆçš„èŠ‚ç‚¹ä¸è¿œç¨‹èŠ‚ç‚¹åˆå¹¶ï¼Œå»é™¤é‡å¤é¡¹</div>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <div class="step-title">æäº¤æ›´æ–°</div>
                                    <div class="step-desc">å°†æ–°çš„Base64è®¢é˜…æ–‡ä»¶æäº¤å›GitHubä»“åº“</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="github-buttons">
                            <button id="downloadSubBtn" class="btn btn-primary">
                                <span>â¬‡ï¸</span> ä¸‹è½½è®¢é˜…æ–‡ä»¶
                            </button>
                            <button id="mergeBtn" class="btn btn-success">
                                <span>ğŸ”„</span> åˆå¹¶èŠ‚ç‚¹
                            </button>
                            <button id="syncBtn" class="btn btn-github">
                                <span>ğŸš€</span> ä¸€é”®åŒæ­¥
                            </button>
                        </div>
                        
                        <div class="help-text">
                            <strong>ä¸€é”®åŒæ­¥åŠŸèƒ½ï¼š</strong>è‡ªåŠ¨æ‰§è¡Œä¸‹è½½â†’åˆå¹¶â†’æäº¤çš„å®Œæ•´æµç¨‹ï¼Œç”Ÿæˆæ–°çš„è®¢é˜…æ–‡ä»¶å¹¶æ›´æ–°åˆ°GitHub
                        </div>
                    </div>

                    <div class="section" id="jsonSection" style="display: none;">
                        <div class="result-header">
                            <h3>ğŸ“„ JSONé…ç½®</h3>
                            <button id="copyJsonBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="json-output" class="result-content"></div>
                        </div>
                    </div>

                    <div class="section" id="subSection" style="display: none;">
                        <div class="result-header">
                            <h3>ğŸ”— Base64è®¢é˜…é“¾æ¥</h3>
                            <button id="copySubBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="subscription" class="result-content"></div>
                        </div>
                    </div>

                    <div class="section" id="mergedSection" style="display: none;">
                        <div class="result-header">
                            <h3>ğŸ”„ åˆå¹¶ç»“æœ</h3>
                            <button id="copyMergedBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="mergedResult" class="result-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Â© 2023 VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…· | ç”ŸæˆVlessèŠ‚ç‚¹ + GitHubè®¢é˜…æ–‡ä»¶è‡ªåŠ¨åŒæ­¥ï¼Œå…¨æµç¨‹ä¸€é”®æ‰§è¡Œ</p>
            <p>æ”¯æŒGitHubè®¢é˜…æ–‡ä»¶ä¸‹è½½ã€åˆå¹¶ã€å»é‡ã€æäº¤å…¨è‡ªåŠ¨åŒ–æµç¨‹</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let generatedData = {
            vlessLinks: [],
            jsonConfig: [],
            subscription: '',
            nodesCount: 0,
            currentSource: 'none',
            currentFileName: '',
            remoteNodes: [],
            mergedNodes: [],
            uniqueNodes: [],
            githubStats: {
                local: 0,
                remote: 0,
                merged: 0,
                unique: 0
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners();
            
            // åˆå§‹åŒ–æ‹–æ”¾åŠŸèƒ½
            initDragDrop();
            
            // æ›´æ–°UIçŠ¶æ€
            updateSourceBadge();
            updateResultCount();
            
            // åŠ è½½ä¿å­˜çš„GitHubä»¤ç‰Œ
            loadSavedToken();
            
            // é»˜è®¤è®¾ç½®
            document.getElementById('forcePort443').checked = false;
            document.getElementById('autoLocation').checked = true;
            document.getElementById('saveToken').checked = true;
        });

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ–‡ä»¶é€‰æ‹©
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            
            // ç§»é™¤æ–‡ä»¶æŒ‰é’®
            document.getElementById('removeFileBtn').addEventListener('click', removeSelectedFile);
            
            // ç”ŸæˆæŒ‰é’®
            document.getElementById('generateBtn').addEventListener('click', generateVless);
            
            // å¤åˆ¶æŒ‰é’®
            document.getElementById('copyVlessBtn').addEventListener('click', () => copyToClipboard('vless'));
            document.getElementById('copyJsonBtn').addEventListener('click', () => copyToClipboard('json'));
            document.getElementById('copySubBtn').addEventListener('click', () => copyToClipboard('subscription'));
            document.getElementById('copyMergedBtn').addEventListener('click', () => copyToClipboard('merged'));
            
            // æ˜¾ç¤ºå…¶ä»–æ ¼å¼
            document.getElementById('showJsonBtn').addEventListener('click', () => toggleSection('jsonSection'));
            document.getElementById('showSubBtn').addEventListener('click', () => toggleSection('subSection'));
            
            // ä¸‹è½½æŒ‰é’®
            document.getElementById('downloadVlessBtn').addEventListener('click', downloadVlessLinks);
            document.getElementById('downloadAllBtn').addEventListener('click', downloadAll);
            
            // GitHubç›¸å…³æŒ‰é’®
            document.getElementById('downloadSubBtn').addEventListener('click', downloadGitHubSubscription);
            document.getElementById('mergeBtn').addEventListener('click', mergeNodes);
            document.getElementById('syncBtn').addEventListener('click', syncToGitHub);
            
            // é˜²æŠ–è‡ªåŠ¨ç”Ÿæˆ
            let debounceTimer;
            document.getElementById('csvInput').addEventListener('input', function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    if (generatedData.currentSource !== 'file') {
                        generateVless();
                    }
                }, 1000);
            });
            
            // ä¿å­˜ä»¤ç‰Œè®¾ç½®å˜åŒ–
            document.getElementById('saveToken').addEventListener('change', function() {
                if (!this.checked) {
                    // å¦‚æœä¸ä¿å­˜ä»¤ç‰Œï¼Œæ¸…é™¤å·²ä¿å­˜çš„ä»¤ç‰Œ
                    localStorage.removeItem('github_token');
                }
            });
        }

        // åŠ è½½ä¿å­˜çš„GitHubä»¤ç‰Œ
        function loadSavedToken() {
            const savedToken = localStorage.getItem('github_token');
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                showStatus('å·²åŠ è½½ä¿å­˜çš„GitHubä»¤ç‰Œ', 'info');
            }
        }

        // ä¿å­˜GitHubä»¤ç‰Œ
        function saveGitHubToken(token) {
            if (document.getElementById('saveToken').checked) {
                localStorage.setItem('github_token', token);
                showStatus('GitHubä»¤ç‰Œå·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨', 'success');
            }
        }

        // åˆå§‹åŒ–æ‹–æ”¾åŠŸèƒ½
        function initDragDrop() {
            const dropArea = document.getElementById('dropArea');
            
            // é˜²æ­¢é»˜è®¤æ‹–æ”¾è¡Œä¸º
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            // é«˜äº®æ‹–æ”¾åŒºåŸŸ
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            // å¤„ç†æ–‡ä»¶æ”¾ç½®
            dropArea.addEventListener('drop', handleDrop, false);
            
            // ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
            dropArea.addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                dropArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }
        }

        // å¤„ç†æ–‡ä»¶
        function handleFile(file) {
            if (!file.name.match(/\.(csv|txt)$/i)) {
                showStatus('é”™è¯¯: è¯·é€‰æ‹©CSVæˆ–TXTæ–‡ä»¶ï¼', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // ä¿å­˜æ–‡ä»¶ä¿¡æ¯
                generatedData.currentSource = 'file';
                generatedData.currentFileName = file.name;
                
                // æ›´æ–°UI
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatFileSize(file.size);
                document.getElementById('fileInfo').classList.add('show');
                
                // æ¸…ç©ºè¾“å…¥æ¡†å¹¶ç¦ç”¨ï¼ˆé¿å…æ··æ·†ï¼‰
                document.getElementById('csvInput').value = '';
                document.getElementById('csvInput').placeholder = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name}\næ–‡ä»¶å†…å®¹å·²åŠ è½½ï¼Œä¼˜å…ˆä½¿ç”¨æ–‡ä»¶æ•°æ®ã€‚`;
                
                // æ›´æ–°æºæ ‡ç­¾
                updateSourceBadge();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showStatus(`å·²åŠ è½½æ–‡ä»¶: ${file.name}ï¼Œå°†ä»Aåˆ—æå–IPï¼ŒHåˆ—æå–ç«¯å£`, 'success');
                
                // è‡ªåŠ¨ç”Ÿæˆ
                setTimeout(() => {
                    generateVless();
                }, 500);
            };
            
            reader.onerror = function() {
                showStatus('é”™è¯¯: è¯»å–æ–‡ä»¶å¤±è´¥ï¼', 'error');
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        // ç§»é™¤é€‰æ‹©çš„æ–‡ä»¶
        function removeSelectedFile() {
            generatedData.currentSource = 'none';
            generatedData.currentFileName = '';
            
            // æ›´æ–°UI
            document.getElementById('fileInfo').classList.remove('show');
            document.getElementById('fileInput').value = '';
            document.getElementById('csvInput').placeholder = 'æ¯è¡Œä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š\nâ€¢ IP,ç«¯å£ï¼ˆé€—å·åˆ†éš”ï¼‰\nâ€¢ IP:ç«¯å£ï¼ˆå†’å·åˆ†éš”ï¼‰\nâ€¢ IP ç«¯å£ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰\nâ€¢ åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰';
            
            // æ›´æ–°æºæ ‡ç­¾
            updateSourceBadge();
            
            showStatus('å·²ç§»é™¤æ–‡ä»¶ï¼Œå°†ä½¿ç”¨ç²˜è´´çš„CSVå†…å®¹', 'info');
        }

        // æ›´æ–°æºæ ‡ç­¾
        function updateSourceBadge() {
            const badge = document.getElementById('sourceBadge');
            
            switch(generatedData.currentSource) {
                case 'file':
                    badge.textContent = `æ–‡ä»¶: ${generatedData.currentFileName}`;
                    badge.style.background = 'linear-gradient(135deg, #4cc9f0, #4895ef)';
                    break;
                case 'paste':
                    badge.textContent = 'ç²˜è´´å†…å®¹';
                    badge.style.background = 'linear-gradient(135deg, #7209b7, #3a0ca3)';
                    break;
                default:
                    badge.textContent = 'æœªé€‰æ‹©';
                    badge.style.background = 'linear-gradient(135deg, #a0aec0, #718096)';
            }
        }

        // æ›´æ–°ç»“æœè®¡æ•°
        function updateResultCount() {
            const count = generatedData.nodesCount;
            document.getElementById('resultCount').textContent = `${count}èŠ‚ç‚¹`;
        }

        // æ›´æ–°GitHubç»Ÿè®¡
        function updateGitHubStats() {
            const statsEl = document.getElementById('githubStats');
            if (generatedData.githubStats.local > 0 || generatedData.githubStats.remote > 0) {
                statsEl.style.display = 'flex';
                document.getElementById('localNodes').textContent = generatedData.githubStats.local;
                document.getElementById('remoteNodes').textContent = generatedData.githubStats.remote;
                document.getElementById('mergedNodes').textContent = generatedData.githubStats.merged;
                document.getElementById('uniqueNodes').textContent = generatedData.githubStats.unique;
            } else {
                statsEl.style.display = 'none';
            }
        }

        // ç”ŸæˆVlessèŠ‚ç‚¹
        async function generateVless() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showLoading(true);
                
                // è·å–é…ç½®
                const config = getConfig();
                
                // éªŒè¯UUID
                if (!isValidUUID(config.uuid)) {
                    showStatus('é”™è¯¯: UUIDæ ¼å¼ä¸æ­£ç¡®ï¼', 'error');
                    showLoading(false);
                    return;
                }
                
                // æ ¹æ®å½“å‰æºè·å–æ•°æ®
                let csvData = '';
                
                if (generatedData.currentSource === 'file') {
                    // ä»æ–‡ä»¶è·å–æ•°æ®
                    const fileInput = document.getElementById('fileInput');
                    if (fileInput.files.length === 0) {
                        showStatus('é”™è¯¯: æ–‡ä»¶æœªé€‰æ‹©ï¼', 'error');
                        showLoading(false);
                        return;
                    }
                    
                    csvData = await readFileAsText(fileInput.files[0]);
                    generatedData.currentSource = 'file';
                } else {
                    // ä»è¾“å…¥æ¡†è·å–æ•°æ®
                    csvData = document.getElementById('csvInput').value.trim();
                    if (!csvData) {
                        showStatus('é”™è¯¯: è¯·è¾“å…¥CSVæ•°æ®æˆ–é€‰æ‹©CSVæ–‡ä»¶', 'error');
                        showLoading(false);
                        return;
                    }
                    generatedData.currentSource = 'paste';
                }
                
                // æ›´æ–°æºæ ‡ç­¾
                updateSourceBadge();
                
                // å¤„ç†CSVæ•°æ®
                if (generatedData.currentSource === 'file') {
                    // æ–‡ä»¶æ¨¡å¼ï¼šä»Aåˆ—(0)å’ŒHåˆ—(7)æå–
                    processCSVFromFile(csvData, config);
                } else {
                    // ç²˜è´´æ¨¡å¼ï¼šæ”¯æŒå¤šç§åˆ†éš”ç¬¦
                    processCSVFromText(csvData, config);
                }
                
            } catch (error) {
                showStatus('é”™è¯¯: ' + error.message, 'error');
                console.error(error);
                showLoading(false);
            }
        }

        // è¯»å–æ–‡ä»¶ä¸ºæ–‡æœ¬
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                reader.readAsText(file, 'UTF-8');
            });
        }

        // è·å–é…ç½®
        function getConfig() {
            return {
                uuid: document.getElementById('uuid').value.trim(),
                host: document.getElementById('host').value.trim(),
                sni: document.getElementById('sni').value.trim(),
                fp: document.getElementById('fp').value.trim(),
                forcePort443: document.getElementById('forcePort443').checked,
                autoLocation: document.getElementById('autoLocation').checked,
                defaultPort: parseInt(document.getElementById('defaultPort').value) || 443,
                remarksPrefix: document.getElementById('remarksPrefix').value.trim() || 'è‡ªé€‰'
            };
        }

        // å¤„ç†æ¥è‡ªæ–‡ä»¶çš„CSVæ•°æ®
        function processCSVFromFile(csvData, config) {
            try {
                // æ¸…ç©ºæ•°æ®
                generatedData.vlessLinks = [];
                generatedData.jsonConfig = [];
                generatedData.locationStats = {};
                
                // è§£æCSVè¡Œ
                const lines = csvData.split(/\r?\n/);
                let nodesCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line || line.startsWith('#')) continue;
                    
                    // è§£æCSVè¡Œï¼ˆæ”¯æŒé€—å·åˆ†éš”å’Œå¼•å·ï¼‰
                    const columns = parseCSVLine(line);
                    
                    // ä»Aåˆ—(ç´¢å¼•0)è·å–IP
                    let ip = columns[0] || '';
                    
                    // éªŒè¯IP
                    if (!isValidIP(ip)) {
                        // å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„IPï¼Œå°è¯•æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åˆ—åŒ…å«IP
                        for (let j = 0; j < columns.length; j++) {
                            if (isValidIP(columns[j])) {
                                ip = columns[j];
                                break;
                            }
                        }
                        
                        if (!isValidIP(ip)) {
                            console.warn(`è·³è¿‡æ— æ•ˆçš„IP: ${ip} (è¡Œ ${i+1})`);
                            continue;
                        }
                    }
                    
                    // ä»Håˆ—(ç´¢å¼•7)è·å–ç«¯å£
                    let port = config.defaultPort;
                    if (!config.forcePort443 && columns.length > 7) {
                        const portStr = columns[7];
                        if (portStr && !isNaN(portStr) && parseInt(portStr) >= 1 && parseInt(portStr) <= 65535) {
                            port = parseInt(portStr);
                        }
                    }
                    
                    // å¦‚æœå¼ºåˆ¶443ç«¯å£
                    if (config.forcePort443) {
                        port = 443;
                    }
                    
                    // è·å–åœ°åŒºä¿¡æ¯
                    let location = 'æœªçŸ¥';
                    if (config.autoLocation) {
                        location = getIPLocation(ip);
                    }
                    
                    // ç”ŸæˆèŠ‚ç‚¹åˆ«å
                    const nodeIndex = nodesCount + 1;
                    let remarks = '';
                    
                    if (config.autoLocation && location !== 'æœªçŸ¥') {
                        // ä½¿ç”¨åœ°åŒº+ç¼–å·
                        if (!generatedData.locationStats[location]) {
                            generatedData.locationStats[location] = 1;
                        } else {
                            generatedData.locationStats[location]++;
                        }
                        const locationCount = generatedData.locationStats[location];
                        remarks = `${location}${locationCount.toString().padStart(2, '0')}`;
                    } else {
                        // ä½¿ç”¨å¤‡ç”¨å‰ç¼€+ç¼–å·
                        remarks = `${config.remarksPrefix}${nodeIndex.toString().padStart(2, '0')}`;
                    }
                    
                    // ç”ŸæˆVlessé“¾æ¥
                    const vlessLink = generateVlessLink(ip, port, config, remarks);
                    generatedData.vlessLinks.push(vlessLink);
                    
                    // ç”ŸæˆJSONé…ç½®
                    const jsonNode = generateJsonConfig(ip, port, config, remarks);
                    generatedData.jsonConfig.push(jsonNode);
                    
                    nodesCount++;
                }
                
                if (nodesCount === 0) {
                    showStatus('é”™è¯¯: æœªæ‰¾åˆ°æœ‰æ•ˆçš„IPåœ°å€ï¼è¯·æ£€æŸ¥CSVæ–‡ä»¶æ ¼å¼', 'error');
                    showLoading(false);
                    return;
                }
                
                // æ›´æ–°æ•°æ®
                generatedData.nodesCount = nodesCount;
                generatedData.githubStats.local = nodesCount;
                
                // æ˜¾ç¤ºç»“æœ
                displayResults();
                
                // ç”Ÿæˆè®¢é˜…
                generateSubscription();
                
                // æ›´æ–°UI
                updateResultCount();
                updateGitHubStats();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const sourceText = generatedData.currentSource === 'file' ? 'CSVæ–‡ä»¶' : 'ç²˜è´´å†…å®¹';
                const locationText = config.autoLocation ? 'ï¼ˆå·²è‡ªåŠ¨è¯†åˆ«IPå±åœ°ï¼‰' : '';
                showStatus(`âœ… æˆåŠŸä»${sourceText}ç”Ÿæˆ ${nodesCount} ä¸ªVlessèŠ‚ç‚¹${locationText}ï¼`, 'success');
                
            } catch (error) {
                showStatus('è§£æCSVæ•°æ®æ—¶å‡ºé”™: ' + error.message, 'error');
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        // å¤„ç†æ¥è‡ªç²˜è´´æ–‡æœ¬çš„CSVæ•°æ®
        function processCSVFromText(csvData, config) {
            try {
                // æ¸…ç©ºæ•°æ®
                generatedData.vlessLinks = [];
                generatedData.jsonConfig = [];
                generatedData.locationStats = {};
                
                // è§£æè¡Œ
                const lines = csvData.split('\n');
                let nodesCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line || line.startsWith('#')) continue;
                    
                    let ip = '', port = config.defaultPort;
                    
                    // å°è¯•å¤šç§åˆ†éš”ç¬¦
                    if (line.includes(',')) {
                        // é€—å·åˆ†éš”
                        const parts = line.split(',').map(p => p.trim());
                        ip = parts[0];
                        if (parts.length > 1 && !config.forcePort443) {
                            const portNum = parseInt(parts[1]);
                            if (!isNaN(portNum) && portNum >= 1 && portNum <= 65535) {
                                port = portNum;
                            }
                        }
                    } else if (line.includes(':')) {
                        // å†’å·åˆ†éš”
                        const parts = line.split(':').map(p => p.trim());
                        ip = parts[0];
                        if (parts.length > 1 && !config.forcePort443) {
                            const portNum = parseInt(parts[1]);
                            if (!isNaN(portNum) && portNum >= 1 && portNum <= 65535) {
                                port = portNum;
                            }
                        }
                    } else {
                        // ç©ºæ ¼åˆ†éš”æˆ–åªæœ‰IP
                        const parts = line.split(/\s+/).map(p => p.trim());
                        ip = parts[0];
                        if (parts.length > 1 && !config.forcePort443) {
                            const portNum = parseInt(parts[1]);
                            if (!isNaN(portNum) && portNum >= 1 && portNum <= 65535) {
                                port = portNum;
                            }
                        }
                    }
                    
                    // éªŒè¯IP
                    if (!isValidIP(ip)) {
                        console.warn(`è·³è¿‡æ— æ•ˆçš„IP: ${ip} (è¡Œ ${i+1})`);
                        continue;
                    }
                    
                    // å¦‚æœå¼ºåˆ¶443ç«¯å£
                    if (config.forcePort443) {
                        port = 443;
                    }
                    
                    // è·å–åœ°åŒºä¿¡æ¯
                    let location = 'æœªçŸ¥';
                    if (config.autoLocation) {
                        location = getIPLocation(ip);
                    }
                    
                    // ç”ŸæˆèŠ‚ç‚¹åˆ«å
                    const nodeIndex = nodesCount + 1;
                    let remarks = '';
                    
                    if (config.autoLocation && location !== 'æœªçŸ¥') {
                        // ä½¿ç”¨åœ°åŒº+ç¼–å·
                        if (!generatedData.locationStats[location]) {
                            generatedData.locationStats[location] = 1;
                        } else {
                            generatedData.locationStats[location]++;
                        }
                        const locationCount = generatedData.locationStats[location];
                        remarks = `${location}${locationCount.toString().padStart(2, '0')}`;
                    } else {
                        // ä½¿ç”¨å¤‡ç”¨å‰ç¼€+ç¼–å·
                        remarks = `${config.remarksPrefix}${nodeIndex.toString().padStart(2, '0')}`;
                    }
                    
                    // ç”ŸæˆVlessé“¾æ¥
                    const vlessLink = generateVlessLink(ip, port, config, remarks);
                    generatedData.vlessLinks.push(vlessLink);
                    
                    // ç”ŸæˆJSONé…ç½®
                    const jsonNode = generateJsonConfig(ip, port, config, remarks);
                    generatedData.jsonConfig.push(jsonNode);
                    
                    nodesCount++;
                }
                
                if (nodesCount === 0) {
                    showStatus('é”™è¯¯: æœªæ‰¾åˆ°æœ‰æ•ˆçš„IPåœ°å€ï¼', 'error');
                    showLoading(false);
                    return;
                }
                
                // æ›´æ–°æ•°æ®
                generatedData.nodesCount = nodesCount;
                generatedData.githubStats.local = nodesCount;
                
                // æ˜¾ç¤ºç»“æœ
                displayResults();
                
                // ç”Ÿæˆè®¢é˜…
                generateSubscription();
                
                // æ›´æ–°UI
                updateResultCount();
                updateGitHubStats();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const locationText = config.autoLocation ? 'ï¼ˆå·²è‡ªåŠ¨è¯†åˆ«IPå±åœ°ï¼‰' : '';
                showStatus(`âœ… æˆåŠŸä»ç²˜è´´å†…å®¹ç”Ÿæˆ ${nodesCount} ä¸ªVlessèŠ‚ç‚¹${locationText}ï¼`, 'success');
                
            } catch (error) {
                showStatus('è§£æCSVæ•°æ®æ—¶å‡ºé”™: ' + error.message, 'error');
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        // è·å–IPå±åœ°
        function getIPLocation(ip) {
            // å°†IPåœ°å€è½¬æ¢ä¸ºæ•°å­—
            const ipNum = ipToNumber(ip);
            
            // ç®€åŒ–çš„IPå±åœ°æ•°æ®åº“
            const ipLocationDatabase = {
                'æ—¥æœ¬': ['1.0.16.0', '1.0.31.255'],
                'ç¾å›½': ['3.0.0.0', '3.255.255.255'],
                'æ–°åŠ å¡': ['101.100.0.0', '101.103.255.255'],
                'éŸ©å›½': ['1.11.0.0', '1.11.255.255'],
                'é¦™æ¸¯': ['43.243.0.0', '43.255.255.255'],
                'å°æ¹¾': ['59.120.0.0', '59.127.255.255'],
                'å¾·å›½': ['31.0.0.0', '31.255.255.255'],
                'è‹±å›½': ['2.0.0.0', '2.255.255.255'],
                'æ³•å›½': ['2.0.0.0', '2.255.255.255'],
                'æ¾³å¤§åˆ©äºš': ['1.0.0.0', '1.255.255.255'],
                'åŠ æ‹¿å¤§': ['24.0.0.0', '24.255.255.255'],
                'ä¿„ç½—æ–¯': ['2.0.0.0', '2.255.255.255']
            };
            
            // åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾
            for (const [location, range] of Object.entries(ipLocationDatabase)) {
                const startIP = ipToNumber(range[0]);
                const endIP = ipToNumber(range[1]);
                
                if (ipNum >= startIP && ipNum <= endIP) {
                    return location;
                }
            }
            
            // å¦‚æœæ‰¾ä¸åˆ°ç²¾ç¡®åŒ¹é…ï¼Œå°è¯•æ ¹æ®IPæ®µåˆ¤æ–­
            const firstOctet = parseInt(ip.split('.')[0]);
            
            if (firstOctet >= 1 && firstOctet <= 9) return 'å…¶ä»–äºšæ´²';
            if (firstOctet >= 14 && firstOctet <= 126) return 'å…¶ä»–äºšæ´²';
            if (firstOctet >= 128 && firstOctet <= 191) return 'æ¬§æ´²æˆ–å…¶ä»–';
            if (firstOctet >= 192 && firstOctet <= 223) return 'åŒ—ç¾æˆ–å…¶ä»–';
            
            return 'æœªçŸ¥';
        }

        // å°†IPåœ°å€è½¬æ¢ä¸ºæ•°å­—
        function ipToNumber(ip) {
            const parts = ip.split('.');
            return (parseInt(parts[0]) << 24) + 
                   (parseInt(parts[1]) << 16) + 
                   (parseInt(parts[2]) << 8) + 
                   parseInt(parts[3]);
        }

        // ä¸‹è½½GitHubè®¢é˜…æ–‡ä»¶ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼šä¼˜å…ˆraw URLä»¥é¿å…CORSé—®é¢˜ï¼Œæ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•ï¼‰
        async function downloadGitHubSubscription() {
            try {
                showLoading(true);
                showStatus('æ­£åœ¨ä»GitHubä¸‹è½½è®¢é˜…æ–‡ä»¶...', 'info');
                
                const repo = document.getElementById('githubRepo').value.trim();
                
                if (!repo || !repo.includes('/')) {
                    showStatus('é”™è¯¯: GitHubä»“åº“æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸º"ç”¨æˆ·å/ä»“åº“å"', 'error');
                    showLoading(false);
                    return;
                }
                
                // æ„å»ºraw URLä¼˜å…ˆï¼ˆraw.githubusercontent.comæ”¯æŒCORSï¼‰
                const [username, reponame] = repo.split('/');
                const branch = document.getElementById('githubBranch').value.trim() || 'main';
                const file = document.getElementById('githubFile').value.trim();
                
                const rawUrl = `https://raw.githubusercontent.com/${repo}/${branch}/${file}`;
                console.log('ä¼˜å…ˆå°è¯•ä»raw URLä¸‹è½½:', rawUrl);
                
                let base64Content = null;
                
                // å°è¯•ä»raw URLä¸‹è½½
                try {
                    const rawResponse = await fetch(rawUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/plain',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (!rawResponse.ok) {
                        throw new Error(`raw URLä¸‹è½½å¤±è´¥: ${rawResponse.status} ${rawResponse.statusText}`);
                    }
                    
                    base64Content = await rawResponse.text();
                } catch (rawError) {
                    console.warn('raw URLä¸‹è½½å¤±è´¥ï¼Œå°è¯•Pages URL:', rawError);
                    
                    // å¤‡é€‰Pages URL
                    const pagesUrl = `https://${username}.github.io/${reponame}/${file}`;
                    console.log('å°è¯•ä»Pages URLä¸‹è½½:', pagesUrl);
                    
                    const pagesResponse = await fetch(pagesUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/plain',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (!pagesResponse.ok) {
                        throw new Error(`Pages URLä¸‹è½½å¤±è´¥: ${pagesResponse.status} ${pagesResponse.statusText}`);
                    }
                    
                    base64Content = await pagesResponse.text();
                }
                
                // å¤„ç†ä¸‹è½½çš„å†…å®¹
                if (base64Content) {
                    processDownloadedContent(base64Content);
                } else {
                    throw new Error('æ— æ³•è·å–è®¢é˜…æ–‡ä»¶å†…å®¹');
                }
                
            } catch (error) {
                console.error('ä¸‹è½½GitHubè®¢é˜…æ–‡ä»¶å¤±è´¥:', error);
                showStatus(`ä¸‹è½½å¤±è´¥: ${error.message}. è¯·æ£€æŸ¥ç½‘ç»œã€ä»“åº“è®¾ç½®æˆ–CORSé—®é¢˜ã€‚`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // å¤„ç†ä¸‹è½½çš„å†…å®¹
        function processDownloadedContent(base64Content) {
            try {
                // è§£ç Base64å†…å®¹ï¼ˆå»é™¤å¯èƒ½çš„æ¢è¡Œå’Œç©ºæ ¼ï¼‰
                const trimmedBase64 = base64Content.trim();
                const decodedContent = atob(trimmedBase64);
                const nodeLinks = decodedContent.split(/\r?\n/).filter(line => {
                    const trimmed = line.trim();
                    return trimmed && trimmed.startsWith('vless://');
                });
                
                generatedData.remoteNodes = nodeLinks;
                generatedData.githubStats.remote = nodeLinks.length;
                updateGitHubStats();
                
                showStatus(`âœ… æˆåŠŸä¸‹è½½å¹¶è§£ç  ${nodeLinks.length} ä¸ªè¿œç¨‹èŠ‚ç‚¹`, 'success');
                
                // æ˜¾ç¤ºè¿œç¨‹èŠ‚ç‚¹ä¿¡æ¯
                showRemoteNodesInfo(nodeLinks);
                
            } catch (decodeError) {
                console.error('è§£ç å¤±è´¥:', decodeError);
                showStatus('é”™è¯¯: è®¢é˜…æ–‡ä»¶è§£ç å¤±è´¥ï¼Œå¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„Base64æ ¼å¼æˆ–å†…å®¹æŸå', 'error');
            }
        }

        // æ˜¾ç¤ºè¿œç¨‹èŠ‚ç‚¹ä¿¡æ¯
        function showRemoteNodesInfo(nodeLinks) {
            const mergedSection = document.getElementById('mergedSection');
            mergedSection.style.display = 'block';
            
            const mergedResult = document.getElementById('mergedResult');
            mergedResult.textContent = `ä»GitHubä¸‹è½½çš„èŠ‚ç‚¹ (${nodeLinks.length}ä¸ª):\n\n${nodeLinks.join('\n\n')}`;
            mergedResult.classList.remove('empty');
            
            // æ»šåŠ¨åˆ°åˆå¹¶ç»“æœåŒºåŸŸ
            mergedSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // åˆå¹¶èŠ‚ç‚¹
        function mergeNodes() {
            try {
                if (generatedData.vlessLinks.length === 0 && generatedData.remoteNodes.length === 0) {
                    showStatus('é”™è¯¯: æ²¡æœ‰å¯åˆå¹¶çš„èŠ‚ç‚¹æ•°æ®ï¼Œè¯·å…ˆç”ŸæˆèŠ‚ç‚¹æˆ–ä¸‹è½½è®¢é˜…æ–‡ä»¶', 'error');
                    return;
                }
                
                showStatus('æ­£åœ¨åˆå¹¶èŠ‚ç‚¹å¹¶å»é‡...', 'info');
                
                // åˆå¹¶æ‰€æœ‰èŠ‚ç‚¹
                const allNodes = [...generatedData.vlessLinks, ...generatedData.remoteNodes];
                generatedData.mergedNodes = allNodes;
                generatedData.githubStats.merged = allNodes.length;
                
                // å»é‡ï¼ˆåŸºäºIP:ç«¯å£ï¼‰
                const uniqueNodes = [];
                const seenNodes = new Set();
                
                for (const node of allNodes) {
                    // æå–èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ï¼ˆIP:ç«¯å£ï¼‰
                    const match = node.match(/@([^:]+):(\d+)/);
                    if (match) {
                        const nodeKey = `${match[1]}:${match[2]}`;
                        if (!seenNodes.has(nodeKey)) {
                            seenNodes.add(nodeKey);
                            uniqueNodes.push(node);
                        }
                    } else {
                        // å¦‚æœæ— æ³•æå–IP:ç«¯å£ï¼Œç›´æ¥æ·»åŠ ï¼ˆä»¥é˜²éæ ‡å‡†æ ¼å¼ï¼‰
                        uniqueNodes.push(node);
                    }
                }
                
                generatedData.uniqueNodes = uniqueNodes;
                generatedData.githubStats.unique = uniqueNodes.length;
                
                // æ›´æ–°ç»Ÿè®¡
                updateGitHubStats();
                
                // æ˜¾ç¤ºåˆå¹¶ç»“æœ
                const mergedSection = document.getElementById('mergedSection');
                mergedSection.style.display = 'block';
                
                const mergedResult = document.getElementById('mergedResult');
                mergedResult.textContent = `åˆå¹¶å»é‡ç»“æœ (${uniqueNodes.length}ä¸ªèŠ‚ç‚¹):\n\næœ¬åœ°èŠ‚ç‚¹: ${generatedData.vlessLinks.length}ä¸ª\nè¿œç¨‹èŠ‚ç‚¹: ${generatedData.remoteNodes.length}ä¸ª\nå»é‡å: ${uniqueNodes.length}ä¸ª\n\nèŠ‚ç‚¹åˆ—è¡¨:\n\n${uniqueNodes.join('\n\n')}`;
                mergedResult.classList.remove('empty');
                
                showStatus(`âœ… æˆåŠŸåˆå¹¶å»é‡ï¼Œå…±å¾—åˆ° ${uniqueNodes.length} ä¸ªå”¯ä¸€èŠ‚ç‚¹`, 'success');
                
                // æ»šåŠ¨åˆ°åˆå¹¶ç»“æœåŒºåŸŸ
                mergedSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                showStatus(`åˆå¹¶èŠ‚ç‚¹å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆå¹¶èŠ‚ç‚¹å¤±è´¥:', error);
            }
        }

        // åŒæ­¥åˆ°GitHub
        async function syncToGitHub() {
            try {
                showLoading(true);
                showStatus('å¼€å§‹GitHubåŒæ­¥æµç¨‹...', 'info');
                
                // æ­¥éª¤1: éªŒè¯é…ç½®
                const token = document.getElementById('githubToken').value.trim();
                const repo = document.getElementById('githubRepo').value.trim();
                const branch = document.getElementById('githubBranch').value.trim();
                const file = document.getElementById('githubFile').value.trim();
                
                if (!token) {
                    showStatus('é”™è¯¯: è¯·è¾“å…¥GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ', 'error');
                    showLoading(false);
                    return;
                }
                
                if (!repo || !repo.includes('/')) {
                    showStatus('é”™è¯¯: GitHubä»“åº“æ ¼å¼ä¸æ­£ç¡®', 'error');
                    showLoading(false);
                    return;
                }
                
                // ä¿å­˜ä»¤ç‰Œ
                saveGitHubToken(token);
                
                // æ­¥éª¤2: ç¡®ä¿æœ‰æœ¬åœ°èŠ‚ç‚¹æ•°æ®
                if (generatedData.vlessLinks.length === 0) {
                    showStatus('è­¦å‘Š: æœ¬åœ°æ²¡æœ‰ç”ŸæˆèŠ‚ç‚¹ï¼Œæ­£åœ¨å°è¯•è‡ªåŠ¨ç”Ÿæˆ...', 'warning');
                    await generateVless();
                    if (generatedData.vlessLinks.length === 0) {
                        showStatus('é”™è¯¯: æ— æ³•ç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹ï¼Œè¯·æ£€æŸ¥CSVæ•°æ®', 'error');
                        showLoading(false);
                        return;
                    }
                }
                
                // æ­¥éª¤3: ä¸‹è½½è¿œç¨‹è®¢é˜…æ–‡ä»¶
                showStatus('æ­¥éª¤1/3: æ­£åœ¨ä¸‹è½½è¿œç¨‹è®¢é˜…æ–‡ä»¶...', 'info');
                await downloadGitHubSubscription();
                
                // ç­‰å¾…ä¸‹è½½å®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤4: åˆå¹¶å»é‡
                showStatus('æ­¥éª¤2/3: æ­£åœ¨åˆå¹¶èŠ‚ç‚¹å¹¶å»é‡...', 'info');
                mergeNodes();
                
                // ç­‰å¾…åˆå¹¶å®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤5: å‡†å¤‡ä¸Šä¼ å†…å®¹
                if (generatedData.uniqueNodes.length === 0 && generatedData.vlessLinks.length > 0) {
                    generatedData.uniqueNodes = [...generatedData.vlessLinks];
                    generatedData.githubStats.unique = generatedData.vlessLinks.length;
                }
                
                if (generatedData.uniqueNodes.length === 0) {
                    showStatus('é”™è¯¯: æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }
                
                const nodeText = generatedData.uniqueNodes.join('\n');
                const base64Content = btoa(nodeText);  // ç›´æ¥btoaï¼Œä¸éœ€è¦unescape/encodeURIComponentï¼Œå› ä¸ºvlessé“¾æ¥æ˜¯ASCII
                
                // æ­¥éª¤6: è·å–æ–‡ä»¶SHAï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                showStatus('æ­¥éª¤3/3: æ­£åœ¨æäº¤åˆ°GitHub...', 'info');
                
                // æ„å»ºAPI URL
                const apiUrl = `https://api.github.com/repos/${repo}/contents/${file}`;
                
                // é¦–å…ˆå°è¯•è·å–ç°æœ‰æ–‡ä»¶ä¿¡æ¯
                let sha = null;
                try {
                    const fileInfoResponse = await fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (fileInfoResponse.ok) {
                        const fileInfo = await fileInfoResponse.json();
                        sha = fileInfo.sha;
                    } else if (fileInfoResponse.status !== 404) {
                        throw new Error(`è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥: ${fileInfoResponse.status} ${fileInfoResponse.statusText}`);
                    }
                } catch (shaError) {
                    console.warn('è·å–SHAå¤±è´¥ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶:', shaError);
                }
                
                // å‡†å¤‡æäº¤æ•°æ®
                const commitMessage = `æ›´æ–°èŠ‚ç‚¹è®¢é˜… (${new Date().toLocaleString()}) - å…± ${generatedData.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;
                const commitData = {
                    message: commitMessage,
                    content: base64Content,
                    branch: branch
                };
                
                if (sha) {
                    commitData.sha = sha;
                }
                
                // æäº¤æ–‡ä»¶
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`æäº¤å¤±è´¥: ${response.status} - ${errorData.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
                showStatus(`âœ… GitHubåŒæ­¥å®Œæˆï¼æˆåŠŸæäº¤ ${generatedData.uniqueNodes.length} ä¸ªèŠ‚ç‚¹åˆ°ä»“åº“`, 'success');
                
                // æ˜¾ç¤ºæ›´æ–°åçš„è®¢é˜…é“¾æ¥
                const [username, reponame] = repo.split('/');
                const pagesUrl = `https://${username}.github.io/${reponame}/${file}`;
                showStatus(`è®¢é˜…é“¾æ¥å·²æ›´æ–°: ${pagesUrl}`, 'info');
                
            } catch (error) {
                showStatus(`GitHubåŒæ­¥å¤±è´¥: ${error.message}. è¯·æ£€æŸ¥ä»¤ç‰Œæƒé™ï¼ˆéœ€è¦repo scopeï¼‰ã€ç½‘ç»œæˆ–ä»“åº“è®¾ç½®ã€‚`, 'error');
                console.error('GitHubåŒæ­¥å¤±è´¥:', error);
            } finally {
                showLoading(false);
            }
        }

        // è§£æCSVè¡Œ
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"' && !inQuotes) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes && nextChar === '"') {
                    current += '"';
                    i++;
                } else if (char === '"' && inQuotes) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // ç”ŸæˆVlessé“¾æ¥
        function generateVlessLink(ip, port, config, remarks) {
            const params = [
                'encryption=none',
                'security=tls',
                `sni=${encodeURIComponent(config.sni)}`,
                `fp=${config.fp}`,
                'type=ws',
                `host=${encodeURIComponent(config.host)}`,
                'path=%2F',
                'alpn=h2%2Chttp%2F1.1'
            ];
            
            return `vless://${config.uuid}@${ip}:${port}?${params.join('&')}#${encodeURIComponent(remarks)}`;
        }

        // ç”ŸæˆJSONé…ç½®
        function generateJsonConfig(ip, port, config, remarks) {
            return {
                "v": "2",
                "ps": remarks,
                "add": ip,
                "port": port.toString(),
                "id": config.uuid,
                "aid": "0",
                "scy": "none",
                "net": "ws",
                "type": "none",
                "host": config.host,
                "path": "/",
                "tls": "tls",
                "sni": config.sni,
                "alpn": "h2,http/1.1",
                "fp": config.fp,
                "flow": ""
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            const vlessLinksEl = document.getElementById('vless-links');
            
            if (generatedData.vlessLinks.length > 0) {
                vlessLinksEl.textContent = generatedData.vlessLinks.join('\n\n');
                vlessLinksEl.classList.remove('empty');
            } else {
                vlessLinksEl.textContent = 'Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
                vlessLinksEl.classList.add('empty');
            }
            
            const jsonOutputEl = document.getElementById('json-output');
            jsonOutputEl.textContent = JSON.stringify(generatedData.jsonConfig, null, 2);
        }

        // ç”Ÿæˆè®¢é˜…
        function generateSubscription() {
            if (generatedData.vlessLinks.length > 0) {
                const vlessLinksText = generatedData.vlessLinks.join('\n');
                const base64 = btoa(vlessLinksText);
                generatedData.subscription = base64;
                
                const subscriptionEl = document.getElementById('subscription');
                subscriptionEl.textContent = base64;
            }
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const loadingEl = document.getElementById('loading');
            loadingEl.style.display = show ? 'block' : 'none';
        }

        // åˆ‡æ¢éƒ¨åˆ†æ˜¾ç¤º
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section.style.display === 'none') {
                section.style.display = 'block';
                section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                section.style.display = 'none';
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(type) {
            let text = '';
            
            switch(type) {
                case 'vless':
                    text = generatedData.vlessLinks.join('\n');
                    break;
                case 'json':
                    text = JSON.stringify(generatedData.jsonConfig, null, 2);
                    break;
                case 'subscription':
                    text = generatedData.subscription;
                    break;
                case 'merged':
                    text = generatedData.uniqueNodes.join('\n');
                    if (!text) {
                        text = 'æš‚æ— åˆå¹¶æ•°æ®';
                    }
                    break;
            }
            
            if (!text || (type === 'vless' && generatedData.vlessLinks.length === 0)) {
                showStatus('é”™è¯¯: æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                return;
            }
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showStatus('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(err => {
                    copyTextFallback(text);
                });
            } else {
                copyTextFallback(text);
            }
        }

        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function copyTextFallback(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showStatus('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                } else {
                    showStatus('é”™è¯¯: å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                }
            } catch (err) {
                showStatus('é”™è¯¯: å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // ä¸‹è½½Vlessé“¾æ¥
        function downloadVlessLinks() {
            if (generatedData.vlessLinks.length === 0) {
                showStatus('é”™è¯¯: è¯·å…ˆç”ŸæˆVlessèŠ‚ç‚¹ï¼', 'error');
                return;
            }
            
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
            const content = generatedData.vlessLinks.join('\n');
            downloadFile(content, `vless_links_${timestamp}.txt`);
            showStatus('âœ… å·²ä¸‹è½½Vlessé“¾æ¥æ–‡ä»¶', 'success');
        }

        // ä¸‹è½½å…¨éƒ¨æ–‡ä»¶
        function downloadAll() {
            if (generatedData.vlessLinks.length === 0) {
                showStatus('é”™è¯¯: è¯·å…ˆç”ŸæˆVlessèŠ‚ç‚¹ï¼', 'error');
                return;
            }
            
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
            
            downloadFile(generatedData.vlessLinks.join('\n'), `vless_links_${timestamp}.txt`);
            downloadFile(JSON.stringify(generatedData.jsonConfig, null, 2), `vless_config_${timestamp}.json`, 'application/json');
            
            if (generatedData.subscription) {
                downloadFile(generatedData.subscription, `subscription_${timestamp}.txt`);
            }
            
            showStatus('âœ… æ‰€æœ‰æ–‡ä»¶ä¸‹è½½å®Œæˆï¼', 'success');
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, type = 'text/plain') {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // éªŒè¯UUID
        function isValidUUID(uuid) {
            const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
            return uuidRegex.test(uuid);
        }

        // éªŒè¯IPåœ°å€
        function isValidIP(ip) {
            const ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            return ipv4Regex.test(ip);
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            
            if (type === 'success' || type === 'info' || type === 'warning') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
