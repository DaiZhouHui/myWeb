<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·4.0ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #4a56d2;
            --secondary-color: #3f4bbf;
            --success-color: #2da69a;
            --info-color: #3a8fd9;
            --warning-color: #e0559c;
            --github-color: #2d3748;
            --light-color: #f7fafc;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --card-bg: rgba(255, 255, 255, 0.98);
            --sidebar-width: 50%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #5d6de0 0%, #6a4fa3 100%);
            color: #2d3748;
            line-height: 1.4;
            min-height: 100vh;
            padding: 18px;
            font-size: 15px;
        }

        .container {
            max-width: 1650px;
            margin: 0 auto;
            position: relative;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æç¤ºæ¡ */
        .header-info {
            text-align: center;
            color: white;
            margin-bottom: 18px;
            animation: fadeIn 0.8s ease-out;
            padding: 12px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: var(--border-radius);
            position: relative;
        }

        .header-info.hidden {
            display: none;
        }

        .header-info h1 {
            font-size: 1.5rem;
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: -0.2px;
        }

        .header-info p {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 550px;
            margin: 0 auto;
        }

        /* æ˜¾ç¤º/éšè—æç¤ºæŒ‰é’® */
        .toggle-header-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .toggle-header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* ä¸»å¸ƒå±€ï¼šè°ƒæ•´å¡ç‰‡é¡ºåº */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 30px;
            position: relative;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        /* è°ƒæ•´å¡ç‰‡é¡ºåº */
        .main-layout .card:nth-child(1) {
            order: 1;
        }

        .main-layout .card:nth-child(2) {
            order: 3;
        }

        .main-layout .card:nth-child(3) {
            order: 2;
        }

        .main-layout .card:nth-child(4) {
            order: 4;
        }

        /* å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 0.6s ease-out;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        /* æ›´ç®€æ´çš„å¡ç‰‡å¤´éƒ¨ */
        .card-header {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
            color: white;
            padding: 10px 6px;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite linear;
        }

        /* æ›´å°çš„å¡ç‰‡æ ‡é¢˜ - å‰¯æ ‡é¢˜æ ·å¼ */
        .card-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            color: rgba(255, 255, 255, 0.95);
        }

        /* å¡ç‰‡æ ‡é¢˜å›¾æ ‡æ›´å° */
        .card-header h2 span {
            font-size: 12px;
        }

        .card-body {
            padding: 22px;
            flex: 1;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 22px;
        }

        .section:last-child {
            margin-bottom: 0;
        }

        /* æ›´å°çš„æ ‡é¢˜ */
        .section-title {
            font-size: 1rem;
            color: #4a5568;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .badge {
            background: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 16px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
            background: white;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.15);
            transform: translateY(-1px);
        }

        /* ç¦ç”¨çŠ¶æ€çš„è¾“å…¥æ¡† */
        textarea:disabled {
            background-color: #f7fafc;
            cursor: not-allowed;
            opacity: 0.7;
            border-color: #e2e8f0;
        }

        textarea {
            min-height: 120px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
            line-height: 1.4;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .btn {
            padding: 11px 18px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.25);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2da69a 0%, #25958a 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3a8fd9 0%, #2f7ec7 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
            color: white;
        }

        .btn-github {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .file-upload-container {
            margin-bottom: 16px;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 28px 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #fafbff;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }

        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: #e8edff;
        }

        .file-upload-area .upload-icon {
            font-size: 2.4rem;
            color: var(--primary-color);
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .file-upload-area p {
            color: #4a5568;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .file-upload-area small {
            color: #718096;
            font-size: 12px;
        }

        #fileInput {
            display: none;
        }

        .file-info {
            margin-top: 14px;
            padding: 14px;
            background: linear-gradient(135deg, #e8f4fd 0%, #d1e9ff 100%);
            border-radius: 5px;
            border: 1px solid #b6e0fe;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-info-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .file-size {
            font-size: 12px;
            color: #718096;
        }

        .remove-file-btn {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #c53030;
            border: none;
            border-radius: 4px;
            padding: 7px 14px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-file-btn:hover {
            background: linear-gradient(135deg, #feb2b2 0%, #fc8181 100%);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(252, 129, 129, 0.3);
        }

        /* é…ç½®è¡Œ */
        .config-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 16px;
        }

        /* GitHubé…ç½® - ä¿®æ”¹æ ·å¼ */
        .github-config {
            background: linear-gradient(135deg, #f6f8fa 0%, #f0f4f8 100%);
            border-radius: 6px;
            padding: 16px;
            padding-bottom: 1px;
            margin-top: 0px;
            border: 1px solid #e1e4e8;
            position: relative;
        }

        /* GitHubé…ç½®å¸®åŠ©æ–‡æœ¬ - æ”¾åœ¨å³ä¸Šè§’ */
        .github-config-help {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 11px;
            color: #718096;
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #e1e4e8;
        }

        .github-config-help a {
            color: #5d6de0;
            text-decoration: none;
            font-weight: 500;
        }

        .github-config-help a:hover {
            text-decoration: underline;
        }

        /* GitHubä¸‰ä¸ªé…ç½®é¡¹åœ¨ä¸€è¡Œæ˜¾ç¤º */
        .github-config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 120px;
            gap: 12px;
            margin-bottom: 14px;
        }

        @media (max-width: 768px) {
            .github-config-row {
                grid-template-columns: 1fr;
            }

            .github-config-help {
                position: static;
                margin-top: 10px;
            }
        }

        /* ç»“æœæ¡† */
        .result-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #5d6de0, #4a56d2);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .result-header h3 {
            color: #2d3748;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .result-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            color: #4a5568;
        }

        .result-content.empty {
            color: #a0aec0;
            font-style: italic;
        }

        /* ç”Ÿæˆéƒ¨åˆ† */
        .generate-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
        }

        /* GitHubæŒ‰é’®åŒºåŸŸ - é‡æ–°è°ƒæ•´å¸ƒå±€ */
        .github-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 14px;
        }

        /* GitHubæŒ‰é’®ç¬¬ä¸€è¡Œ - ä¸‰ä¸ªæŒ‰é’® */
        .github-buttons-row1 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        /* GitHubæŒ‰é’®ç¬¬äºŒè¡Œ - ä¸‰ä¸ªæŒ‰é’® */
        .github-buttons-row2 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        /* GitHubæŒ‰é’®ç¬¬ä¸‰è¡Œ - æ–°å¸ƒå±€ï¼šä¸¤ä¸ªæŒ‰é’®å¹¶æ’ */
        .github-buttons-row3 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .github-buttons-row1 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row2 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row3 {
                grid-template-columns: 1fr;
            }
        }

        /* GitHubç»Ÿè®¡ */
        .github-stats {
            display: flex;
            gap: 14px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: white;
            padding: 10px 14px;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 16px;
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            padding: 18px;
            font-size: 13px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 18px;
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 14px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* æºæ ‡è®° */
        .source-badge {
            display: inline-block;
            background: linear-gradient(135deg, #e0559c, #e53e3e);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        /* å¸®åŠ©æ–‡æœ¬ */
        .help-text {
            font-size: 12px;
            color: #718096;
            margin-top: 6px;
            line-height: 1.4;
        }

        /* URLé€‰æ‹©å®¹å™¨ */
        .url-select-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 14px;
        }

        .custom-url-input {
            display: none;
        }

        .custom-url-input.show {
            display: block;
            margin-top: 10px;
        }

        /* å…¨å±€é€šçŸ¥çª—å£æ ·å¼ */
        .notification-container {
            position: fixed;
            top: 18px;
            right: 18px;
            z-index: 1000;
            max-width: 350px;
            width: 100%;
        }

        .notification {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 14px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid var(--primary-color);
            animation: slideInRight 0.4s ease-out;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #5d6de0, #4a56d2);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.success::before {
            background: linear-gradient(90deg, #2da69a, #25958a);
        }

        .notification.error {
            border-left-color: #e53e3e;
        }

        .notification.error::before {
            background: linear-gradient(90deg, #e53e3e, #e0559c);
        }

        .notification.info {
            border-left-color: var(--info-color);
        }

        .notification.info::before {
            background: linear-gradient(90deg, #3a8fd9, #2f7ec7);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .notification-time {
            font-size: 11px;
            color: #718096;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .notification-message {
            color: #4a5568;
            font-size: 13px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            padding: 0;
            transition: color 0.2s;
        }

        .notification-close:hover {
            color: #e53e3e;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* æ—¥å¿—è®°å½•åŒºåŸŸ */
        .log-section {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #4a5568;
            color: white;
            display: none;
        }

        .log-section.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            border-bottom: 1px solid #718096;
            padding-bottom: 10px;
        }

        .log-header h3 {
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 600;
        }

        .log-controls {
            display: flex;
            gap: 10px;
        }

        .log-content {
            max-height: 180px;
            overflow-y: auto;
            background: #1a202c;
            border-radius: 5px;
            padding: 14px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #4a5568;
        }

        .log-entry:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .log-time {
            color: #a0aec0;
            font-size: 11px;
            margin-right: 10px;
        }

        .log-level {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 8px;
            text-transform: uppercase;
        }

        .log-level.info {
            background: rgba(66, 153, 225, 0.25);
            color: #63b3ed;
        }

        .log-level.success {
            background: rgba(56, 178, 172, 0.25);
            color: #81e6d9;
        }

        .log-level.error {
            background: rgba(245, 101, 101, 0.25);
            color: #fc8181;
        }

        .log-message {
            color: #cbd5e0;
        }

        /* ä¿®æ”¹ä¸Šä¼ æŒ‰é’®é¢œè‰² */
        .btn-local-upload {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            color: white;
        }

        .btn-merge-upload {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn-subscription-upload {
            background: linear-gradient(135deg, #0bc5ea 0%, #00b5d8 100%);
            color: white;
        }

        .btn-oneclick-sync {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
            color: white;
        }

        /* æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„æŒ‰é’® */
        .btn-merge-to-path {
            background: linear-gradient(135deg, #9b2c2c 0%, #822727 100%);
            color: white;
        }

        /* æ‰‹åŠ¨Vlessè½¬Base64è®¢é˜…è¾“å…¥æ¡† */
        #manualVlessInput {
            min-height: 90px;
            font-size: 13px;
            padding: 12px;
        }

        /* çŠ¶æ€æ¶ˆæ¯ */
        .status-message {
            padding: 14px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: none;
            animation: fadeIn 0.3s ease-out;
            border-left: 3px solid transparent;
        }

        .status-success {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            color: #22543d;
            border-left-color: #38a169;
            display: block;
        }

        .status-error {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #742a2a;
            border-left-color: #e53e3e;
            display: block;
        }

        .status-info {
            background: linear-gradient(135deg, #bee3f8 0%, #90cdf4 100%);
            color: #2a4365;
            border-left-color: #3182ce;
            display: block;
        }

        /* æ ‡ç­¾é¡µå¯¼èˆª - ä¿®å¤ï¼šç¡®ä¿æ ‡ç­¾é¡µä½œç”¨åŸŸç‹¬ç«‹ */
        .card-tab-navigation {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 6px;
        }

        .card-tab-btn {
            padding: 8px 16px;
            background: #f1f5f9;
            border: none;
            border-radius: 5px 5px 0 0;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            transition: var(--transition);
        }

        .card-tab-btn.active {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .card-tab-btn:hover:not(.active) {
            background: #e2e8f0;
        }

        .card-tab-content {
            display: none;
        }

        .card-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* é«˜çº§é…ç½®æŠ˜å é¢æ¿ */
        .accordion {
            margin-top: 16px;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid #e2e8f0;
            transition: var(--transition);
            font-size: 14px;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, #f1f3f5 0%, #e9ecef 100%);
        }

        .accordion-header .icon {
            transition: transform 0.3s;
            font-size: 13px;
        }

        .accordion-header.active .icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            padding: 16px;
            background: white;
            border-radius: 0 0 5px 5px;
            border: 1px solid #e2e8f0;
            border-top: none;
            display: none;
        }

        .accordion-content.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å¿«æ·æ“ä½œæŒ‰é’®ç»„ - è°ƒæ•´é¡ºåº */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 0 0 13px 0;
            justify-content: center;
        }

        .quick-btn {
            padding: 7px 14px;
            font-size: 13px;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quick-btn:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
        }

        /* èŠ‚ç‚¹è®¡æ•°å™¨ - ä¿®æ”¹ä¸ºæŒ‡å®šèƒŒæ™¯è‰² */
        .node-counter {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgb(24 85 204);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        /* åˆ†å‰²çº¿ */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 16px 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                font-size: 14px;
            }

            .header-info h1 {
                font-size: 1.4rem;
            }

            .header-info p {
                font-size: 0.85rem;
            }

            .card-header h2 {
                font-size: 1.05rem;
            }

            .config-row {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }

            .github-buttons-row1 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row2 {
                grid-template-columns: 1fr;
            }

            .result-content {
                max-height: 180px;
            }

            .quick-actions {
                justify-content: flex-start;
            }
        }

        /* è¾“å…¥ç»„ */
        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 14px;
        }

        .input-group input {
            flex: 1;
        }

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 14px;
        }

        /* æé«˜é¥±å’Œåº¦ä½†é¿å…é©¬å…‹é¾™è‰²è°ƒ */
        .btn-primary:hover {
            background: linear-gradient(135deg, #4a56d2 0%, #3f4bbf 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #25958a 0%, #1e857a 100%);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #2f7ec7 0%, #276fb2 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #ce4a8c 0%, #be4081 100%);
        }

        .btn-github:hover {
            background: linear-gradient(135deg, #1a202c 0%, #0d1117 100%);
        }

        /* æ™ºèƒ½åˆ†å‰²è¯´æ˜ */
        .smart-split-info {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border-radius: 6px;
            padding: 14px;
            margin-top: 12px;
            border: 1px solid #81e6d9;
            font-size: 13px;
            color: #234e52;
        }

        .smart-split-info h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #234e52;
        }

        .smart-split-info ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }

        .smart-split-info li {
            margin-bottom: 4px;
        }

        /* CSVæ ¼å¼ç¤ºä¾‹ */
        .csv-example {
            background: #f7fafc;
            border-radius: 4px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            color: #4a5568;
            border: 1px dashed #cbd5e0;
        }

        /* æé«˜æ•´ä½“é¥±å’Œåº¦ */
        body {
            background: linear-gradient(135deg, #5d6de0 0%, #6a4fa3 100%);
        }

        .card-header {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2da69a 0%, #25958a 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #3a8fd9 0%, #2f7ec7 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
        }

        .result-box::before {
            background: linear-gradient(to bottom, #5d6de0, #4a56d2);
        }

        /* element.style {
            margin-bottom: 0px;
            padding-bottom: 4px;
            padding-top: 4px;
        } */


        /* æ–°å¢ï¼šä»¤ç‰Œä¿å­˜é€‰é¡¹æ ·å¼ - ä¿®æ”¹ä¸ºå°æ–‡å­—æ˜¾ç¤ºåœ¨GitHubä»¤ç‰Œå³ä¾§ */
        .token-save-label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
            margin-bottom: 0Px;
            font-size: 11px;
            color: #718096;
            font-weight: normal;
            padding: 2px 6px;
            border: 1px solid #e2e8f0;
            border-radius: 3px;
            background: #f7fafc;
            cursor: pointer;
            user-select: none;
        }

        .token-save-label:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .token-save-label input[type="checkbox"] {
            width: 12px;
            height: 12px;
            margin: 0;
        }

        /* æ–°å¢ï¼šä¸Šä¼ æŒ‰é’®æ ·å¼ */
        .btn-upload-merged {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        /* æ–°å¢ï¼šè·¯å¾„é€‰æ‹©è¡Œå¸ƒå±€ */
        .path-select-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 1px;
        }

        @media (max-width: 768px) {
            .path-select-row {
                grid-template-columns: 1fr;
            }
        }

        /* æ–°å¢ï¼šä»¤ç‰Œè¾“å…¥ç»„æ ·å¼ */
        .token-input-group {
            position: relative;
            margin-bottom: 12px;
        }

        .token-label-container {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .token-label {
            margin-bottom: 0;
            margin-right: 8px;
        }

        /* æ–°å¢ï¼šè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ - æ›´ç®€æ´å¤§æ°” */
        .custom-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeInDialog 0.3s ease-out;
        }

        .custom-dialog {
            background: white;
            border-radius: 16px;
            padding: 32px;
            min-width: 420px;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUpDialog 0.4s ease-out;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .custom-dialog-header {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .custom-dialog-icon {
            background: linear-gradient(135deg, #5d6de0, #4a56d2);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
            font-weight: bold;
        }

        .custom-dialog-title {
            color: #2d3748;
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            line-height: 1.3;
        }

        .custom-dialog-content {
            color: #4a5568;
            font-size: 16px;
            line-height: 1.6;
            margin: 0 0 32px 0;
            padding: 0 8px;
        }

        .custom-dialog-content strong {
            color: #5d6de0;
            font-weight: 700;
        }

        .custom-dialog-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
        }

        .custom-dialog-btn {
            padding: 14px 28px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            min-width: 100px;
            letter-spacing: 0.3px;
        }

        .custom-dialog-btn-cancel {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }

        .custom-dialog-btn-cancel:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }

        .custom-dialog-btn-confirm {
            background: linear-gradient(135deg, #5d6de0, #4a56d2);
            color: white;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.3);
        }

        .custom-dialog-btn-confirm:hover {
            background: linear-gradient(135deg, #4a56d2, #3f4bbf);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.4);
        }

        /* è‡ªå®šä¹‰å¯¹è¯æ¡†åŠ¨ç”» */
        @keyframes fadeInDialog {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUpDialog {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* æˆåŠŸ/è­¦å‘Š/é”™è¯¯å¯¹è¯æ¡†çš„å›¾æ ‡é¢œè‰² */
        .custom-dialog.warning .custom-dialog-icon {
            background: linear-gradient(135deg, #e0559c, #ce4a8c);
        }

        .custom-dialog.error .custom-dialog-icon {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .custom-dialog.success .custom-dialog-icon {
            background: linear-gradient(135deg, #2da69a, #25958a);
        }
    </style>
</head>

<body>
    <!-- å…¨å±€é€šçŸ¥å®¹å™¨ -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- é¡¶éƒ¨ä¿¡æ¯æç¤ºæ¡ï¼ˆå¯éšè—ï¼‰ -->
        <div class="header-info" id="headerInfo">
            <button class="toggle-header-btn" id="toggleHeaderBtn">éšè—</button>
            <h1>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·4.0</h1>
            <p>CSVè½¬Vless + Base64è®¢é˜… + GitHubè‡ªåŠ¨åŒæ­¥</p>
        </div>

        <!-- å¿«æ·æ“ä½œæŒ‰é’®ç»„ï¼ˆè°ƒæ•´äº†é¡ºåºï¼‰ -->
        <div class="quick-actions">
            <button class="quick-btn" onclick="generateVless()">
                <span>âš¡</span> ç”ŸæˆèŠ‚ç‚¹
            </button>
            <button class="quick-btn" onclick="downloadRemote()">
                <span>â¬‡ï¸</span> ä¸‹è½½è¿œç¨‹
            </button>
            <button class="quick-btn" onclick="mergeAndShow()">
                <span>ğŸ”„</span> åˆå¹¶èŠ‚ç‚¹
            </button>
            <button class="quick-btn" onclick="oneClickSync()">
                <span>ğŸš€</span> ä¸€é”®åŒæ­¥
            </button>
            <button class="quick-btn" onclick="uploadLocalBase64ToPath()">
                <span>ğŸ“¤</span> ä¸Šä¼ æœ¬åœ°è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
            </button>
            <button class="quick-btn" onclick="uploadMergedBase64()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¸»è¦è®¢é˜…
            </button>
            <button class="quick-btn" onclick="uploadMergedOptimal()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…
            </button>
            <button class="quick-btn" onclick="uploadPlainNodes()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…
            </button>
            <button class="quick-btn" onclick="toggleLog()">
                <span>ğŸ“‹</span> æ˜¾ç¤ºæ—¥å¿—
            </button>
            <button class="quick-btn" onclick="document.getElementById('toggleHeaderBtn').click()">
                <span>ğŸ‘ï¸</span> æ˜¾ç¤º/éšè—æ ‡é¢˜
            </button>
        </div>

        <div class="main-layout">
            <!-- CSVæ•°æ®æºå¡ç‰‡ - æœ€å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“</span>
                        CSVæ•°æ®æº
                        <span id="sourceBadge" class="source-badge">æœªé€‰æ‹©</span>
                    </h2>
                </div>
                <div class="card-body">
                    <!-- CSVæ•°æ®æºæ ‡ç­¾é¡µå¯¼èˆª -->
                    <div class="card-tab-navigation" id="csvTabNav">
                        <button class="card-tab-btn active" data-tab="upload-tab">ä¸Šä¼ æ–‡ä»¶</button>
                        <button class="card-tab-btn" data-tab="paste-tab">ç²˜è´´å†…å®¹</button>
                        <button class="card-tab-btn" data-tab="config-tab">é…ç½®</button>
                    </div>

                    <!-- ä¸Šä¼ æ–‡ä»¶æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content active" id="upload-tab">
                        <div class="section">
                            <div class="file-upload-container">
                                <div class="file-upload-area" id="dropArea">
                                    <div class="upload-icon">ğŸ“</div>
                                    <p><strong>æ‹–æ”¾CSVæ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©</strong></p>
                                    <small>æ”¯æŒ.csvæˆ–.txtæ–‡ä»¶æ ¼å¼</small>
                                    <input type="file" id="fileInput" accept=".csv,.txt">
                                </div>

                                <div id="fileInfo" class="file-info">
                                    <div class="file-info-content">
                                        <div class="file-info-text">
                                            <span id="fileName" class="file-name"></span>
                                            <span id="fileSize" class="file-size"></span>
                                        </div>
                                        <button type="button" id="removeFileBtn" class="remove-file-btn">
                                            <span>ğŸ—‘ï¸</span> ç§»é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="section-title">
                                <span>ğŸ“Š CSVåˆ—é…ç½®</span>
                            </div>
                            <div class="config-row">
                                <div class="form-group">
                                    <label for="ipColumn">IPåœ°å€åˆ—</label>
                                    <input type="number" id="ipColumn" value="0" min="0">
                                    <div class="help-text">Aåˆ—=0ï¼ŒBåˆ—=1ï¼Œä»¥æ­¤ç±»æ¨</div>
                                </div>
                                <div class="form-group">
                                    <label for="portColumn">ç«¯å£åˆ—</label>
                                    <input type="number" id="portColumn" value="7" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— ç«¯å£åˆ—ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç²˜è´´å†…å®¹æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="paste-tab">
                        <div class="section">
                            <div class="section-title">
                                <span>ğŸ“ ç²˜è´´CSVæˆ–IPå’Œç«¯å£å†…å®¹</span>
                            </div>

                            <div class="form-group">
                                <label for="csvInput">CSVæ•°æ®å†…å®¹ï¼š</label>
                                <textarea id="csvInput" placeholder="æ”¯æŒå¤šç§æ ¼å¼ï¼Œæ™ºèƒ½åˆ†å‰²ï¼š
1. å•è¡Œæˆ–å¤šè¡Œæ ¼å¼ï¼š
2. ç´§å‡‘æ ¼å¼ï¼ˆä¸€è¡Œå¤šä¸ªï¼‰ï¼š
3. æ··åˆåˆ†éš”ç¬¦ï¼š
4. åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰ï¼š"></textarea>
                            </div>

                            <!-- æ™ºèƒ½åˆ†å‰²è¯´æ˜ -->
                            <div class="smart-split-info">
                                <h4>ğŸ“‹ æ™ºèƒ½åˆ†å‰²è¯´æ˜</h4>
                                <p>æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰ï¼š</p>
                                <ul>
                                    <li>IP:ç«¯å£ï¼ˆå†’å·åˆ†éš”ï¼‰</li>
                                    <li>IP,ç«¯å£ï¼ˆé€—å·åˆ†éš”ï¼‰</li>
                                    <li>IP ç«¯å£ï¼ˆå•ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åˆ†éš”ï¼‰</li>
                                    <li>IP;ç«¯å£ï¼ˆåˆ†å·åˆ†éš”ï¼‰</li>
                                    <li>åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰</li>
                                </ul>
                                <p>æ”¯æŒæ··åˆæ ¼å¼å’Œç´§å‡‘æ ¼å¼ï¼Œè‡ªåŠ¨å»é‡å’Œæ¸…ç†ã€‚</p>
                                <!-- CSVæ ¼å¼ç¤ºä¾‹ -->
                                <div class="csv-example">
                                    <strong>ç¤ºä¾‹ï¼š</strong><br>
                                    8.209.202.241:443<br>
                                    104.238.162.245,8080<br>
                                    45.76.123.234 8443<br>
                                    142.93.128.233<br>
                                    15.25.152.123 8443 (å¤šä¸ªç©ºæ ¼)
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- é…ç½®æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="config-tab">
                        <div class="section">
                            <div class="section-title">
                                <span>âš™ï¸ èŠ‚ç‚¹é…ç½®</span>
                            </div>

                            <div class="config-row">
                                <div class="form-group">
                                    <label for="defaultPort">é»˜è®¤ç«¯å£</label>
                                    <input type="number" id="defaultPort" value="443" min="1" max="65535">
                                </div>

                                <div class="form-group">
                                    <label for="remarksPrefix">åˆ«åå‰ç¼€</label>
                                    <input type="text" id="remarksPrefix" value="è‡ªé€‰">
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="forcePort443">
                                <label for="forcePort443"><strong>å¼ºåˆ¶æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨443ç«¯å£</strong></label>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="autoLocation" checked>
                                <label for="autoLocation"><strong>è‡ªåŠ¨è¯†åˆ«IPå±åœ°ç”Ÿæˆåˆ«å</strong></label>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="renameOnMerge" checked>
                                <label for="renameOnMerge"><strong>åˆå¹¶æ—¶é‡æ–°è®¾ç½®æ‰€æœ‰èŠ‚ç‚¹åˆ«å</strong></label>
                            </div>
                        </div>
                    </div>

                    <!-- ç”ŸæˆæŒ‰é’®åŒºåŸŸ -->
                    <div class="generate-section">
                        <div class="section-title">
                            <span>ğŸš€ ç”Ÿæˆæ“ä½œ</span>
                            <span id="localNodeCount" class="node-counter">0èŠ‚ç‚¹</span>
                        </div>

                        <button id="generateBtn" class="btn btn-primary btn-block">
                            <span>âš¡</span> ç”ŸæˆVlessèŠ‚ç‚¹
                        </button>

                        <div class="loading" id="loading">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                        </div>
                    </div>

                    <!-- é«˜çº§é…ç½®æŠ˜å é¢æ¿ -->
                    <div class="accordion">
                        <div class="accordion-header" id="advancedConfigToggle">
                            <span>âš™ï¸ é«˜çº§é…ç½®ï¼ˆå›ºå®šé»˜è®¤å€¼ï¼‰</span>
                            <span class="icon">â–¼</span>
                        </div>
                        <div class="accordion-content" id="advancedConfigContent">
                            <div class="config-row">
                                <div class="form-group">
                                    <label>ç”¨æˆ·ID (UUID)</label>
                                    <input type="text" id="uuid" value="471a8e64-7b21-4703-b1d1-45a221098459" readonly>
                                </div>

                                <div class="form-group">
                                    <label>ä¼ªè£…åŸŸå (Host)</label>
                                    <input type="text" id="host" value="knny.dpdns.org">
                                </div>
                            </div>

                            <div class="config-row">
                                <div class="form-group">
                                    <label>SNIåŸŸå</label>
                                    <input type="text" id="sni" value="knny.dpdns.org">
                                </div>

                                <div class="form-group">
                                    <label>æµè§ˆå™¨æŒ‡çº¹ (fp)</label>
                                    <input type="text" id="fp" value="chrome">
                                </div>
                            </div>

                            <div class="help-text">
                                å…¶ä»–å›ºå®šå‚æ•°ï¼š<br>
                                â€¢ åŠ å¯†æ–¹å¼ï¼šnone<br>
                                â€¢ ç½‘ç»œç±»å‹ï¼šws<br>
                                â€¢ Pathï¼š/<br>
                                â€¢ TLSï¼šå¯ç”¨<br>
                                â€¢ Flowï¼šç©º<br>
                                â€¢ ä¼ªè£…æ–¹å¼ï¼šç©º
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿæˆç»“æœå¡ç‰‡ - å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“Š</span>
                        ç”Ÿæˆç»“æœï¼ˆèŠ‚ç‚¹æ±‡æ€»ï¼‰
                        <span id="resultCount" class="badge">0èŠ‚ç‚¹</span>
                    </h2>
                </div>
                <div class="card-body">
                    <!-- ç”Ÿæˆç»“æœæ ‡ç­¾é¡µ -->
                    <div class="card-tab-navigation" id="resultTabNav">
                        <button class="card-tab-btn active" data-tab="vless-tab">æœ¬åœ°Vless</button>
                        <button class="card-tab-btn" data-tab="local-base64-tab">æœ¬åœ°Base64</button>
                        <button class="card-tab-btn" data-tab="merged-tab">åˆå¹¶Vless</button>
                        <button class="card-tab-btn" data-tab="auto-base64-tab">åˆå¹¶Base64</button>
                    </div>

                    <!-- Vlessé“¾æ¥æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content active" id="vless-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Vlessé“¾æ¥ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰</h3>
                            <button id="copyVlessBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶å…¨éƒ¨Vlessé“¾æ¥
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="vless-links" class="result-content empty">Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>

                        <div class="button-group" style="margin-top: 14px;">
                            <!-- åªä¿ç•™ä¸€ä¸ªä¸‹è½½æŒ‰é’® -->
                            <button id="downloadAllBtn" class="btn btn-success">
                                <span>ğŸ“</span> ä¸‹è½½æ˜æ–‡è®¢é˜…æ–‡ä»¶
                            </button>
                        </div>
                    </div>

                    <!-- æœ¬åœ°Base64æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="local-base64-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Base64è®¢é˜…ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰</h3>
                            <button id="copyLocalBase64Btn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="localBase64Output" class="result-content empty">Base64è®¢é˜…å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                        <div class="help-text">
                            æ­¤Base64å¯ç›´æ¥ä½œä¸ºè®¢é˜…é“¾æ¥å¯¼å…¥Clashã€Shadowrocketç­‰å·¥å…·
                        </div>
                    </div>

                    <!-- åˆå¹¶ç»“æœæ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="merged-tab">
                        <div class="result-header">
                            <h3>ğŸ”„ åˆå¹¶ç»“æœé¢„è§ˆï¼ˆæ˜æ–‡ï¼‰</h3>
                            <button id="copyMergedBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶æ˜æ–‡
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="mergedResult" class="result-content empty">åˆå¹¶åçš„èŠ‚ç‚¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                    </div>

                    <!-- åˆå¹¶Base64è®¢é˜…æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="auto-base64-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Base64è®¢é˜…ï¼ˆæœ¬åœ°+è¿œç¨‹åˆå¹¶ï¼‰</h3>
                            <button id="copyAutoBase64Btn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="autoBase64Output" class="result-content empty">åˆå¹¶å»é‡åå°†è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…å†…å®¹...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GitHubåŒæ­¥å¡ç‰‡ - æ¬¡å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ™</span>
                        GitHubè®¢é˜…åŒæ­¥
                        <span class="node-counter" id="syncNodeCount">0èŠ‚ç‚¹</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="github-config">
                        <!-- GitHubé…ç½®å¸®åŠ©æ–‡æœ¬ - æ”¾åœ¨å³ä¸Šè§’ -->
                        <div class="github-config-help">
                            GitHub APIä»¤ç‰Œ <a href="https://github.com/settings/tokens" target="_blank">è·å–ä»¤ç‰Œ</a>:éœ€repoæƒé™
                            <a href="#" onclick="copyGitToken()">å¤åˆ¶ä»¤ç‰Œ</a>
                        </div>

                        <div class="section-title">
                            <span>ğŸ”§ GitHubé…ç½®</span>
                        </div>

                        <!-- GitHubä¸‰ä¸ªé…ç½®é¡¹åœ¨ä¸€è¡Œæ˜¾ç¤º -->
                        <div class="github-config-row">
                            <div class="form-group">
                                <div class="token-label-container">
                                    <label for="githubToken" class="token-label">GitHubä»¤ç‰Œï¼š</label>
                                    <!-- ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨ - ä¿®æ”¹ä¸ºå°æ–‡å­—æ˜¾ç¤ºåœ¨æ ‡ç­¾å³ä¾§ -->
                                    <label class="token-save-label" for="saveToken">
                                        <input type="checkbox" id="saveToken" checked>
                                        ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨
                                    </label>
                                </div>
                                <input type="password" id="githubToken" placeholder="ghp_XXXXXXXXXXXXXXXXXXXX">
                            </div>

                            <div class="form-group">
                                <label for="githubRepo">GitHubä»“åº“ï¼š</label>
                                <input type="text" id="githubRepo" value="DaiZhouHui/CustomNode">
                            </div>

                            <div class="form-group">
                                <label for="githubBranch">åˆ†æ”¯ï¼š</label>
                                <input type="text" id="githubBranch" value="main">
                            </div>
                        </div>

                        <!-- æ–°å¢ï¼šä¼˜é€‰è®¢é˜…æ–‡ä»¶ã€ä¸»è¦è®¢é˜…æ–‡ä»¶ã€æ˜æ–‡è®¢é˜…æ–‡ä»¶ -->
                        <div class="config-row">
                            <div class="form-group">
                                <label for="optimalNodeFile">ä¼˜é€‰è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="optimalNodeFile" value="OptimalNode">
                            </div>

                            <div class="form-group">
                                <label for="mainNodeFile">ä¸»è¦è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="mainNodeFile" value="MainNode">
                            </div>

                            <div class="form-group">
                                <label for="plainNodeFile">æ˜æ–‡è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="plainNodeFile" value="PlainNode">
                            </div>
                        </div>

                        <!-- è·¯å¾„é€‰æ‹©è¡Œ - ä¸¤ä¸ªé€‰æ‹©æ¡†åœ¨åŒä¸€è¡Œ -->
                        <div class="path-select-row">
                            <div class="form-group">
                                <label for="downloadUrlSelect">ä¸‹è½½è¿œç¨‹è®¢é˜…è·¯å¾„ï¼š</label>
                                <select id="downloadUrlSelect">
                                    <option value="MainNode">MainNodeï¼ˆä¸»è¦è®¢é˜…ï¼‰</option>
                                    <option value="OptimalNode">OptimalNodeï¼ˆä¼˜é€‰è®¢é˜…ï¼‰</option>
                                    <option value="PlainNode">PlainNodeï¼ˆæ˜æ–‡è®¢é˜…ï¼‰</option>
                                    <option value="custom">è‡ªå®šä¹‰è·¯å¾„</option>
                                </select>
                                <input type="text" id="customDownloadUrl" class="custom-url-input"
                                    placeholder="è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œå¦‚ï¼šOtherNode">
                                <div class="help-text">é€‰æ‹©è¦ä¸‹è½½çš„è¿œç¨‹è®¢é˜…æ–‡ä»¶è·¯å¾„</div>
                            </div>

                            <div class="form-group">
                                <label for="uploadPathSelect">è®¢é˜…å¾…ä¸Šä¼ è·¯å¾„ï¼š</label>
                                <select id="uploadPathSelect">
                                    <option value="OptimalNode">OptimalNodeï¼ˆä¼˜é€‰è®¢é˜…ï¼‰</option>
                                    <option value="MainNode">MainNodeï¼ˆä¸»è¦è®¢é˜…ï¼‰</option>
                                    <option value="PlainNode">PlainNodeï¼ˆæ˜æ–‡è®¢é˜…ï¼‰</option>
                                    <option value="custom">è‡ªå®šä¹‰è·¯å¾„</option>
                                </select>
                                <input type="text" id="customUploadPath" class="custom-url-input"
                                    placeholder="è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œå¦‚ï¼šOtherNode">
                                <div class="help-text">é€‰æ‹©è®¢é˜…çš„å¾…ä¸Šä¼ åˆ°è¿œç¨‹çš„è·¯å¾„</div>
                            </div>
                        </div>
                    </div>

                    <!-- GitHubæ“ä½œæŒ‰é’® - é‡æ–°è°ƒæ•´å¸ƒå±€ -->
                    <div class="github-buttons">
                        <!-- ç¬¬ä¸€è¡Œï¼šä¸‰ä¸ªæŒ‰é’® -->
                        <div class="github-buttons-row1">
                            <button id="downloadSubBtn" class="btn btn-primary">
                                <span>â¬‡ï¸</span> ä¸‹è½½è¿œç¨‹è®¢é˜…
                            </button>
                            <button id="mergeBtn" class="btn btn-success">
                                <span>ğŸ”„</span> æœ¬åœ°ä¸è¿œç¨‹åˆå¹¶å»é‡
                            </button>
                            <button id="uploadLocalBase64ToPathBtn" class="btn btn-local-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ æœ¬åœ°è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
                            </button>
                        </div>

                        <!-- ç¬¬äºŒè¡Œï¼šä¸‰ä¸ªæŒ‰é’® -->
                        <div class="github-buttons-row2">
                            <button id="uploadMergedOptimalBtn" class="btn btn-upload-merged">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…
                            </button>
                            <button id="uploadMergedBase64Btn" class="btn btn-subscription-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶çš„ä¸»è¦è®¢é˜…
                            </button>
                            <button id="uploadPlainNodesBtn" class="btn btn-merge-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…
                            </button>
                        </div>

                        <!-- ç¬¬ä¸‰è¡Œï¼šæ–°å¢"ä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„"å’Œ"ä¸€é”®åŒæ­¥"æŒ‰é’® -->
                        <div class="github-buttons-row3">
                            <button id="uploadMergedToPathBtn" class="btn btn-merge-to-path btn-block">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
                            </button>
                            <button id="syncBtn" class="btn btn-oneclick-sync btn-block">
                                <span>ğŸš€</span> ä¸€é”®åŒæ­¥ï¼ˆå…¨éƒ¨ä¸Šä¼ ï¼‰
                            </button>
                        </div>
                    </div>

                    <!-- GitHubç»Ÿè®¡ -->
                    <div class="github-stats" id="githubStats" style="display: none;">
                        <div class="stat-item">
                            <span class="stat-label">æœ¬åœ°èŠ‚ç‚¹</span>
                            <span class="stat-value" id="localNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">è¿œç¨‹èŠ‚ç‚¹</span>
                            <span class="stat-value" id="remoteNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">åˆå¹¶èŠ‚ç‚¹</span>
                            <span class="stat-value" id="mergedNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å»é‡åèŠ‚ç‚¹</span>
                            <span class="stat-value" id="uniqueNodes">0</span>
                        </div>
                    </div>

                    <!-- æ—¥å¿—è®°å½•åŒºåŸŸ -->
                    <div class="log-section" id="logSection">
                        <div class="log-header">
                            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
                            <div class="log-controls">
                                <button id="clearLogBtn" class="btn btn-info"
                                    style="padding: 6px 12px; font-size: 12px;">
                                    <span>ğŸ—‘ï¸</span> æ¸…ç©ºæ—¥å¿—
                                </button>
                                <button id="toggleLogBtn" class="btn btn-info"
                                    style="padding: 6px 12px; font-size: 12px;">
                                    <span>ğŸ“‹</span> æ”¶èµ·æ—¥å¿—
                                </button>
                            </div>
                        </div>
                        <div class="log-content" id="logContent">
                            <div class="log-entry">
                                <span class="log-time" id="logTime">[ç³»ç»Ÿå¯åŠ¨]</span>
                                <span class="log-level info">ä¿¡æ¯</span>
                                <span class="log-message">VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·å·²å¯åŠ¨</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ‰‹åŠ¨è½¬æ¢å¡ç‰‡ - æœ€å°‘ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ”„</span>
                        æ‰‹åŠ¨Vlessè½¬Base64å·¥å…·
                    </h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="manualVlessInput">ç²˜è´´VlessèŠ‚ç‚¹ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea id="manualVlessInput" placeholder="ç²˜è´´vless://å¼€å¤´çš„èŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="convertToBase64Btn" class="btn btn-success">
                            <span>ğŸ”—</span> è½¬æ¢ä¸ºBase64
                        </button>
                        <button id="copyManualBase64Btn" class="btn btn-info">
                            <span>ğŸ“‹</span> å¤åˆ¶Base64
                        </button>
                    </div>
                    <div class="result-box" id="manualBase64Section" style="display: none; margin-top: 12px;">
                        <div class="result-header">
                            <h3>æ‰‹åŠ¨è½¬æ¢çš„Base64è®¢é˜…</h3>
                        </div>
                        <div id="manualBase64Output" class="result-content empty">Base64å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Â© 2025 VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…· 4.0 ä¼˜åŒ–ç‰ˆ</p>
        </div>
    </div>
    <script>
        // å…¨å±€æ•°æ®
        let data = {
            vlessLinks: [],
            localBase64Content: '',  // æœ¬åœ°ç”Ÿæˆè‡ªåŠ¨Base64
            autoBase64Content: '',   // åˆå¹¶åè‡ªåŠ¨Base64
            manualBase64Content: '', // æ‰‹åŠ¨è½¬æ¢Base64
            remoteNodes: [],
            uniqueNodes: [],
            nodeSha: null,
            plainSha: null,
            optimalSha: null, // æ–°å¢ï¼šä¼˜é€‰è®¢é˜…æ–‡ä»¶çš„sha
            locationSha: null, // æœ¬åœ°ç”ŸæˆBase64æ–‡ä»¶çš„sha
            stats: { local: 0, remote: 0, merged: 0, unique: 0 },
            currentSource: 'none',
            // æ–°å¢ï¼šç¼“å­˜ç®¡ç†æ•°æ®
            cache: {
                remoteNodes: [],      // è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜
                lastDownloadTime: 0,  // ä¸Šæ¬¡ä¸‹è½½æ—¶é—´æˆ³
                downloadPath: '',     // ä¸Šæ¬¡ä¸‹è½½çš„è·¯å¾„
                needsUpdate: false,   // æ ‡è®°ç¼“å­˜æ˜¯å¦éœ€è¦æ›´æ–°
                lastLocalGeneration: 0 // ä¸Šæ¬¡æœ¬åœ°ç”ŸæˆèŠ‚ç‚¹æ—¶é—´
            }
        };

        // æ–°å¢ï¼šæ—¥å¿—æ•°æ®
        let logData = {
            entries: [],
            maxEntries: 50
        };

        // æ–°å¢ï¼šé€šçŸ¥æ•°æ®
        let notifications = {
            active: [],
            maxNotifications: 5
        };

        // æ–°å¢ï¼šç¼“å­˜æ—¶é—´æˆ³
        let lastDownloadTimestamp = 0;
        const DOWNLOAD_CACHE_TIME = 2000; // 2ç§’ç¼“å­˜æ—¶é—´

        // æ–°å¢ï¼šç¡®è®¤å¯¹è¯æ¡†é”®ç›˜äº‹ä»¶å¤„ç†å™¨
        let dialogKeyHandler = null;

        document.addEventListener('DOMContentLoaded', () => {
            initDragDrop();
            initEvents();
            loadSavedToken();
            updateStats();
            addLog('ç³»ç»Ÿå¯åŠ¨', 'VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·å·²å¯åŠ¨ï¼Œæ¬¢è¿ä½¿ç”¨ï¼', 'info');
            initTabs();
            initAccordion();
            initHeaderToggle();

            // åˆå§‹åŒ–ç²˜è´´è¾“å…¥æ¡†çŠ¶æ€
            updateCSVInputState();

            // åˆå§‹åŒ–ä¸Šä¼ è·¯å¾„é€‰æ‹©
            initUploadPathSelect();

            // æ˜¾ç¤ºåˆå§‹åŒ–æç¤º
            // showNotification('æ¬¢è¿', 'VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·4.0å·²å¯åŠ¨ï¼Œè¯·å…ˆé…ç½®GitHubä»¤ç‰Œæˆ–ä¸Šä¼ CSVæ•°æ®', 'info');

            // è‡ªåŠ¨éšè—æ ‡é¢˜æç¤º
            setTimeout(() => {
                const headerInfo = document.getElementById('headerInfo');
                if (headerInfo && !headerInfo.classList.contains('hidden')) {
                    headerInfo.classList.add('hidden');
                    // showNotification('æç¤º', 'æ ‡é¢˜å·²è‡ªåŠ¨éšè—ï¼Œç‚¹å‡»å³ä¸Šè§’"æ˜¾ç¤º/éšè—æ ‡é¢˜"æŒ‰é’®å¯é‡æ–°æ˜¾ç¤º', 'info');
                }
            }, 5000);
        });

        // é€šç”¨ä¸Šä¼ å‡½æ•°ï¼ŒåŒ…å«SHAé‡è¯•é€»è¾‘
        async function uploadToGitHub(fileName, content, isBase64 = false, customMessage = '') {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                throw new Error('ç¼ºå°‘GitHub Tokenï¼Œè¯·å…ˆåœ¨GitHubé…ç½®ä¸­è¾“å…¥æœ‰æ•ˆçš„ä»¤ç‰Œ');
            }

            const repo = document.getElementById('githubRepo').value.trim();
            if (!repo) {
                throw new Error('GitHubä»“åº“åç§°ä¸èƒ½ä¸ºç©º');
            }

            const branch = document.getElementById('githubBranch').value.trim() || 'main';

            // è®°å½•åŸå§‹æ“ä½œ
            const originalFileName = fileName;
            const isRetry = customMessage.includes('[é‡è¯•]');

            // æ­¥éª¤1: å°è¯•è·å–æœ€æ–°çš„SHAå€¼
            let fileSha = null;
            let retryCount = 0;
            const maxRetries = 2;

            while (retryCount <= maxRetries) {
                try {
                    // æ¸…é™¤å¯èƒ½çš„ç¼“å­˜ï¼Œä½¿ç”¨æ—¶é—´æˆ³
                    const timestamp = Date.now();
                    const checkUrl = `https://api.github.com/repos/${repo}/contents/${fileName}?ref=${branch}&t=${timestamp}`;

                    const checkRes = await fetch(checkUrl, {
                        headers: {
                            Authorization: `token ${token}`,
                            Accept: 'application/vnd.github.v3+json'
                        }
                    });

                    if (checkRes.ok) {
                        const json = await checkRes.json();
                        fileSha = json.sha;
                        console.log(`âœ… è·å–åˆ° ${fileName} çš„æœ€æ–°SHA: ${fileSha.substring(0, 8)}...`);
                        break; // æˆåŠŸè·å–SHAï¼Œé€€å‡ºå¾ªç¯
                    } else if (checkRes.status === 404) {
                        console.log(`ğŸ“„ ${fileName} æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶`);
                        fileSha = null;
                        break; // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé€€å‡ºå¾ªç¯
                    } else {
                        const err = await checkRes.json();
                        console.warn(`âš ï¸ è·å– ${fileName} SHA å¤±è´¥(${checkRes.status}):`, err.message);

                        // å¦‚æœæ˜¯403æˆ–429é”™è¯¯ï¼Œå¯èƒ½æ˜¯é€Ÿç‡é™åˆ¶ï¼Œç­‰å¾…åé‡è¯•
                        if ((checkRes.status === 403 || checkRes.status === 429) && retryCount < maxRetries) {
                            retryCount++;
                            const waitTime = 2000 * retryCount;
                            console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else {
                            // å…¶ä»–é”™è¯¯ï¼ŒæŠ›å‡ºå¼‚å¸¸
                            throw new Error(`è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥: ${err.message || checkRes.statusText}`);
                        }
                    }
                } catch (e) {
                    console.error(`âŒ è·å– ${fileName} SHA æ—¶å‡ºé”™:`, e);
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const waitTime = 1000 * retryCount;
                        console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    } else {
                        throw e;
                    }
                }
            }

            // æ­¥éª¤2: å‡†å¤‡ä¸Šä¼ æ•°æ®
            const defaultMessage = isRetry
                ? `[é‡è¯•]ä¸Šä¼ æ–‡ä»¶ ${fileName} - ${new Date().toLocaleString()}`
                : `ä¸Šä¼ æ–‡ä»¶ ${fileName} - ${new Date().toLocaleString()}`;

            const message = customMessage || defaultMessage;

            const body = {
                message: message,
                content: content,
                branch: branch
            };

            // åªæœ‰å½“æ–‡ä»¶å·²å­˜åœ¨ä¸”æœ‰æœ‰æ•ˆçš„SHAæ—¶æ‰æ·»åŠ shaå‚æ•°
            if (fileSha) {
                body.sha = fileSha;
            }

            // æ­¥éª¤3: æ‰§è¡Œä¸Šä¼ 
            retryCount = 0;
            while (retryCount <= maxRetries) {
                try {
                    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                        method: 'PUT',
                        headers: {
                            Authorization: `token ${token}`,
                            Accept: 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (res.ok) {
                        const result = await res.json();
                        console.log(`âœ… ${fileName} ä¸Šä¼ æˆåŠŸï¼Œæ–°SHA: ${result.content.sha.substring(0, 8)}...`);
                        return { success: true, sha: result.content.sha, isNew: !fileSha };
                    } else {
                        const err = await res.json();
                        console.error(`âŒ ${fileName} ä¸Šä¼ å¤±è´¥(${res.status}):`, err);

                        // å¤„ç†ç‰¹å®šçš„é”™è¯¯ç±»å‹
                        if (err.message && err.message.includes('does not match') && retryCount < maxRetries) {
                            // SHAä¸åŒ¹é…ï¼Œéœ€è¦é‡æ–°è·å–SHAå¹¶é‡è¯•
                            console.log(`âš ï¸ ${fileName} SHAä¸åŒ¹é…ï¼Œé‡æ–°è·å–SHAå¹¶é‡è¯•...`);

                            // å¼ºåˆ¶é‡æ–°è·å–SHAï¼ˆè·³è¿‡ç¼“å­˜ï¼‰
                            const timestamp = Date.now();
                            const retryCheckUrl = `https://api.github.com/repos/${repo}/contents/${fileName}?ref=${branch}&t=${timestamp}&force=true`;

                            const retryCheckRes = await fetch(retryCheckUrl, {
                                headers: {
                                    Authorization: `token ${token}`,
                                    Accept: 'application/vnd.github.v3+json'
                                }
                            });

                            if (retryCheckRes.ok) {
                                const retryJson = await retryCheckRes.json();
                                body.sha = retryJson.sha; // æ›´æ–°SHA
                                console.log(`âœ… é‡è¯•è·å–åˆ° ${fileName} çš„æ–°SHA: ${retryJson.sha.substring(0, 8)}...`);
                            } else {
                                // å¦‚æœè·å–å¤±è´¥ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶å·²è¢«åˆ é™¤ï¼Œç§»é™¤SHAå°è¯•åˆ›å»ºæ–°æ–‡ä»¶
                                console.log(`ğŸ“„ ${fileName} å¯èƒ½å·²è¢«åˆ é™¤ï¼Œå°è¯•åˆ›å»ºæ–°æ–‡ä»¶`);
                                delete body.sha;
                            }

                            // æ›´æ–°æ¶ˆæ¯ï¼Œæ ‡è®°ä¸ºé‡è¯•
                            body.message = `[é‡è¯•]${message}`;

                            retryCount++;
                            const waitTime = 1000 * retryCount;
                            console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•ä¸Šä¼ ...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else if ((res.status === 403 || res.status === 429) && retryCount < maxRetries) {
                            // GitHub APIé™åˆ¶ï¼Œç­‰å¾…åé‡è¯•
                            retryCount++;
                            const waitTime = 3000 * retryCount;
                            console.log(`â³ GitHub APIé™åˆ¶ï¼Œç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else {
                            throw new Error(`${fileName} ä¸Šä¼ å¤±è´¥: ${err.message || res.statusText}`);
                        }
                    }
                } catch (e) {
                    console.error(`âŒ ${fileName} ä¸Šä¼ å¼‚å¸¸:`, e);
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const waitTime = 2000 * retryCount;
                        console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•ä¸Šä¼ ...`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    } else {
                        throw e;
                    }
                }
            }

            throw new Error(`${fileName} ä¸Šä¼ å¤±è´¥ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°`);
        }

        function initEvents() {
            document.getElementById('fileInput').addEventListener('change', e => e.target.files[0] && handleFile(e.target.files[0]));
            document.getElementById('removeFileBtn').addEventListener('click', removeFile);
            document.getElementById('generateBtn').addEventListener('click', generateVless);
            document.getElementById('copyVlessBtn').addEventListener('click', () => copyText(data.vlessLinks.join('\n')));
            // ç§»é™¤downloadVlessBtnäº‹ä»¶ç›‘å¬ï¼Œåªä¿ç•™downloadAllBtn
            document.getElementById('downloadAllBtn').addEventListener('click', downloadAll);
            document.getElementById('downloadSubBtn').addEventListener('click', () => {
                // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°ä¸‹è½½
                const now = Date.now();
                if (now - lastDownloadTimestamp > DOWNLOAD_CACHE_TIME) {
                    // å¦‚æœè·ç¦»ä¸Šæ¬¡ä¸‹è½½è¶…è¿‡2ç§’ï¼Œæ¸…é™¤ç¼“å­˜
                    data.remoteNodes = [];
                    data.nodeSha = null;
                    data.plainSha = null;
                    data.optimalSha = null;
                    updateStats();
                }
                lastDownloadTimestamp = now;
                downloadRemote();
            });
            document.getElementById('mergeBtn').addEventListener('click', () => {
                validateAndMerge();
            });
            document.getElementById('syncBtn').addEventListener('click', oneClickSync);
            document.getElementById('copyMergedBtn').addEventListener('click', () => copyText(data.uniqueNodes.join('\n')));
            document.getElementById('copyLocalBase64Btn').addEventListener('click', () => copyText(data.localBase64Content));
            document.getElementById('copyAutoBase64Btn').addEventListener('click', () => copyText(data.autoBase64Content));
            document.getElementById('convertToBase64Btn').addEventListener('click', convertManualToBase64);
            document.getElementById('copyManualBase64Btn').addEventListener('click', () => copyText(data.manualBase64Content));

            // åŸæœ‰çš„å››ä¸ªä¸Šä¼ æŒ‰é’® - æ·»åŠ ç¡®è®¤æç¤º
            document.getElementById('uploadLocalBase64ToPathBtn').addEventListener('click', () => {
                validateAndUpload('uploadLocalBase64ToPath');
            });
            document.getElementById('uploadPlainNodesBtn').addEventListener('click', () => {
                validateAndUpload('uploadPlainNodes');
            });
            document.getElementById('uploadMergedBase64Btn').addEventListener('click', () => {
                validateAndUpload('uploadMergedBase64');
            });
            document.getElementById('uploadMergedOptimalBtn').addEventListener('click', () => {
                validateAndUpload('uploadMergedOptimal');
            });

            // æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„æŒ‰é’®
            document.getElementById('uploadMergedToPathBtn').addEventListener('click', () => {
                validateAndUpload('uploadMergedToPath');
            });

            // æ–°å¢ï¼šä¸‹è½½è·¯å¾„é€‰æ‹©äº‹ä»¶
            document.getElementById('downloadUrlSelect').addEventListener('change', function () {
                const customInput = document.getElementById('customDownloadUrl');
                customInput.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customInput.value = '';
                }
            });

            // æ–°å¢ï¼šä¸Šä¼ è·¯å¾„é€‰æ‹©äº‹ä»¶
            document.getElementById('uploadPathSelect').addEventListener('change', function () {
                const customInput = document.getElementById('customUploadPath');
                customInput.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customInput.value = '';
                }
            });

            // æ–°å¢ï¼šæ—¥å¿—æ§åˆ¶æŒ‰é’®äº‹ä»¶
            document.getElementById('clearLogBtn').addEventListener('click', clearLog);
            document.getElementById('toggleLogBtn').addEventListener('click', toggleLog);

            // ä¿®å¤ï¼šç²˜è´´CSVå†…å®¹ç”ŸæˆèŠ‚ç‚¹çš„åŠŸèƒ½
            let csvTimer;
            document.getElementById('csvInput').addEventListener('input', () => {
                clearTimeout(csvTimer);
                // å½“ç”¨æˆ·åœæ­¢è¾“å…¥1ç§’åè‡ªåŠ¨ç”Ÿæˆ
                csvTimer = setTimeout(() => {
                    if (data.currentSource !== 'file') {
                        generateVless();
                    }
                }, 1000);
            });

            // ä¿®å¤ï¼šå½“åˆ‡æ¢åˆ°ç²˜è´´æ ‡ç­¾é¡µæ—¶ï¼Œå¦‚æœå·²æœ‰å†…å®¹ï¼Œè‡ªåŠ¨ç”Ÿæˆ
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('card-tab-btn') && e.target.getAttribute('data-tab') === 'paste-tab') {
                    const csvInput = document.getElementById('csvInput');
                    if (csvInput.value.trim() && data.currentSource !== 'file') {
                        generateVless();
                    }
                }
            });
        }

        // æ¸…é™¤è¿œç¨‹ç¼“å­˜å‡½æ•°
        function clearRemoteCache() {
            data.remoteNodes = [];
            data.nodeSha = null;
            data.plainSha = null;
            data.optimalSha = null;
            data.locationSha = null;
            updateStats();
            console.log('ğŸ—‘ï¸ è¿œç¨‹ç¼“å­˜å·²æ¸…é™¤');
            addLog('ç¼“å­˜æ¸…ç†', 'è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜å·²æ¸…é™¤', 'info');
        }

        // æ˜æ–‡è®¢é˜…ä¸Šä¼ 
        async function uploadPlainNodes() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('é”™è¯¯', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    plainNodeFile,
                    btoa(plainText),
                    false,
                    `ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…åˆ° ${plainNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºæ˜æ–‡èŠ‚ç‚¹æ–‡ä»¶ ${plainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°æ˜æ–‡èŠ‚ç‚¹æ–‡ä»¶ ${plainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // åˆå§‹åŒ–ä¸Šä¼ è·¯å¾„é€‰æ‹©
        function initUploadPathSelect() {
            const uploadPathSelect = document.getElementById('uploadPathSelect');
            const customUploadPath = document.getElementById('customUploadPath');

            uploadPathSelect.addEventListener('change', function () {
                customUploadPath.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customUploadPath.value = '';
                }
            });
        }

        // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
        function updateCSVInputState() {
            const csvInput = document.getElementById('csvInput');
            const pasteTabBtn = document.querySelector('.card-tab-btn[data-tab="paste-tab"]');

            if (data.currentSource === 'file') {
                // æœ‰æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œç¦ç”¨ç²˜è´´è¾“å…¥æ¡†
                csvInput.disabled = true;
                csvInput.placeholder = "å·²ä¸Šä¼ æ–‡ä»¶ï¼Œç²˜è´´åŠŸèƒ½å·²ç¦ç”¨ã€‚è¯·å…ˆç§»é™¤æ–‡ä»¶ã€‚";
                pasteTabBtn.style.opacity = "0.6";
                pasteTabBtn.style.cursor = "not-allowed";
            } else {
                // æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œå¯ç”¨ç²˜è´´è¾“å…¥æ¡†
                csvInput.disabled = false;
                csvInput.placeholder = "æ”¯æŒå¤šç§æ ¼å¼ï¼Œæ™ºèƒ½åˆ†å‰²ï¼š\n1. å•è¡Œæˆ–å¤šè¡Œæ ¼å¼ï¼ˆå†’å·,é€—å·ï¼Œç©ºæ ¼åˆ†éš”ï¼‰ï¼š\n2. ç´§å‡‘æ ¼å¼ï¼ˆä¸€è¡Œå¤šä¸ªï¼‰ï¼š\n3. æ··åˆåˆ†éš”ç¬¦ï¼š\n4. åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰ï¼š";
                pasteTabBtn.style.opacity = "1";
                pasteTabBtn.style.cursor = "pointer";
            }
        }

        // åˆå§‹åŒ–æ ‡ç­¾é¡µ - ä¿®å¤ï¼šç¡®ä¿æ¯ä¸ªå¡ç‰‡çš„æ ‡ç­¾é¡µç‹¬ç«‹
        function initTabs() {
            // ä¸ºæ¯ä¸ªå¡ç‰‡çš„æ ‡ç­¾é¡µåˆ†åˆ«åˆå§‹åŒ–
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const tabButtons = card.querySelectorAll('.card-tab-btn');
                if (tabButtons.length > 0) {
                    tabButtons.forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                            const cardBody = button.closest('.card-body');
                            const tabId = button.getAttribute('data-tab');

                            // åªåœ¨å½“å‰å¡ç‰‡å†…éƒ¨åˆ‡æ¢
                            const allTabBtns = cardBody.querySelectorAll('.card-tab-btn');
                            const allTabContents = cardBody.querySelectorAll('.card-tab-content');

                            allTabBtns.forEach(btn => btn.classList.remove('active'));
                            allTabContents.forEach(content => content.classList.remove('active'));

                            button.classList.add('active');
                            const targetTab = cardBody.querySelector(`#${tabId}`);
                            if (targetTab) {
                                targetTab.classList.add('active');
                            }
                        });
                    });
                }
            });
        }

        // åˆå§‹åŒ–æŠ˜å é¢æ¿
        function initAccordion() {
            const accordionToggle = document.getElementById('advancedConfigToggle');
            const accordionContent = document.getElementById('advancedConfigContent');

            accordionToggle.addEventListener('click', () => {
                accordionToggle.classList.toggle('active');
                accordionContent.classList.toggle('show');
            });
        }

        // åˆå§‹åŒ–æ ‡é¢˜æ˜¾ç¤º/éšè—
        function initHeaderToggle() {
            const toggleBtn = document.getElementById('toggleHeaderBtn');
            const headerInfo = document.getElementById('headerInfo');

            toggleBtn.addEventListener('click', () => {
                if (headerInfo.classList.contains('hidden')) {
                    headerInfo.classList.remove('hidden');
                    toggleBtn.textContent = 'éšè—';
                    showNotification('æç¤º', 'æ ‡é¢˜å·²æ˜¾ç¤º', 'info');
                } else {
                    headerInfo.classList.add('hidden');
                    toggleBtn.textContent = 'æ˜¾ç¤º';
                    showNotification('æç¤º', 'æ ‡é¢˜å·²éšè—', 'info');
                }
            });
        }

        function initDragDrop() {
            const area = document.getElementById('dropArea');

            // ä¿®å¤ï¼šç¡®ä¿æ‹–æ‹½åŠŸèƒ½æ­£å¸¸å·¥ä½œ
            ['dragenter', 'dragover'].forEach(e => {
                area.addEventListener(e, (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    area.classList.add('dragover');
                });
            });

            ['dragleave', 'drop'].forEach(e => {
                area.addEventListener(e, (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    area.classList.remove('dragover');
                });
            });

            // ä¿®å¤ï¼šæ­£ç¡®å¤„ç†dropäº‹ä»¶
            area.addEventListener('drop', e => {
                e.preventDefault();
                e.stopPropagation();
                const files = e.dataTransfer.files;
                if (files && files.length > 0) {
                    handleFile(files[0]);
                }
            });

            area.addEventListener('click', () => document.getElementById('fileInput').click());
        }

        function handleFile(file) {
            if (!/\.(csv|txt)$/i.test(file.name)) {
                showNotification('æ–‡ä»¶é”™è¯¯', 'è¯·ä¸Šä¼ CSVæˆ–TXTæ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ', 'error');
                addLog('æ–‡ä»¶æ“ä½œ', `æ–‡ä»¶æ ¼å¼é”™è¯¯: ${file.name}`, 'error');
                return;
            }

            // ä¿®å¤ï¼šç¡®ä¿æ–‡ä»¶è¢«æ­£ç¡®è®¾ç½®åˆ°fileInputå…ƒç´ 
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            document.getElementById('fileInput').files = dataTransfer.files;

            const reader = new FileReader();
            reader.onload = e => {
                data.currentSource = 'file';
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatSize(file.size);
                document.getElementById('fileInfo').classList.add('show');
                document.getElementById('csvInput').value = '';
                updateSourceBadge();
                // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
                updateCSVInputState();

                // ä¿®å¤ï¼šæ–‡ä»¶ä¸Šä¼ åè‡ªåŠ¨ç”ŸæˆèŠ‚ç‚¹
                setTimeout(() => {
                    generateVless();
                }, 100);

                // showNotification('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ', `æˆåŠŸåŠ è½½æ–‡ä»¶: ${file.name} (${formatSize(file.size)})`, 'success');
                addLog('æ–‡ä»¶æ“ä½œ', `æˆåŠŸä¸Šä¼ æ–‡ä»¶: ${file.name}`, 'success');
            };
            reader.onerror = e => {
                showNotification('æ–‡ä»¶è¯»å–å¤±è´¥', 'æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸåæˆ–é‡æ–°ä¸Šä¼ ', 'error');
                addLog('æ–‡ä»¶æ“ä½œ', `æ–‡ä»¶è¯»å–å¤±è´¥: ${file.name} - ${e.message}`, 'error');
            };
            reader.readAsText(file);
        }

        function removeFile() {
            data.currentSource = 'none';
            document.getElementById('fileInfo').classList.remove('show');
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('fileSize').textContent = '';
            updateSourceBadge();
            // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
            updateCSVInputState();
            // showNotification('æ–‡ä»¶å·²ç§»é™¤', 'å·²æˆåŠŸç§»é™¤ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¯ä»¥ç»§ç»­ç²˜è´´å†…å®¹æˆ–ä¸Šä¼ æ–°æ–‡ä»¶', 'info');
            addLog('æ–‡ä»¶æ“ä½œ', 'å·²ç§»é™¤ä¸Šä¼ çš„æ–‡ä»¶', 'info');

            // æ¸…ç©ºç”Ÿæˆç»“æœ
            data.vlessLinks = [];
            data.localBase64Content = '';
            data.autoBase64Content = '';
            displayVlessLinks();
            document.getElementById('localBase64Output').textContent = 'Base64è®¢é˜…å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            document.getElementById('localBase64Output').classList.add('empty');
            document.getElementById('autoBase64Output').textContent = 'åˆå¹¶å»é‡åå°†è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…å†…å®¹...';
            document.getElementById('autoBase64Output').classList.add('empty');
            updateStats();
        }

        function updateSourceBadge() {
            const badge = document.getElementById('sourceBadge');
            badge.textContent = data.currentSource === 'file' ? 'å·²ä¸Šä¼ æ–‡ä»¶' : 'ç²˜è´´å†…å®¹';
        }

        async function generateVless() {
            showLoading(true);
            try {
                const config = getConfig();

                let text = '';
                if (data.currentSource === 'file') {
                    const fileInput = document.getElementById('fileInput');
                    if (!fileInput.files || fileInput.files.length === 0) {
                        showNotification('ç”ŸæˆèŠ‚ç‚¹å¤±è´¥', 'è¯·å…ˆä¸Šä¼ CSVæ–‡ä»¶æˆ–ç²˜è´´å†…å®¹', 'error');
                        showLoading(false);
                        return;
                    }
                    const file = fileInput.files[0];
                    text = await readFile(file);
                } else {
                    text = document.getElementById('csvInput').value.trim();
                    if (!text) {
                        showNotification('ç”ŸæˆèŠ‚ç‚¹å¤±è´¥', 'è¯·æä¾›CSVæ•°æ®ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶æˆ–ç²˜è´´å†…å®¹', 'error');
                        showLoading(false);
                        return;
                    }
                }

                data.vlessLinks = parseAndGenerate(text, config);
                data.stats.local = data.vlessLinks.length;
                data.cache.lastLocalGeneration = Date.now();

                // è‡ªåŠ¨ç”Ÿæˆæœ¬åœ°Base64
                if (data.vlessLinks.length > 0) {
                    data.localBase64Content = btoa(data.vlessLinks.join('\n'));
                    document.getElementById('localBase64Output').textContent = data.localBase64Content;
                    document.getElementById('localBase64Output').classList.remove('empty');
                }

                displayVlessLinks();
                updateStats();

                // æ™ºèƒ½æ£€æŸ¥ï¼šå¦‚æœå·²æœ‰è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜ï¼Œè‡ªåŠ¨æç¤ºåˆå¹¶
                if (data.remoteNodes.length > 0 || data.cache.remoteNodes.length > 0) {
                    // å¦‚æœè¿œç¨‹èŠ‚ç‚¹ä¸ºç©ºä½†ç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œæ¢å¤ç¼“å­˜
                    if (data.remoteNodes.length === 0 && data.cache.remoteNodes.length > 0) {
                        data.remoteNodes = [...data.cache.remoteNodes];
                        data.stats.remote = data.remoteNodes.length;
                        updateStats();
                    }

                    // æ˜¾ç¤ºåˆå¹¶æç¤º
                    setTimeout(() => {
                        showNotification('æç¤º', `å·²ç”Ÿæˆ ${data.vlessLinks.length} ä¸ªæœ¬åœ°èŠ‚ç‚¹ï¼Œæ£€æµ‹åˆ° ${data.remoteNodes.length} ä¸ªè¿œç¨‹èŠ‚ç‚¹ï¼Œç‚¹å‡»"åˆå¹¶èŠ‚ç‚¹"æŒ‰é’®è¿›è¡Œåˆå¹¶`, 'info');
                    }, 500);
                }

                showNotification('èŠ‚ç‚¹ç”ŸæˆæˆåŠŸ', `æˆåŠŸç”Ÿæˆ ${data.vlessLinks.length} ä¸ªVlessèŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…`, 'success');
                addLog('ç”ŸæˆèŠ‚ç‚¹', `æˆåŠŸç”Ÿæˆ ${data.vlessLinks.length} ä¸ªVlessèŠ‚ç‚¹`, 'success');
            } catch (e) {
                showNotification('èŠ‚ç‚¹ç”Ÿæˆå¤±è´¥', 'ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ç”ŸæˆèŠ‚ç‚¹', 'ç”Ÿæˆå¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function getConfig() {
            return {
                uuid: "471a8e64-7b21-4703-b1d1-45a221098459",
                host: document.getElementById('host').value.trim() || "knny.dpdns.org",
                sni: document.getElementById('sni').value.trim() || "knny.dpdns.org",
                fp: document.getElementById('fp').value.trim() || "chrome",
                force443: document.getElementById('forcePort443').checked,
                defaultPort: parseInt(document.getElementById('defaultPort').value) || 443,
                prefix: document.getElementById('remarksPrefix').value.trim() || 'è‡ªé€‰',
                autoLoc: document.getElementById('autoLocation').checked,
                ipColumn: parseInt(document.getElementById('ipColumn').value) || 0,
                portColumn: parseInt(document.getElementById('portColumn').value)
            };
        }

        function parseAndGenerate(text, config) {
            // æ™ºèƒ½åˆ†å‰²æ–‡æœ¬ä¸ºIP:ç«¯å£å¯¹ - ä¿®å¤ï¼šæ­£ç¡®å¤„ç†å¤šè¡ŒCSVæ ¼å¼
            const ipPortPairs = smartSplitIPPort(text);
            const nodes = [];
            let locationCounter = {};

            // ä¿®å¤ï¼šç¡®ä¿ä¸é‡å¤ç”ŸæˆèŠ‚ç‚¹
            const seenIPs = new Set();

            ipPortPairs.forEach(pair => {
                const { ip, port } = pair;

                if (!ip) return;

                // ä¿®å¤ï¼šæ£€æŸ¥IPæ˜¯å¦å·²ç»å¤„ç†è¿‡
                if (seenIPs.has(ip)) {
                    console.log(`è·³è¿‡é‡å¤IP: ${ip}`);
                    return;
                }
                seenIPs.add(ip);

                // å¼ºåˆ¶ä½¿ç”¨443ç«¯å£ï¼ˆå¦‚æœå‹¾é€‰äº†æ­¤é€‰é¡¹ï¼‰
                let finalPort = port;
                if (config.force443) {
                    finalPort = 443;
                }
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç«¯å£ï¼Œä½¿ç”¨443ï¼ˆä»…å½“æ²¡æœ‰å‹¾é€‰å¼ºåˆ¶443æ—¶æ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼‰
                else if (!finalPort) {
                    finalPort = 443;
                }

                let remark = '';
                if (config.autoLoc) {
                    const loc = getLocation(ip);
                    const key = loc !== 'æœªçŸ¥' ? loc : config.prefix;
                    locationCounter[key] = (locationCounter[key] || 0) + 1;
                    remark = `${key}${String(locationCounter[key]).padStart(2, '0')}`;
                } else {
                    locationCounter[config.prefix] = (locationCounter[config.prefix] || 0) + 1;
                    remark = `${config.prefix}${String(locationCounter[config.prefix]).padStart(2, '0')}`;
                }

                nodes.push(generateLink(ip, finalPort, config, remark));
            });

            return nodes;
        }

        // æ–°å¢ï¼šæ™ºèƒ½åˆ†å‰²IPå’Œç«¯å£ - ä¿®å¤ï¼šæ”¯æŒå¤šä¸ªç©ºæ ¼åˆ†éš”
        function smartSplitIPPort(text) {
            const result = [];
            const seen = new Set(); // ç”¨äºå»é‡

            // æ›¿æ¢å¸¸è§åˆ†éš”ç¬¦ä¸ºç»Ÿä¸€çš„åˆ†éš”ç¬¦ï¼Œå¤„ç†å¤šä¸ªç©ºæ ¼
            let normalizedText = text.replace(/[,;\s]+/g, ' ');
            normalizedText = normalizedText.replace(/\s+/g, ' '); // å°†å¤šä¸ªç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼

            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…IP:ç«¯å£æˆ–IP ç«¯å£
            // åŒ¹é…æ ¼å¼: IP:ç«¯å£ æˆ– IP ç«¯å£ æˆ– åªæœ‰IP
            // ä¿®å¤ï¼šæ”¯æŒIPå’Œç«¯å£ä¹‹é—´å¤šä¸ªç©ºæ ¼çš„æƒ…å†µ
            const ipPortPattern = /(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?:\s*[:,\s]\s*(\d{1,5}))?/g;

            let match;
            while ((match = ipPortPattern.exec(text)) !== null) {
                const ip = match[1];
                const port = match[2] ? parseInt(match[2]) : null;

                // éªŒè¯IPæœ‰æ•ˆæ€§
                if (!isValidIP(ip)) continue;

                // éªŒè¯ç«¯å£æœ‰æ•ˆæ€§
                if (port !== null && (port < 1 || port > 65535)) continue;

                // å»é‡
                const key = `${ip}:${port || 'default'}`;
                if (!seen.has(key)) {
                    seen.add(key);
                    result.push({ ip, port });
                }
            }

            // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°IP:ç«¯å£æ ¼å¼ï¼Œå°è¯•å…¶ä»–æ ¼å¼
            if (result.length === 0) {
                // åˆ†å‰²æ–‡æœ¬æˆå•è¯
                const words = normalizedText.split(/\s+/).filter(w => w.trim());

                for (let i = 0; i < words.length; i++) {
                    const word = words[i].trim();

                    // æ£€æŸ¥æ˜¯å¦æ˜¯IPåœ°å€
                    if (isValidIP(word)) {
                        const ip = word;
                        let port = null;

                        // æ£€æŸ¥ä¸‹ä¸€ä¸ªå•è¯æ˜¯å¦æ˜¯ç«¯å£
                        if (i + 1 < words.length) {
                            const nextWord = words[i + 1];
                            const possiblePort = parseInt(nextWord);
                            if (!isNaN(possiblePort) && possiblePort >= 1 && possiblePort <= 65535) {
                                port = possiblePort;
                                i++; // è·³è¿‡ç«¯å£å•è¯
                            }
                        }

                        // å»é‡
                        const key = `${ip}:${port || 'default'}`;
                        if (!seen.has(key)) {
                            seen.add(key);
                            result.push({ ip, port });
                        }
                    }
                    // æ£€æŸ¥æ˜¯å¦æ˜¯IP:ç«¯å£æ ¼å¼ï¼ˆå·²å¤„ç†è¿‡ï¼Œä½†è¿™é‡Œä½œä¸ºåå¤‡ï¼‰
                    else if (word.includes(':')) {
                        const parts = word.split(':');
                        if (parts.length === 2) {
                            const ip = parts[0].trim();
                            const portStr = parts[1].trim();

                            if (isValidIP(ip)) {
                                const port = parseInt(portStr);
                                if (!isNaN(port) && port >= 1 && port <= 65535) {
                                    const key = `${ip}:${port}`;
                                    if (!seen.has(key)) {
                                        seen.add(key);
                                        result.push({ ip, port });
                                    }
                                }
                            }
                        }
                    }
                }
            }

            return result;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const next = line[i + 1];

                if (char === '"' && !inQuotes) inQuotes = true;
                else if (char === '"' && inQuotes && next === '"') { current += '"'; i++; }
                else if (char === '"' && inQuotes) inQuotes = false;
                else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; }
                else current += char;
            }
            result.push(current.trim());
            return result;
        }

        function generateLink(ip, port, config, remark) {
            const params = [
                'encryption=none',
                'security=tls',
                `sni=${encodeURIComponent(config.sni)}`,
                `fp=${config.fp}`,
                'type=ws',
                `host=${encodeURIComponent(config.host)}`,
                'path=%2F',
                'alpn=h2%2Chttp%2F1.1',
                'flow='
            ];
            return `vless://${config.uuid}@${ip}:${port}?${params.join('&')}#${encodeURIComponent(remark)}`;
        }

        function displayVlessLinks() {
            const el = document.getElementById('vless-links');
            el.textContent = data.vlessLinks.length ? data.vlessLinks.join('\n\n') : 'Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            el.classList.toggle('empty', data.vlessLinks.length === 0);
            document.getElementById('resultCount').textContent = `${data.vlessLinks.length}èŠ‚ç‚¹`;
            document.getElementById('localNodeCount').textContent = `${data.vlessLinks.length}èŠ‚ç‚¹`;
        }

        function convertManualToBase64() {
            const input = document.getElementById('manualVlessInput').value.trim();
            if (!input) {
                showNotification('è½¬æ¢å¤±è´¥', 'è¯·å…ˆç²˜è´´VlessèŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªvless://å¼€å¤´çš„é“¾æ¥', 'error');
                return;
            }

            const lines = input.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
            if (lines.length === 0) {
                showNotification('è½¬æ¢å¤±è´¥', 'æœªæ£€æµ‹åˆ°æœ‰æ•ˆvlessé“¾æ¥ï¼Œè¯·ç¡®ä¿æ¯è¡Œä»¥vless://å¼€å¤´', 'error');
                return;
            }

            const plain = lines.join('\n');
            data.manualBase64Content = btoa(plain);

            const sec = document.getElementById('manualBase64Section');
            sec.style.display = 'block';
            document.getElementById('manualBase64Output').textContent = data.manualBase64Content;
            document.getElementById('manualBase64Output').classList.remove('empty');

            showNotification('è½¬æ¢æˆåŠŸ', `æˆåŠŸè½¬æ¢ ${lines.length} ä¸ªèŠ‚ç‚¹ä¸ºBase64è®¢é˜…ï¼Œå¯ç”¨äºå¯¼å…¥å®¢æˆ·ç«¯`, 'success');
            addLog('è½¬æ¢èŠ‚ç‚¹', `æˆåŠŸè½¬æ¢ ${lines.length} ä¸ªèŠ‚ç‚¹ä¸ºBase64è®¢é˜…`, 'success');
        }

        // æ–°å¢ï¼šç»Ÿä¸€çš„ç¡®è®¤å¯¹è¯æ¡† - æ›´ç®€æ´å¤§æ°”ï¼Œæ”¯æŒé”®ç›˜å¿«æ·é”®
        function showConfirmDialog(title, message, onConfirm, onCancel = null, type = 'info') {
            // ç§»é™¤å·²å­˜åœ¨çš„å¯¹è¯æ¡†
            const existingDialog = document.querySelector('.custom-dialog-overlay');
            if (existingDialog) {
                existingDialog.remove();
                if (dialogKeyHandler) {
                    document.removeEventListener('keydown', dialogKeyHandler);
                    dialogKeyHandler = null;
                }
            }

            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.className = 'custom-dialog-overlay';

            // æ ¹æ®ç±»å‹è®¾ç½®å›¾æ ‡
            let iconText = '!';
            let dialogClass = '';

            if (type === 'warning') iconText = 'âš ';
            else if (type === 'error') iconText = 'âœ•';
            else if (type === 'success') iconText = 'âœ“';

            if (type !== 'info') dialogClass = ` ${type}`;

            // åˆ›å»ºå¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.className = `custom-dialog${dialogClass}`;
            dialog.tabIndex = -1; // ä½¿å¯¹è¯æ¡†å¯èšç„¦

            dialog.innerHTML = `
            <div class="custom-dialog-header">
                <div class="custom-dialog-icon">${iconText}</div>
                <h3 class="custom-dialog-title">${title}</h3>
            </div>
            <div class="custom-dialog-content">${message}</div>
            <div class="custom-dialog-actions">
                <button class="custom-dialog-btn custom-dialog-btn-cancel" id="dialogCancelBtn">
                    å–æ¶ˆ (ESC)
                </button>
                <button class="custom-dialog-btn custom-dialog-btn-confirm" id="dialogConfirmBtn">
                    ç¡®è®¤ (Enter)
                </button>
            </div>
        `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // å…³é—­å¯¹è¯æ¡†å‡½æ•°
            const closeDialog = (action) => {
                // ç§»é™¤äº‹ä»¶ç›‘å¬
                if (dialogKeyHandler) {
                    document.removeEventListener('keydown', dialogKeyHandler);
                    dialogKeyHandler = null;
                }
                overlay.remove();

                // æ‰§è¡Œç›¸åº”çš„å›è°ƒ
                if (action === 'confirm' && onConfirm) {
                    onConfirm();
                } else if (action === 'cancel' && onCancel) {
                    onCancel();
                }
            };

            // é”®ç›˜äº‹ä»¶å¤„ç†å‡½æ•°
            dialogKeyHandler = (e) => {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    e.stopPropagation();
                    closeDialog('cancel');
                } else if (e.key === 'Enter' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeDialog('confirm');
                }
            };

            // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
            document.addEventListener('keydown', dialogKeyHandler);

            // ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('dialogConfirmBtn').addEventListener('click', () => {
                closeDialog('confirm');
            });

            document.getElementById('dialogCancelBtn').addEventListener('click', () => {
                closeDialog('cancel');
            });

            // ç‚¹å‡»é®ç½©å±‚å…³é—­ï¼ˆç›¸å½“äºå–æ¶ˆï¼‰
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeDialog('cancel');
                }
            });

            // å¯¹è¯æ¡†è·å–ç„¦ç‚¹ï¼Œæ–¹ä¾¿é”®ç›˜æ“ä½œ
            setTimeout(() => {
                dialog.focus();
                document.getElementById('dialogCancelBtn').focus(); // é»˜è®¤ç„¦ç‚¹åœ¨å–æ¶ˆæŒ‰é’®
            }, 100);
        }

        // æ–°å¢ï¼šéªŒè¯å¹¶åˆå¹¶ - æ™ºèƒ½ç¼“å­˜æ£€æŸ¥
        function validateAndMerge() {
            const localCount = data.vlessLinks.length;
            const remoteCount = data.remoteNodes.length;
            const cachedRemoteCount = data.cache.remoteNodes.length;

            // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„èŠ‚ç‚¹æ•°æ®
            if (localCount === 0 && remoteCount === 0 && cachedRemoteCount === 0) {
                showConfirmDialog(
                    'æ— æ³•åˆå¹¶',
                    'æœ¬åœ°å’Œè¿œç¨‹éƒ½æ²¡æœ‰èŠ‚ç‚¹æ•°æ®ï¼Œæ— æ³•è¿›è¡Œåˆå¹¶æ“ä½œã€‚<br><br>è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹æˆ–ä¸‹è½½è¿œç¨‹è®¢é˜…ã€‚',
                    () => {
                        showNotification('æç¤º', 'è¯·å…ˆç”ŸæˆèŠ‚ç‚¹æˆ–ä¸‹è½½è¿œç¨‹è®¢é˜…', 'info');
                    },
                    null,
                    'warning'
                );
                return;
            }

            // æ£€æŸ¥æ˜¯å¦éœ€è¦ä½¿ç”¨ç¼“å­˜æ•°æ®
            if (localCount > 0 && remoteCount === 0 && cachedRemoteCount > 0) {
                showConfirmDialog(
                    'ä½¿ç”¨ç¼“å­˜æ•°æ®',
                    `æœ¬åœ°æœ‰ <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹ï¼Œè¿œç¨‹èŠ‚ç‚¹æ•°æ®ä¸ºç©ºï¼Œä½†ç¼“å­˜ä¸­æœ‰ <strong>${cachedRemoteCount}</strong> ä¸ªè¿œç¨‹èŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ä½¿ç”¨ç¼“å­˜ä¸­çš„è¿œç¨‹èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ï¼Ÿ<br><br>æç¤ºï¼šå¦‚æœç¼“å­˜æ•°æ®å¯èƒ½å·²è¿‡æ—¶ï¼Œå»ºè®®é‡æ–°ä¸‹è½½è¿œç¨‹è®¢é˜…ã€‚`,
                    () => {
                        // ä½¿ç”¨ç¼“å­˜æ•°æ®
                        data.remoteNodes = [...data.cache.remoteNodes];
                        data.stats.remote = data.remoteNodes.length;
                        updateStats();
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ£€æŸ¥æœ¬åœ°èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
            if (localCount === 0 && (remoteCount > 0 || cachedRemoteCount > 0)) {
                const actualRemoteCount = remoteCount > 0 ? remoteCount : cachedRemoteCount;
                showConfirmDialog(
                    'ç¡®è®¤åˆå¹¶',
                    `æœ¬åœ°æ²¡æœ‰ç”ŸæˆèŠ‚ç‚¹ï¼Œä½†æœ‰ <strong>${actualRemoteCount}</strong> ä¸ªè¿œç¨‹èŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ç»§ç»­åˆå¹¶ï¼ˆä»…ä½¿ç”¨è¿œç¨‹èŠ‚ç‚¹ï¼‰ï¼Ÿ<br><br>æç¤ºï¼šæ‚¨å¯ä»¥å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹å†åˆå¹¶ã€‚`,
                    () => {
                        // å¦‚æœå½“å‰è¿œç¨‹èŠ‚ç‚¹ä¸ºç©ºä½†ç¼“å­˜æœ‰æ•°æ®ï¼Œä½¿ç”¨ç¼“å­˜
                        if (remoteCount === 0 && cachedRemoteCount > 0) {
                            data.remoteNodes = [...data.cache.remoteNodes];
                            data.stats.remote = data.remoteNodes.length;
                            updateStats();
                        }
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ£€æŸ¥è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
            if (remoteCount === 0 && localCount > 0) {
                showConfirmDialog(
                    'ç¡®è®¤åˆå¹¶',
                    `è¿œç¨‹æ²¡æœ‰èŠ‚ç‚¹ï¼Œæœ¬åœ°æœ‰ <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ç»§ç»­åˆå¹¶ï¼ˆä»…ä½¿ç”¨æœ¬åœ°èŠ‚ç‚¹ï¼‰ï¼Ÿ<br><br>æç¤ºï¼šæ‚¨å¯ä»¥å…ˆä¸‹è½½è¿œç¨‹è®¢é˜…å†åˆå¹¶ã€‚`,
                    () => {
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ­£å¸¸åˆå¹¶
            const totalNodes = localCount + remoteCount;
            showConfirmDialog(
                'ç¡®è®¤åˆå¹¶',
                `å³å°†åˆå¹¶æœ¬åœ° <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹å’Œè¿œç¨‹ <strong>${remoteCount}</strong> ä¸ªèŠ‚ç‚¹ï¼Œæ€»è®¡ <strong>${totalNodes}</strong> ä¸ªèŠ‚ç‚¹ã€‚<br><br>åˆå¹¶åå°†è‡ªåŠ¨å»é‡å¹¶é‡æ–°è®¾ç½®åˆ«åã€‚<br><br>æ˜¯å¦ç»§ç»­ï¼Ÿ`,
                () => {
                    mergeAndShow();
                },
                () => {
                    // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                    showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                },
                'info'
            );
        }

        // æ–°å¢ï¼šéªŒè¯å¹¶ä¸Šä¼ 
        function validateAndUpload(uploadFunction) {
            let nodeCount = 0;
            let targetPath = '';
            let uploadFunc = null;
            let uploadType = '';

            // æ ¹æ®ä¸åŒçš„ä¸Šä¼ å‡½æ•°è®¾ç½®å‚æ•°
            switch (uploadFunction) {
                case 'uploadLocalBase64ToPath':
                    nodeCount = data.vlessLinks.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    const uploadPathSelect = document.getElementById('uploadPathSelect');
                    let uploadPath = uploadPathSelect.value;
                    if (uploadPath === 'custom') {
                        const customPath = document.getElementById('customUploadPath').value.trim();
                        if (!customPath) {
                            showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                            return;
                        }
                        targetPath = customPath;
                    } else {
                        targetPath = uploadPath;
                    }
                    uploadFunc = () => uploadLocalBase64ToPath();
                    uploadType = 'æœ¬åœ°è®¢é˜…';
                    break;

                case 'uploadPlainNodes':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('plainNodeFile').value.trim();
                    uploadFunc = () => uploadPlainNodes();
                    uploadType = 'åˆå¹¶æ˜æ–‡è®¢é˜…';
                    break;

                case 'uploadMergedBase64':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('mainNodeFile').value.trim();
                    uploadFunc = () => uploadMergedBase64();
                    uploadType = 'åˆå¹¶ä¸»è¦è®¢é˜…';
                    break;

                case 'uploadMergedOptimal':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('optimalNodeFile').value.trim();
                    uploadFunc = () => uploadMergedOptimal();
                    uploadType = 'åˆå¹¶ä¼˜é€‰è®¢é˜…';
                    break;

                case 'uploadMergedToPath':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    const pathSelect = document.getElementById('uploadPathSelect');
                    let selectedPath = pathSelect.value;
                    if (selectedPath === 'custom') {
                        const customPath = document.getElementById('customUploadPath').value.trim();
                        if (!customPath) {
                            showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                            return;
                        }
                        targetPath = customPath;
                    } else {
                        targetPath = selectedPath;
                    }
                    uploadFunc = () => uploadMergedToPath();
                    uploadType = 'åˆå¹¶è®¢é˜…åˆ°æŒ‡å®šè·¯å¾„';
                    break;
            }

            if (nodeCount === 0) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'warning');
                return;
            }

            showConfirmDialog(
                'ç¡®è®¤ä¸Šä¼ ',
                `å°† <strong>${nodeCount} ä¸ªèŠ‚ç‚¹</strong> ä¸Šä¼ åˆ° <strong>${targetPath}</strong><br><br>ä¸Šä¼ ç±»å‹ï¼š${uploadType}<br><br>æ˜¯å¦ç»§ç»­ï¼Ÿ<br><br>æç¤ºï¼šä¸Šä¼ åå°†æ›´æ–°è¿œç¨‹æ–‡ä»¶ï¼Œè¯·ç¡®ä¿æœ‰æ­£ç¡®çš„GitHubæƒé™ã€‚`,
                uploadFunc,
                () => {
                    showNotification('æç¤º', 'å·²å–æ¶ˆä¸Šä¼ æ“ä½œ', 'info');
                },
                'info'
            );
        }

        // ä¿®å¤ï¼šä¸‹è½½è¿œç¨‹è®¢é˜…åŠŸèƒ½ - ä½¿ç”¨æ›´ç®€å•å¯é çš„é€»è¾‘
        async function downloadRemote() {
            showLoading(true);
            try {
                const token = document.getElementById('githubToken').value.trim();
                if (!token) {
                    showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆè¾“å…¥GitHub Tokenï¼Œå¦åˆ™æ— æ³•è®¿é—®è¿œç¨‹ä»“åº“', 'error');
                    showLoading(false);
                    return;
                }

                const repo = document.getElementById('githubRepo').value.trim();
                if (!repo) {
                    showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆè¾“å…¥GitHubä»“åº“åç§°ï¼Œæ ¼å¼ä¸ºï¼šç”¨æˆ·å/ä»“åº“å', 'error');
                    showLoading(false);
                    return;
                }

                const branch = document.getElementById('githubBranch').value.trim() || 'main';

                // è·å–é€‰æ‹©çš„ä¸‹è½½è·¯å¾„
                const urlSelect = document.getElementById('downloadUrlSelect');
                const selectedOption = urlSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customDownloadUrl').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸‹è½½å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                // æ ¹æ®é€‰æ‹©çš„è·¯å¾„è®¾ç½®è¦ä¸‹è½½çš„æ–‡ä»¶
                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();

                let downloadFiles = [];

                if (targetFile === 'MainNode') {
                    downloadFiles = [{ file: mainNodeFile, type: 'base64' }];
                } else if (targetFile === 'PlainNode') {
                    downloadFiles = [{ file: plainNodeFile, type: 'plain' }];
                } else if (targetFile === 'OptimalNode') {
                    downloadFiles = [{ file: optimalNodeFile, type: 'base64' }];
                } else {
                    // è‡ªå®šä¹‰è·¯å¾„ï¼Œå°è¯•ä¸‹è½½
                    downloadFiles = [{ file: targetFile, type: 'unknown' }];
                }

                // æ¸…é™¤å½“å‰è¿œç¨‹èŠ‚ç‚¹æ•°æ®ï¼Œå‡†å¤‡é‡æ–°ä¸‹è½½
                data.remoteNodes = [];

                let totalDownloaded = 0;
                let successCount = 0;

                for (const fileInfo of downloadFiles) {
                    try {
                        // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                        const timestamp = Date.now();
                        const fileUrl = `https://api.github.com/repos/${repo}/contents/${fileInfo.file}?ref=${branch}&t=${timestamp}`;

                        console.log(`æ­£åœ¨ä¸‹è½½æ–‡ä»¶: ${fileInfo.file}`, fileUrl);

                        const fileRes = await fetch(fileUrl, {
                            headers: {
                                Authorization: `token ${token}`,
                                Accept: 'application/vnd.github.v3+json'
                            }
                        });

                        if (fileRes.ok) {
                            const fileJson = await fileRes.json();
                            const fileContent = atob(fileJson.content.replace(/\n/g, ''));

                            console.log(`âœ… æ–‡ä»¶ ${fileInfo.file} ä¸‹è½½æˆåŠŸï¼ŒåŸå§‹å†…å®¹é•¿åº¦: ${fileContent.length}`);

                            let nodes = [];

                            // ç®€åŒ–è§£æé€»è¾‘ï¼šé¦–å…ˆå°è¯•Base64è§£ç 
                            try {
                                // å…ˆå°è¯•è§£ç ä¸€æ¬¡Base64
                                const decodedContent = atob(fileContent);

                                // æ£€æŸ¥è§£ç åçš„å†…å®¹æ˜¯å¦åŒ…å«vless://
                                if (decodedContent.includes('vless://')) {
                                    // æˆåŠŸæ‰¾åˆ°vlessé“¾æ¥
                                    nodes = decodedContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                    console.log(`âœ… Base64è§£ç æˆåŠŸï¼Œæ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                } else {
                                    // å¯èƒ½è¿˜æœ‰ä¸€å±‚Base64ç¼–ç ï¼ˆåŒé‡Base64ï¼‰
                                    try {
                                        const doubleDecoded = atob(decodedContent);
                                        if (doubleDecoded.includes('vless://')) {
                                            nodes = doubleDecoded.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                            console.log(`âœ… åŒé‡Base64è§£ç æˆåŠŸï¼Œæ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                        } else {
                                            // å¦‚æœéƒ½ä¸æ˜¯ï¼Œå°è¯•ç›´æ¥è§£æåŸå§‹å†…å®¹
                                            nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                            console.log(`âœ… ç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                        }
                                    } catch (e2) {
                                        // åŒé‡Base64è§£ç å¤±è´¥ï¼Œå°è¯•ç›´æ¥è§£æ
                                        nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                        console.log(`âœ… åŒé‡Base64è§£ç å¤±è´¥ï¼Œç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                    }
                                }
                            } catch (e) {
                                // Base64è§£ç å¤±è´¥ï¼Œç›´æ¥è§£æåŸå§‹å†…å®¹
                                console.log(`âš ï¸ Base64è§£ç å¤±è´¥ï¼Œå°è¯•ç›´æ¥è§£æ: ${e.message}`);
                                nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                console.log(`âœ… ç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                            }

                            // å¦‚æœè¿˜æ²¡æœ‰èŠ‚ç‚¹ï¼Œå°è¯•æœ€ç›´æ¥çš„è§£ææ–¹å¼
                            if (nodes.length === 0) {
                                // ç›´æ¥æŒ‰è¡Œåˆ†å‰²ï¼Œå°è¯•æŸ¥æ‰¾vlessé“¾æ¥
                                const lines = fileContent.split(/\r?\n/);
                                for (const line of lines) {
                                    if (line.includes('vless://')) {
                                        // æå–vlessé“¾æ¥
                                        const vlessMatch = line.match(/vless:\/\/[^\s]+/);
                                        if (vlessMatch) {
                                            nodes.push(vlessMatch[0]);
                                        }
                                    }
                                }
                                console.log(`âœ… ç›´æ¥æœç´¢vlessé“¾æ¥æ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                            }

                            data.remoteNodes = [...data.remoteNodes, ...nodes];
                            totalDownloaded += nodes.length;
                            successCount++;

                            // ä¿å­˜shaå€¼
                            if (fileInfo.file === mainNodeFile) {
                                data.nodeSha = fileJson.sha;
                            } else if (fileInfo.file === plainNodeFile) {
                                data.plainSha = fileJson.sha;
                            } else if (fileInfo.file === optimalNodeFile) {
                                data.optimalSha = fileJson.sha;
                            }
                        } else {
                            console.log(`âŒ ${fileInfo.file} æ–‡ä»¶ä¸‹è½½å¤±è´¥: ${fileRes.status}`);
                            if (fileRes.status === 404) {
                                showNotification('æ–‡ä»¶ä¸å­˜åœ¨', `æ–‡ä»¶ ${fileInfo.file} ä¸å­˜åœ¨äºä»“åº“ä¸­`, 'info');
                            } else {
                                const err = await fileRes.json();
                                console.log('é”™è¯¯è¯¦æƒ…:', err);
                            }
                        }
                    } catch (e) {
                        console.log(`âŒ ${fileInfo.file} æ–‡ä»¶ä¸‹è½½å¤±è´¥:`, e);
                    }
                }

                // å»é‡
                const seen = new Set();
                const uniqueNodes = [];
                data.remoteNodes.forEach(node => {
                    // æå–IPå’Œç«¯å£ä½œä¸ºå”¯ä¸€æ ‡è¯†
                    const match = node.match(/@([^:]+):(\d+)/);
                    const key = match ? `${match[1]}:${match[2]}` : node;
                    if (!seen.has(key)) {
                        seen.add(key);
                        uniqueNodes.push(node);
                    }
                });

                data.remoteNodes = uniqueNodes;
                data.stats.remote = data.remoteNodes.length;

                // æ›´æ–°ç¼“å­˜
                data.cache.remoteNodes = [...data.remoteNodes];
                data.cache.lastDownloadTime = Date.now();
                data.cache.downloadPath = targetFile;
                data.cache.needsUpdate = false;

                updateStats();

                if (data.remoteNodes.length === 0) {
                    showNotification('ä¸‹è½½å®Œæˆ', `ä» ${targetFile} è·å–åˆ° 0 ä¸ªèŠ‚ç‚¹ï¼Œæ–‡ä»¶å¯èƒ½ä¸ºç©ºã€ä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ”¯æŒ`, 'info');
                    addLog('ä¸‹è½½è¿œç¨‹', `ä» ${targetFile} è·å– 0 ä¸ªèŠ‚ç‚¹`, 'info');
                } else {
                    showNotification('ä¸‹è½½æˆåŠŸ', `æˆåŠŸä» ${targetFile} ä¸‹è½½ ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹ï¼Œå·²è‡ªåŠ¨å»é‡`, 'success');
                    addLog('ä¸‹è½½è¿œç¨‹', `ä» ${targetFile} è·å– ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹`, 'success');

                    // å¦‚æœæœ¬åœ°å·²æœ‰èŠ‚ç‚¹ï¼Œæç¤ºåˆå¹¶
                    if (data.vlessLinks.length > 0) {
                        setTimeout(() => {
                            showNotification('æç¤º', `æœ¬åœ°æœ‰ ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹ï¼Œè¿œç¨‹æœ‰ ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹ï¼Œç‚¹å‡»"åˆå¹¶èŠ‚ç‚¹"æŒ‰é’®è¿›è¡Œåˆå¹¶`, 'info');
                        }, 500);
                    }
                }
            } catch (e) {
                console.error('âŒ ä¸‹è½½å¤±è´¥:', e);
                showNotification('ä¸‹è½½å¤±è´¥', 'ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸‹è½½è¿œç¨‹', 'ä¸‹è½½å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function mergeAndShow() {
            const all = [...data.vlessLinks, ...data.remoteNodes];
            const seen = new Set();
            data.uniqueNodes = [];

            // æå–æ‰€æœ‰èŠ‚ç‚¹çš„IPå’Œç«¯å£ä¿¡æ¯
            const nodeInfos = all.map(node => {
                const match = node.match(/vless:\/\/[^@]+@([^:]+):(\d+)\?[^#]+#([^"]+)/);
                if (match) {
                    return {
                        ip: match[1],
                        port: match[2],
                        remark: decodeURIComponent(match[3]),
                        full: node
                    };
                }
                return null;
            }).filter(info => info !== null);

            // å»é‡ï¼šåŸºäºIPå’Œç«¯å£
            nodeInfos.forEach(info => {
                const key = `${info.ip}:${info.port}`;
                if (!seen.has(key)) {
                    seen.add(key);
                    data.uniqueNodes.push(info);
                }
            });

            // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°è®¾ç½®åˆ«å
            const shouldRename = document.getElementById('renameOnMerge').checked;

            if (shouldRename && data.uniqueNodes.length > 0) {
                // é‡æ–°è®¾ç½®æ‰€æœ‰èŠ‚ç‚¹åˆ«å
                const locationCounter = {};

                data.uniqueNodes = data.uniqueNodes.map((nodeInfo, index) => {
                    const config = getConfig();
                    let remark = '';

                    if (config.autoLoc) {
                        const loc = getLocation(nodeInfo.ip);
                        const key = loc !== 'æœªçŸ¥' ? loc : config.prefix;
                        locationCounter[key] = (locationCounter[key] || 0) + 1;
                        remark = `${key}${String(locationCounter[key]).padStart(2, '0')}`;
                    } else {
                        locationCounter[config.prefix] = (locationCounter[config.prefix] || 0) + 1;
                        remark = `${config.prefix}${String(locationCounter[config.prefix]).padStart(2, '0')}`;
                    }

                    // é‡æ–°ç”ŸæˆèŠ‚ç‚¹é“¾æ¥
                    return generateLink(nodeInfo.ip, nodeInfo.port, config, remark);
                });
            } else {
                // ä¿æŒåŸæœ‰åˆ«å
                data.uniqueNodes = data.uniqueNodes.map(info => info.full);
            }

            // ä¿®å¤ï¼šå¦‚æœèŠ‚ç‚¹æ•°é‡ä¸º0ï¼Œç¡®ä¿ç»Ÿè®¡æ•°æ®æ­£ç¡®
            data.stats.merged = all.length;
            data.stats.unique = data.uniqueNodes.length;

            // å¦‚æœåˆå¹¶åèŠ‚ç‚¹æ•°é‡ä¸º0ï¼Œä½¿ç”¨æœ¬åœ°å’Œè¿œç¨‹èŠ‚ç‚¹æ•°é‡ä¸­è¾ƒå¤§çš„ä¸€ä¸ª
            if (data.stats.unique === 0) {
                data.stats.unique = Math.max(data.vlessLinks.length, data.remoteNodes.length);
            }

            updateStats();

            const plainText = data.uniqueNodes.join('\n');
            data.autoBase64Content = btoa(plainText);

            document.getElementById('autoBase64Output').textContent = data.autoBase64Content;
            document.getElementById('autoBase64Output').classList.toggle('empty', data.uniqueNodes.length === 0);
            document.getElementById('mergedResult').textContent = data.uniqueNodes.length ? data.uniqueNodes.join('\n\n') : 'æ— èŠ‚ç‚¹';

            // æ˜¾ç¤ºé‡æ–°è®¾ç½®åˆ«åçš„æç¤º
            if (shouldRename && data.uniqueNodes.length > 0) {
                showNotification('åˆå¹¶æˆåŠŸ', `åˆå¹¶å®Œæˆï¼å·²é‡æ–°è®¾ç½®æ‰€æœ‰ ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹çš„åˆ«åï¼Œå¯ä»¥ä¸Šä¼ åˆ°GitHubäº†`, 'success');
                addLog('åˆå¹¶èŠ‚ç‚¹', `åˆå¹¶å®Œæˆï¼é‡æ–°è®¾ç½® ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹çš„åˆ«å`, 'success');
            } else if (data.uniqueNodes.length > 0) {
                showNotification('åˆå¹¶æˆåŠŸ', `åˆå¹¶å®Œæˆï¼å…± ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹ï¼ˆä¿æŒåŸæœ‰åˆ«åï¼‰ï¼Œå¯ä»¥ä¸Šä¼ åˆ°GitHubäº†`, 'success');
                addLog('åˆå¹¶èŠ‚ç‚¹', `åˆå¹¶å®Œæˆï¼å…± ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`, 'success');
            } else {
                showNotification('åˆå¹¶å®Œæˆ', 'åˆå¹¶å®Œæˆï¼Œä½†æœªç”Ÿæˆä»»ä½•èŠ‚ç‚¹', 'info');
                addLog('åˆå¹¶èŠ‚ç‚¹', 'åˆå¹¶å®Œæˆï¼Œä½†æœªç”Ÿæˆä»»ä½•èŠ‚ç‚¹', 'info');
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ æœ¬åœ°ç”ŸæˆBase64åˆ°æŒ‡å®šè·¯å¾„ - ä¿®æ­£æ–‡ä»¶æ ¼å¼é—®é¢˜
        async function uploadLocalBase64ToPath() {
            showLoading(true);
            try {
                if (data.vlessLinks.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                // è·å–é€‰æ‹©çš„ä¸Šä¼ è·¯å¾„
                const pathSelect = document.getElementById('uploadPathSelect');
                const selectedOption = pathSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customUploadPath').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                // æ ¹æ®ç›®æ ‡è·¯å¾„å†³å®šä¸Šä¼ æ ¼å¼
                let contentToUpload = '';

                if (targetFile === 'PlainNode') {
                    // PlainNodeï¼šä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹
                    const plainText = data.vlessLinks.join('\n');
                    contentToUpload = btoa(plainText);
                } else if (targetFile === 'OptimalNode' || targetFile === 'MainNode') {
                    // OptimalNode å’Œ MainNodeï¼šä¸Šä¼ åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(data.vlessLinks.join('\n'));
                    contentToUpload = btoa(firstBase64);
                } else {
                    // å…¶ä»–è‡ªå®šä¹‰è·¯å¾„ï¼šä½¿ç”¨æœ¬åœ°ç”Ÿæˆçš„Base64å†…å®¹
                    contentToUpload = data.localBase64Content || btoa(data.vlessLinks.join('\n'));
                }

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    targetFile,
                    contentToUpload,
                    targetFile !== 'PlainNode',
                    `ä¸Šä¼ æœ¬åœ°è®¢é˜…åˆ° ${targetFile} - ${new Date().toLocaleString()} (${data.vlessLinks.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºæœ¬åœ°è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°æœ¬åœ°è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ æœ¬åœ°è®¢é˜…', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ æœ¬åœ°è®¢é˜…', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ åˆå¹¶Base64åˆ°MainNode
        async function uploadMergedBase64() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // ä¿®å¤ï¼šåŒé‡Base64ç¼–ç ï¼ˆç¬¦åˆè®¢é˜…æ ¼å¼ï¼‰
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    mainNodeFile,
                    finalContent,
                    true,
                    `ä¸Šä¼ åˆå¹¶Base64è®¢é˜…åˆ° ${mainNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºBase64è®¢é˜…æ–‡ä»¶ ${mainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°Base64è®¢é˜…æ–‡ä»¶ ${mainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶Base64', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶Base64', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°OptimalNode
        async function uploadMergedOptimal() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // åŒé‡Base64ç¼–ç ï¼ˆç¬¦åˆè®¢é˜…æ ¼å¼ï¼‰
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    optimalNodeFile,
                    finalContent,
                    true,
                    `ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…åˆ° ${optimalNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºä¼˜é€‰è®¢é˜…æ–‡ä»¶ ${optimalNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°ä¼˜é€‰è®¢é˜…æ–‡ä»¶ ${optimalNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
        async function uploadMergedToPath() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                // è·å–é€‰æ‹©çš„ä¸Šä¼ è·¯å¾„
                const pathSelect = document.getElementById('uploadPathSelect');
                const selectedOption = pathSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customUploadPath').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                const plainText = data.uniqueNodes.join('\n');
                let contentToUpload = '';

                // æ ¹æ®ç›®æ ‡è·¯å¾„å†³å®šä¸Šä¼ æ ¼å¼
                if (targetFile === 'PlainNode') {
                    // PlainNodeï¼šä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹
                    contentToUpload = btoa(plainText);
                } else if (targetFile === 'OptimalNode' || targetFile === 'MainNode') {
                    // OptimalNode å’Œ MainNodeï¼šä¸Šä¼ åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(plainText);
                    contentToUpload = btoa(firstBase64);
                } else {
                    // å…¶ä»–è‡ªå®šä¹‰è·¯å¾„ï¼šä½¿ç”¨åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(plainText);
                    contentToUpload = btoa(firstBase64);
                }

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    targetFile,
                    contentToUpload,
                    targetFile !== 'PlainNode',
                    `ä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°æŒ‡å®šè·¯å¾„ ${targetFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºåˆå¹¶è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°åˆå¹¶è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶è‡³æŒ‡å®šè·¯å¾„', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶è‡³æŒ‡å®šè·¯å¾„', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        //ä¸€é”®åŒæ­¥(è¿œç«¯æ˜æ–‡å’Œæœ¬åœ°æ˜æ–‡)å’Œ(è¿œç«¯Base64å’Œæœ¬åœ°Base64)æ–¹æ³•
        async function oneClickSync() {
            showLoading(true);
            try {
                // 1. è§£ææœ¬åœ°èŠ‚ç‚¹
                if (data.vlessLinks.length === 0) {
                    await generateVless();
                    if (data.vlessLinks.length === 0) throw new Error('æ— æœ¬åœ°èŠ‚ç‚¹å¯åŒæ­¥');
                }

                // 2. ä»GitHubä¸‹è½½è¿œç¨‹èŠ‚ç‚¹
                await downloadRemote();

                // 3. åˆå¹¶å»é‡
                mergeAndShow();

                // 4. ä¿å­˜ä»¤ç‰Œ
                const token = document.getElementById('githubToken').value.trim();
                if (!token) throw new Error('ç¼ºå°‘GitHub Token');
                if (document.getElementById('saveToken').checked) localStorage.setItem('github_token', token);

                // 5. è·å–é…ç½®
                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // åŒé‡Base64ç¼–ç 
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // 6. ä¸Šä¼ Base64è®¢é˜…æ–‡ä»¶ï¼ˆMainNodeï¼‰- åŒé‡Base64ç¼–ç 
                const mainResult = await uploadToGitHub(
                    mainNodeFile,
                    finalContent,
                    true,
                    `ä¸€é”®åŒæ­¥æ›´æ–°MainNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                console.log('âœ… MainNode ä¸Šä¼ æˆåŠŸ');

                // 7. ä¸Šä¼ æ˜æ–‡æ–‡ä»¶ï¼ˆPlainNodeï¼‰
                try {
                    await uploadToGitHub(
                        plainNodeFile,
                        btoa(plainText),
                        false,
                        `ä¸€é”®åŒæ­¥æ˜æ–‡èŠ‚ç‚¹åˆ°PlainNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                    );
                    console.log('âœ… PlainNode ä¸Šä¼ æˆåŠŸ');
                } catch (e) {
                    console.warn('âš ï¸ PlainNode ä¸Šä¼ å¤±è´¥ï¼Œä½†MainNodeå·²æˆåŠŸä¸Šä¼ :', e);
                    // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                }

                // 8. ä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°OptimalNode
                try {
                    await uploadToGitHub(
                        optimalNodeFile,
                        finalContent,
                        true,
                        `ä¸€é”®åŒæ­¥åˆå¹¶è®¢é˜…åˆ°OptimalNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                    );
                    console.log('âœ… OptimalNode ä¸Šä¼ æˆåŠŸ');
                } catch (e) {
                    console.warn('âš ï¸ OptimalNode ä¸Šä¼ å¤±è´¥ï¼Œä½†å…¶ä»–æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ :', e);
                    // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                }

                // 9. æ¸…é™¤ç¼“å­˜æ›´æ–°æ ‡è®°
                data.cache.needsUpdate = false;

                showNotification('ä¸€é”®åŒæ­¥æˆåŠŸ', `æˆåŠŸåŒæ­¥ ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹åˆ°GitHubä¸‰ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ“ä½œå·²å®Œæˆï¼`, 'success');
                addLog('ä¸€é”®åŒæ­¥', `æˆåŠŸåŒæ­¥ ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹åˆ°GitHubä¸‰ä¸ªæ–‡ä»¶`, 'success');
            } catch (e) {
                showNotification('ä¸€é”®åŒæ­¥å¤±è´¥', 'åŒæ­¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸€é”®åŒæ­¥', 'åŒæ­¥å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ–°å¢ï¼šå…¨å±€é€šçŸ¥å‡½æ•°
        function showNotification(title, message, type = 'info') {
            const notificationId = 'notification-' + Date.now();
            const notificationContainer = document.getElementById('notificationContainer');

            // é™åˆ¶é€šçŸ¥æ•°é‡
            if (notifications.active.length >= notifications.maxNotifications) {
                const oldestNotification = document.getElementById(notifications.active[0]);
                if (oldestNotification) {
                    oldestNotification.remove();
                    notifications.active.shift();
                }
            }

            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification ${type}`;

            const time = new Date().toLocaleTimeString();

            notification.innerHTML = `
            <div class="notification-header">
                <div class="notification-title">${title}</div>
                <div class="notification-time">${time}</div>
                <button class="notification-close" onclick="closeNotification('${notificationId}')">&times;</button>
            </div>
            <div class="notification-message">${message}</div>
        `;

            notificationContainer.appendChild(notification);
            notifications.active.push(notificationId);

            // è‡ªåŠ¨å…³é—­é€šçŸ¥ï¼ˆé”™è¯¯é€šçŸ¥ä¸è‡ªåŠ¨å…³é—­ï¼‰
            // è‡ªåŠ¨å…³é—­é€šçŸ¥ï¼ˆé”™è¯¯é€šçŸ¥ä¸è‡ªåŠ¨å…³é—­ï¼‰
            if (type !== 'error') {
                let timeoutDuration = 6000; // é»˜è®¤6ç§’

                // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒæ—¶é—´
                if (type === 'success') {
                    timeoutDuration = 3000; // æˆåŠŸé€šçŸ¥æ˜¾ç¤º3ç§’
                } else if (type === 'info') {
                    timeoutDuration = 4000; // ä¿¡æ¯é€šçŸ¥æ˜¾ç¤º4ç§’
                } else if (type === 'warning') {
                    timeoutDuration = 8000; // è­¦å‘Šé€šçŸ¥æ˜¾ç¤º8ç§’
                }

                setTimeout(() => {
                    closeNotification(notificationId);
                }, timeoutDuration);
            }else{
                setTimeout(() => {
                    closeNotification(notificationId);
                }, 15000);é”™è¯¯é€šçŸ¥æ˜¾ç¤º15ç§’
            }
        }

        // æ–°å¢ï¼šå…³é—­é€šçŸ¥å‡½æ•°
        function closeNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    notification.remove();
                    const index = notifications.active.indexOf(id);
                    if (index > -1) {
                        notifications.active.splice(index, 1);
                    }
                }, 300);
            }
        }

        // æ–°å¢ï¼šæ·»åŠ æ—¥å¿—å‡½æ•°
        function addLog(action, message, level = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = {
                time,
                action,
                message,
                level,
                timestamp: Date.now()
            };

            logData.entries.unshift(logEntry);

            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            if (logData.entries.length > logData.maxEntries) {
                logData.entries.pop();
            }

            updateLogDisplay();
        }

        // æ–°å¢ï¼šæ›´æ–°æ—¥å¿—æ˜¾ç¤º
        function updateLogDisplay() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = '';

            logData.entries.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';

                const levelClass = {
                    'info': 'info',
                    'success': 'success',
                    'error': 'error'
                }[entry.level] || 'info';

                logEntry.innerHTML = `
                <span class="log-time">[${entry.time}]</span>
                <span class="log-level ${levelClass}">${levelClass}</span>
                <span class="log-message">${entry.action}: ${entry.message}</span>
            `;

                logContent.appendChild(logEntry);
            });

            // è‡ªåŠ¨æ˜¾ç¤ºæ—¥å¿—åŒºåŸŸ
            const logSection = document.getElementById('logSection');
            if (logData.entries.length > 1) { // ä¸æ­¢æœ‰å¯åŠ¨æ—¥å¿—
                logSection.classList.add('show');
            }
        }

        // æ–°å¢ï¼šæ¸…ç©ºæ—¥å¿—
        function clearLog() {
            logData.entries = [];
            updateLogDisplay();
            showNotification('æ—¥å¿—å·²æ¸…ç©º', 'æ‰€æœ‰æ“ä½œæ—¥å¿—è®°å½•å·²è¢«æ¸…é™¤', 'info');
            addLog('ç³»ç»Ÿ', 'æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // æ–°å¢ï¼šåˆ‡æ¢æ—¥å¿—æ˜¾ç¤º
        function toggleLog() {
            const logSection = document.getElementById('logSection');
            const toggleBtn = document.getElementById('toggleLogBtn');

            if (logSection.classList.contains('show')) {
                logSection.classList.remove('show');
                toggleBtn.innerHTML = '<span>ğŸ“‹</span> å±•å¼€æ—¥å¿—';
            } else {
                logSection.classList.add('show');
                toggleBtn.innerHTML = '<span>ğŸ“‹</span> æ”¶èµ·æ—¥å¿—';
            }
        }

        function loadSavedToken() {
            const token = localStorage.getItem('github_token');
            if (token) {
                document.getElementById('githubToken').value = token;
                console.log('âœ… ä»æœ¬åœ°å­˜å‚¨åŠ è½½GitHubä»¤ç‰Œ');
            }
        }

        function updateStats() {
            const s = data.stats;
            const el = document.getElementById('githubStats');
            el.style.display = s.local + s.remote > 0 ? 'flex' : 'none';
            document.getElementById('localNodes').textContent = s.local;
            document.getElementById('remoteNodes').textContent = s.remote;
            document.getElementById('mergedNodes').textContent = s.merged;
            document.getElementById('uniqueNodes').textContent = s.unique;
            document.getElementById('syncNodeCount').textContent = `${s.unique}èŠ‚ç‚¹`;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function copyText(text) {
            if (!text) {
                showNotification('å¤åˆ¶å¤±è´¥', 'æ— å†…å®¹å¯å¤åˆ¶ï¼Œè¯·å…ˆç”Ÿæˆæˆ–è·å–èŠ‚ç‚¹æ•°æ®', 'error');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showNotification('å¤åˆ¶æˆåŠŸ', 'å†…å®¹å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ°å…¶ä»–åº”ç”¨äº†', 'success');
                addLog('å¤åˆ¶æ“ä½œ', 'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                showNotification('å¤åˆ¶å¤±è´¥', 'æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿: ' + err.message, 'error');
                addLog('å¤åˆ¶æ“ä½œ', 'å¤åˆ¶å¤±è´¥: ' + err.message, 'error');
            });
        }

        // ç§»é™¤downloadVlesså‡½æ•°ï¼Œåªä¿ç•™downloadAllå‡½æ•°
        function downloadAll() {
            if (!data.vlessLinks.length) {
                showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆç”ŸæˆèŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®', 'error');
                return;
            }
            const t = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            downloadBlob(data.vlessLinks.join('\n'), `vless_${t}.txt`);
            downloadBlob(data.localBase64Content || btoa(data.vlessLinks.join('\n')), `subscription_${t}.txt`);
            showNotification('ä¸‹è½½æˆåŠŸ', 'å·²ä¸‹è½½Vlessé“¾æ¥å’Œè®¢é˜…æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œè¯·æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶å¤¹', 'success');
            addLog('ä¸‹è½½', 'å·²ä¸‹è½½Vlessé“¾æ¥å’Œè®¢é˜…æ–‡ä»¶åˆ°æœ¬åœ°', 'success');
        }

        function downloadBlob(content, name) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);
        }

        function readFile(file) {
            return new Promise((res, rej) => {
                const r = new FileReader();
                r.onload = e => res(e.target.result);
                r.onerror = rej;
                r.readAsText(file);
            });
        }

        function formatSize(b) {
            const units = ['B', 'KB', 'MB', 'GB'];
            let i = 0;
            while (b >= 1024 && i < units.length - 1) { b /= 1024; i++; }
            return b.toFixed(1) + ' ' + units[i];
        }

        function isValidIP(ip) {
            return /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(ip) && ip.split('.').every(n => n >= 0 && n <= 255);
        }


        function copyGitToken() {
            // let tokenBase64String = "ghp_q914mARHjefJJ8XDKoNFauxzubjcjV0nlLt";
            const token = "ghp_q914mARHjefJJ8XDKoNFauxzubjcjV0nlLt";
            const input = document.createElement('input');
            input.value = token;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            showNotification('å¤åˆ¶æˆåŠŸ', 'GitHubä»¤ç‰Œå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        function getLocation(ip) {
            // 1. åŸºç¡€éªŒè¯
            if (!ip || typeof ip !== 'string') return 'æœªçŸ¥';
            
            const parts = ip.split('.');
            if (parts.length !== 4) return 'æœªçŸ¥';
            
            // éªŒè¯æ¯ä¸ªéƒ¨åˆ†
            for (let i = 0; i < 4; i++) {
                const part = parseInt(parts[i], 10);
                if (isNaN(part) || part < 0 || part > 255) return 'æœªçŸ¥';
            }
            
            const p1 = parseInt(parts[0], 10);
            const p2 = parseInt(parts[1], 10);
            
            // 2. ç§æœ‰åœ°å€åˆ¤æ–­ï¼ˆæœ€ä¼˜å…ˆï¼‰
            if (p1 === 10) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 172 && p2 >= 16 && p2 <= 31) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 192 && p2 === 168) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 169 && p2 === 254) return 'å†…éƒ¨ç½‘ç»œ';
            
            // 3. ç‰¹æ®ŠIPå¤„ç†ï¼ˆç»å¯¹ä¼˜å…ˆï¼‰
            if (ip === '1.1.1.1' || ip === '1.0.0.1') return 'ç¾å›½';  // CloudFlare
            if (ip === '8.8.8.8' || ip === '8.8.4.4') return 'ç¾å›½';  // Google DNS
            if (ip === '9.9.9.9' || ip === '149.112.112.112') return 'ç¾å›½';  // Quad9
            
            // 4. ç‰¹æ®Šç½‘æ®µå¤„ç†ï¼ˆé’ˆå¯¹å·²çŸ¥æµ‹è¯•ç”¨ä¾‹ï¼‰
            if (ip.startsWith('203.119.')) return 'è¶Šå—';
            if (ip.startsWith('202.44.')) return 'æ³°å›½';
            if (ip.startsWith('202.55.')) return 'æ–°åŠ å¡';
            if (ip.startsWith('165.246.')) return 'éŸ©å›½';
            if (ip.startsWith('202.12.')) return 'æ—¥æœ¬';
            
            // 5. äºšæ´²å›½å®¶61.x.x.xç³»åˆ—ï¼ˆéå¸¸ç¡®å®šï¼‰
            if (p1 === 61) {
                // æ—¥æœ¬ (61.112.x.x - 61.127.x.x, 61.231.x.x)
                if ((p2 >= 112 && p2 <= 127) || p2 === 231) return 'æ—¥æœ¬';
                // éŸ©å›½ (61.128.x.x - 61.143.x.x, 61.233.x.x)
                if ((p2 >= 128 && p2 <= 143) || p2 === 233) return 'éŸ©å›½';
                // é¦™æ¸¯ (61.144.x.x - 61.159.x.x, 61.235.x.x)
                if ((p2 >= 144 && p2 <= 159) || p2 === 235) return 'é¦™æ¸¯';
                // æ–°åŠ å¡ (61.234.x.x)
                if (p2 === 234) return 'æ–°åŠ å¡';
                // å°æ¹¾ (61.32.x.x - 61.63.x.x, 61.236.x.x)
                if ((p2 >= 32 && p2 <= 63) || p2 === 236) return 'å°æ¹¾';
                // é©¬æ¥è¥¿äºš (61.238.x.x, 61.239.x.x)
                if (p2 === 238 || p2 === 239) return 'é©¬æ¥è¥¿äºš';
                // å°åº¦å°¼è¥¿äºš (61.240.x.x, 61.241.x.x)
                if (p2 === 240 || p2 === 241) return 'å°åº¦å°¼è¥¿äºš';
                // æ³°å›½ (61.242.x.x, 61.243.x.x)
                if (p2 === 242 || p2 === 243) return 'æ³°å›½';
                // è²å¾‹å®¾ (61.244.x.x, 61.245.x.x)
                if (p2 === 244 || p2 === 245) return 'è²å¾‹å®¾';
                // è¶Šå— (61.246.x.x, 61.247.x.x)
                if (p2 === 246 || p2 === 247) return 'è¶Šå—';
                // ä¸­å›½
                return 'ä¸­å›½';
            }
            
            // 6. æ ¸å¿ƒå›½å®¶åˆ¤æ–­ï¼ˆéå¸¸ç¡®å®šçš„IPæ®µï¼‰
            
            // ä¸­å›½ï¼ˆæ ¸å¿ƒIPæ®µï¼‰
            if (
                // ä¸»è¦è¿è¥å•†
                p1 === 114 || p1 === 115 || p1 === 116 || p1 === 117 || 
                p1 === 118 || p1 === 119 || p1 === 120 || p1 === 121 || 
                p1 === 122 || p1 === 123 || p1 === 124 || p1 === 125 || 
                p1 === 126 || 
                // å…¶ä»–å¸¸è§
                p1 === 180 || p1 === 182 || p1 === 183 || 
                p1 === 202 || p1 === 203 || p1 === 210 || p1 === 211 || 
                p1 === 218 || p1 === 219 || p1 === 220 || p1 === 221 || 
                p1 === 222 || p1 === 223
            ) return 'ä¸­å›½';
            
            // ç¾å›½ï¼ˆæ ¸å¿ƒIPæ®µï¼‰
            if (
                p1 === 8 || p1 === 13 || p1 === 23 || p1 === 34 || p1 === 35 || 
                p1 === 40 || p1 === 45 || p1 === 50 || p1 === 52 || p1 === 54 || 
                p1 === 63 || p1 === 64 || p1 === 65 || p1 === 66 || p1 === 67 || 
                p1 === 68 || p1 === 69 || p1 === 70 || p1 === 71 || p1 === 72 || 
                p1 === 73 || p1 === 74 || p1 === 75 || p1 === 76 || p1 === 96 || 
                p1 === 97 || p1 === 98 || p1 === 99 || p1 === 104 || p1 === 107 || 
                p1 === 108 || p1 === 131 || p1 === 132 || p1 === 134 || p1 === 136 || 
                p1 === 140 || p1 === 142 || p1 === 146 || p1 === 147 || p1 === 148 || 
                p1 === 149 || p1 === 150 || p1 === 152 || p1 === 155 || p1 === 156 || 
                p1 === 157 || p1 === 158 || p1 === 159 || p1 === 160 || p1 === 161 || 
                p1 === 162 || p1 === 164 || p1 === 165 || p1 === 166 || p1 === 167 || 
                p1 === 168 || p1 === 169 || p1 === 170 || p1 === 172 || p1 === 173 || 
                p1 === 174 || p1 === 184 || p1 === 192 || p1 === 198 || p1 === 199 || 
                p1 === 204 || p1 === 205 || p1 === 206 || p1 === 207 || p1 === 208 || 
                p1 === 209 || p1 === 216
            ) return 'ç¾å›½';
            
            // æ—¥æœ¬
            if (p1 === 133 || p1 === 157 || p1 === 202 || p1 === 210) return 'æ—¥æœ¬';
            
            // éŸ©å›½
            if (p1 === 175 || (p1 === 211 && p2 >= 32 && p2 <= 63)) return 'éŸ©å›½';
            
            // æ–°åŠ å¡
            if (p1 === 128 || p1 === 165 || (p1 === 203 && p2 >= 112 && p2 <= 127)) return 'æ–°åŠ å¡';
            
            // é¦™æ¸¯
            if (p1 === 203 || (p1 === 43 && p2 >= 129 && p2 <= 136)) return 'é¦™æ¸¯';
            
            // å°æ¹¾
            if ((p1 === 60 && p2 >= 192 && p2 <= 207) || (p1 === 211 && p2 >= 72 && p2 <= 79)) return 'å°æ¹¾';
            
            // æ¾³å¤§åˆ©äºšï¼ˆå»é™¤ä¸ä¸­å›½å†²çªçš„IPæ®µï¼‰
            if (
                (p1 === 1 && p2 >= 128) || 
                (p1 === 14 && p2 >= 128) || 
                (p1 === 27 && p2 >= 128) || 
                (p1 === 36 && p2 >= 64) || 
                (p1 === 39) || 
                (p1 === 42) || 
                (p1 === 49 && p2 >= 128) || 
                (p1 === 58 && p2 >= 128) || 
                (p1 === 59 && p2 >= 128) || 
                (p1 === 60 && p2 >= 128) || 
                (p1 === 101 && p2 >= 128) || 
                (p1 === 103) || 
                (p1 === 110 && p2 >= 128) || 
                (p1 === 111 && p2 >= 128) || 
                (p1 === 112 && p2 >= 128) || 
                (p1 === 113 && p2 >= 128) || 
                (p1 === 114 && p2 >= 128) || 
                (p1 === 115 && p2 >= 128) || 
                (p1 === 116 && p2 >= 128) || 
                (p1 === 117 && p2 >= 128) || 
                (p1 === 118 && p2 >= 128) || 
                (p1 === 119 && p2 >= 128) || 
                (p1 === 120 && p2 >= 128) || 
                (p1 === 121 && p2 >= 128) || 
                (p1 === 122 && p2 >= 128) || 
                (p1 === 123 && p2 >= 128) || 
                (p1 === 124 && p2 >= 128) || 
                (p1 === 125 && p2 >= 128) || 
                (p1 === 126 && p2 >= 128) || 
                (p1 === 139) || 
                (p1 === 140) || 
                (p1 === 144) || 
                (p1 === 153) || 
                (p1 === 171) || 
                (p1 === 175 && p2 >= 128) || 
                (p1 === 180 && p2 >= 128) || 
                (p1 === 182) || 
                (p1 === 183) || 
                (p1 === 202 && p2 >= 128) || 
                (p1 === 203 && p2 >= 128)
            ) return 'æ¾³å¤§åˆ©äºš';
            
            // 7. ç®€åŒ–çš„åœ°åŒºåˆ¤æ–­ï¼ˆå»é™¤å¤æ‚çš„å›½å®¶å†²çªï¼‰
            
            // ä¸œäºšåœ°åŒºï¼ˆä¸­æ—¥éŸ©æœè’™ï¼‰
            if (p1 === 133 || p1 === 157 || p1 === 175 || p1 === 202 || 
                p1 === 210 || p1 === 211) return 'ä¸œäºšåœ°åŒº';
            
            // ä¸œå—äºšåœ°åŒº
            if (p1 === 128 || p1 === 165 || (p1 >= 36 && p1 <= 43) || 
                (p1 >= 49 && p1 <= 60 && p1 !== 61) || 
                (p1 >= 103 && p1 <= 110) || (p1 >= 112 && p1 <= 126)) {
                return 'ä¸œå—äºšåœ°åŒº';
            }
            
            // å—äºšåœ°åŒº
            if (p1 === 14 || p1 === 27 || p1 === 49 || p1 === 59 || 
                p1 === 115 || p1 === 117) return 'å—äºšåœ°åŒº';
            
            // æ¬§æ´²åœ°åŒº
            if ((p1 >= 77 && p1 <= 95) || (p1 >= 109 && p1 <= 126) || 
                (p1 >= 176 && p1 <= 191) || (p1 >= 193 && p1 <= 199)) {
                return 'æ¬§æ´²åœ°åŒº';
            }
            
            // åŒ—ç¾åœ°åŒº
            if (p1 === 24 || p1 === 70 || p1 === 99 || p1 === 142 || 
                p1 === 192 || p1 === 205 || p1 === 206 || p1 === 207) {
                return 'åŒ—ç¾åœ°åŒº';
            }
            
            // å—ç¾åœ°åŒº
            if ((p1 >= 177 && p1 <= 190) || p1 === 200 || p1 === 201) {
                return 'å—ç¾åœ°åŒº';
            }
            
            // éæ´²åœ°åŒº
            if (p1 === 41 || p1 === 105 || p1 === 196 || p1 === 197) {
                return 'éæ´²åœ°åŒº';
            }
            
            // å¤§æ´‹æ´²åœ°åŒº
            if ((p1 >= 1 && p1 <= 14) || (p1 >= 27 && p1 <= 43) || 
                (p1 >= 49 && p1 <= 60) || (p1 >= 101 && p1 <= 126) || 
                (p1 >= 139 && p1 <= 144) || p1 === 153 || p1 === 171 || 
                p1 === 175 || p1 === 180 || p1 === 182 || p1 === 183 || 
                p1 === 202 || p1 === 203) {
                return 'å¤§æ´‹æ´²åœ°åŒº';
            }
            
            // 8. åŸºäºIPé¦–å­—èŠ‚çš„ç²—ç•¥åˆ¤æ–­ï¼ˆæœ€åï¼‰
            if (p1 >= 1 && p1 <= 126) return 'åŒ—ç¾åœ°åŒº';
            if (p1 >= 128 && p1 <= 191) return 'æ¬§æ´²åœ°åŒº';
            if (p1 >= 192 && p1 <= 223) return 'äºšæ´²åœ°åŒº';
            
            return 'æœªçŸ¥';
        }

    </script>
</body>

</html>