<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·4.0ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #4a56d2;
            --secondary-color: #3f4bbf;
            --success-color: #2da69a;
            --info-color: #3a8fd9;
            --warning-color: #e0559c;
            --github-color: #2d3748;
            --light-color: #f7fafc;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --card-bg: rgba(255, 255, 255, 0.98);
            --sidebar-width: 50%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #5d6de0 0%, #6a4fa3 100%);
            color: #2d3748;
            line-height: 1.4;
            min-height: 100vh;
            padding: 18px;
            font-size: 15px;
        }

        .container {
            max-width: 1650px;
            margin: 0 auto;
            position: relative;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æç¤ºæ¡ */
        .header-info {
            text-align: center;
            color: white;
            margin-bottom: 18px;
            animation: fadeIn 0.8s ease-out;
            padding: 12px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: var(--border-radius);
            position: relative;
        }

        .header-info.hidden {
            display: none;
        }

        .header-info h1 {
            font-size: 1.5rem;
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: -0.2px;
        }

        .header-info p {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 550px;
            margin: 0 auto;
        }

        /* æ˜¾ç¤º/éšè—æç¤ºæŒ‰é’® */
        .toggle-header-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .toggle-header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* ä¸»å¸ƒå±€ï¼šè°ƒæ•´å¡ç‰‡é¡ºåº */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 30px;
            position: relative;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        /* è°ƒæ•´å¡ç‰‡é¡ºåº */
        .main-layout .card:nth-child(1) {
            order: 1;
        }

        .main-layout .card:nth-child(2) {
            order: 3;
        }

        .main-layout .card:nth-child(3) {
            order: 2;
        }

        .main-layout .card:nth-child(4) {
            order: 4;
        }

        /* å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 0.6s ease-out;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        /* æ›´ç®€æ´çš„å¡ç‰‡å¤´éƒ¨ */
        .card-header {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
            color: white;
            padding: 10px 6px;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* æ›´å°çš„å¡ç‰‡æ ‡é¢˜ - å‰¯æ ‡é¢˜æ ·å¼ */
        .card-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            color: rgba(255, 255, 255, 0.95);
        }

        /* å¡ç‰‡æ ‡é¢˜å›¾æ ‡æ›´å° */
        .card-header h2 span {
            font-size: 12px;
        }

        .card-body {
            padding: 22px;
            flex: 1;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 22px;
        }

        .section:last-child {
            margin-bottom: 0;
        }

        /* æ›´å°çš„æ ‡é¢˜ */
        .section-title {
            font-size: 1rem;
            color: #4a5568;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .badge {
            background: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 16px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
            background: white;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.15);
            transform: translateY(-1px);
        }

        /* ç¦ç”¨çŠ¶æ€çš„è¾“å…¥æ¡† */
        textarea:disabled {
            background-color: #f7fafc;
            cursor: not-allowed;
            opacity: 0.7;
            border-color: #e2e8f0;
        }

        textarea {
            min-height: 120px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
            line-height: 1.4;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .btn {
            padding: 11px 18px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.25);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2da69a 0%, #25958a 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3a8fd9 0%, #2f7ec7 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
            color: white;
        }

        .btn-github {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .file-upload-container {
            margin-bottom: 16px;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 28px 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #fafbff;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }

        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: #e8edff;
        }

        .file-upload-area .upload-icon {
            font-size: 2.4rem;
            color: var(--primary-color);
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .file-upload-area p {
            color: #4a5568;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .file-upload-area small {
            color: #718096;
            font-size: 12px;
        }

        #fileInput {
            display: none;
        }

        .file-info {
            margin-top: 14px;
            padding: 14px;
            background: linear-gradient(135deg, #e8f4fd 0%, #d1e9ff 100%);
            border-radius: 5px;
            border: 1px solid #b6e0fe;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-info-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .file-size {
            font-size: 12px;
            color: #718096;
        }

        .remove-file-btn {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #c53030;
            border: none;
            border-radius: 4px;
            padding: 7px 14px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-file-btn:hover {
            background: linear-gradient(135deg, #feb2b2 0%, #fc8181 100%);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(252, 129, 129, 0.3);
        }

        /* é…ç½®è¡Œ */
        .config-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 16px;
        }

        /* GitHubé…ç½® - ä¿®æ”¹æ ·å¼ */
        .github-config {
            background: linear-gradient(135deg, #f6f8fa 0%, #f0f4f8 100%);
            border-radius: 6px;
            padding: 16px;
            padding-bottom: 1px;
            margin-top: 0px;
            border: 1px solid #e1e4e8;
            position: relative;
        }

        /* GitHubé…ç½®å¸®åŠ©æ–‡æœ¬ - æ”¾åœ¨å³ä¸Šè§’ */
        .github-config-help {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 11px;
            color: #718096;
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #e1e4e8;
        }

        .github-config-help a {
            color: #5d6de0;
            text-decoration: none;
            font-weight: 500;
        }

        .github-config-help a:hover {
            text-decoration: underline;
        }

        /* GitHubä¸‰ä¸ªé…ç½®é¡¹åœ¨ä¸€è¡Œæ˜¾ç¤º */
        .github-config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 120px;
            gap: 12px;
            margin-bottom: 14px;
        }

        @media (max-width: 768px) {
            .github-config-row {
                grid-template-columns: 1fr;
            }

            .github-config-help {
                position: static;
                margin-top: 10px;
            }
        }

        /* ç»“æœæ¡† */
        .result-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #5d6de0, #4a56d2);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .result-header h3 {
            color: #2d3748;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .result-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
            color: #4a5568;
        }

        .result-content.empty {
            color: #a0aec0;
            font-style: italic;
        }

        /* ç”Ÿæˆéƒ¨åˆ† */
        .generate-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
        }

        /* GitHubæŒ‰é’®åŒºåŸŸ - é‡æ–°è°ƒæ•´å¸ƒå±€ */
        .github-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 14px;
        }

        /* GitHubæŒ‰é’®ç¬¬ä¸€è¡Œ - ä¸‰ä¸ªæŒ‰é’® */
        .github-buttons-row1 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        /* GitHubæŒ‰é’®ç¬¬äºŒè¡Œ - ä¸‰ä¸ªæŒ‰é’® */
        .github-buttons-row2 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        /* GitHubæŒ‰é’®ç¬¬ä¸‰è¡Œ - æ–°å¸ƒå±€ï¼šä¸¤ä¸ªæŒ‰é’®å¹¶æ’ */
        .github-buttons-row3 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .github-buttons-row1 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row2 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row3 {
                grid-template-columns: 1fr;
            }
        }

        /* GitHubç»Ÿè®¡ */
        .github-stats {
            display: flex;
            gap: 14px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: white;
            padding: 10px 14px;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 16px;
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            padding: 18px;
            font-size: 13px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 18px;
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 14px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* æºæ ‡è®° */
        .source-badge {
            display: inline-block;
            background: linear-gradient(135deg, #e0559c, #e53e3e);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        /* å¸®åŠ©æ–‡æœ¬ */
        .help-text {
            font-size: 12px;
            color: #718096;
            margin-top: 6px;
            line-height: 1.4;
        }

        /* URLé€‰æ‹©å®¹å™¨ */
        .url-select-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 14px;
        }

        .custom-url-input {
            display: none;
        }

        .custom-url-input.show {
            display: block;
            margin-top: 10px;
        }

        /* å…¨å±€é€šçŸ¥çª—å£æ ·å¼ */
        .notification-container {
            position: fixed;
            top: 18px;
            right: 18px;
            z-index: 1000;
            max-width: 350px;
            width: 100%;
        }

        .notification {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 14px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid var(--primary-color);
            animation: slideInRight 0.4s ease-out;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #5d6de0, #4a56d2);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.success::before {
            background: linear-gradient(90deg, #2da69a, #25958a);
        }

        .notification.error {
            border-left-color: #e53e3e;
        }

        .notification.error::before {
            background: linear-gradient(90deg, #e53e3e, #e0559c);
        }

        .notification.info {
            border-left-color: var(--info-color);
        }

        .notification.info::before {
            background: linear-gradient(90deg, #3a8fd9, #2f7ec7);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .notification-time {
            font-size: 11px;
            color: #718096;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .notification-message {
            color: #4a5568;
            font-size: 13px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            padding: 0;
            transition: color 0.2s;
        }

        .notification-close:hover {
            color: #e53e3e;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* æ—¥å¿—è®°å½•åŒºåŸŸ */
        .log-section {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid #4a5568;
            color: white;
            display: none;
        }

        .log-section.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            border-bottom: 1px solid #718096;
            padding-bottom: 10px;
        }

        .log-header h3 {
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 600;
        }

        .log-controls {
            display: flex;
            gap: 10px;
        }

        .log-content {
            max-height: 180px;
            overflow-y: auto;
            background: #1a202c;
            border-radius: 5px;
            padding: 14px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #4a5568;
        }

        .log-entry:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .log-time {
            color: #a0aec0;
            font-size: 11px;
            margin-right: 10px;
        }

        .log-level {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 8px;
            text-transform: uppercase;
        }

        .log-level.info {
            background: rgba(66, 153, 225, 0.25);
            color: #63b3ed;
        }

        .log-level.success {
            background: rgba(56, 178, 172, 0.25);
            color: #81e6d9;
        }

        .log-level.error {
            background: rgba(245, 101, 101, 0.25);
            color: #fc8181;
        }

        .log-message {
            color: #cbd5e0;
        }

        /* ä¿®æ”¹ä¸Šä¼ æŒ‰é’®é¢œè‰² */
        .btn-local-upload {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            color: white;
        }

        .btn-merge-upload {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn-subscription-upload {
            background: linear-gradient(135deg, #0bc5ea 0%, #00b5d8 100%);
            color: white;
        }

        .btn-oneclick-sync {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
            color: white;
        }

        /* æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„æŒ‰é’® */
        .btn-merge-to-path {
            background: linear-gradient(135deg, #9b2c2c 0%, #822727 100%);
            color: white;
        }

        /* æ‰‹åŠ¨Vlessè½¬Base64è®¢é˜…è¾“å…¥æ¡† */
        #manualVlessInput {
            min-height: 90px;
            font-size: 13px;
            padding: 12px;
        }

        /* çŠ¶æ€æ¶ˆæ¯ */
        .status-message {
            padding: 14px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: none;
            animation: fadeIn 0.3s ease-out;
            border-left: 3px solid transparent;
        }

        .status-success {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            color: #22543d;
            border-left-color: #38a169;
            display: block;
        }

        .status-error {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #742a2a;
            border-left-color: #e53e3e;
            display: block;
        }

        .status-info {
            background: linear-gradient(135deg, #bee3f8 0%, #90cdf4 100%);
            color: #2a4365;
            border-left-color: #3182ce;
            display: block;
        }

        /* æ ‡ç­¾é¡µå¯¼èˆª - ä¿®å¤ï¼šç¡®ä¿æ ‡ç­¾é¡µä½œç”¨åŸŸç‹¬ç«‹ */
        .card-tab-navigation {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 6px;
        }

        .card-tab-btn {
            padding: 8px 16px;
            background: #f1f5f9;
            border: none;
            border-radius: 5px 5px 0 0;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            transition: var(--transition);
        }

        .card-tab-btn.active {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .card-tab-btn:hover:not(.active) {
            background: #e2e8f0;
        }

        .card-tab-content {
            display: none;
        }

        .card-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* é«˜çº§é…ç½®æŠ˜å é¢æ¿ */
        .accordion {
            margin-top: 16px;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid #e2e8f0;
            transition: var(--transition);
            font-size: 14px;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, #f1f3f5 0%, #e9ecef 100%);
        }

        .accordion-header .icon {
            transition: transform 0.3s;
            font-size: 13px;
        }

        .accordion-header.active .icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            padding: 16px;
            background: white;
            border-radius: 0 0 5px 5px;
            border: 1px solid #e2e8f0;
            border-top: none;
            display: none;
        }

        .accordion-content.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å¿«æ·æ“ä½œæŒ‰é’®ç»„ - è°ƒæ•´é¡ºåº */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 0 0 13px 0;
            justify-content: center;
        }

        .quick-btn {
            padding: 7px 14px;
            font-size: 13px;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quick-btn:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
        }

        /* èŠ‚ç‚¹è®¡æ•°å™¨ - ä¿®æ”¹ä¸ºæŒ‡å®šèƒŒæ™¯è‰² */
        .node-counter {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgb(24 85 204);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        /* åˆ†å‰²çº¿ */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 16px 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                font-size: 14px;
            }

            .header-info h1 {
                font-size: 1.4rem;
            }

            .header-info p {
                font-size: 0.85rem;
            }

            .card-header h2 {
                font-size: 1.05rem;
            }

            .config-row {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }

            .github-buttons-row1 {
                grid-template-columns: 1fr;
            }

            .github-buttons-row2 {
                grid-template-columns: 1fr;
            }

            .result-content {
                max-height: 180px;
            }

            .quick-actions {
                justify-content: flex-start;
            }
        }

        /* è¾“å…¥ç»„ */
        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 14px;
        }

        .input-group input {
            flex: 1;
        }

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 14px;
        }

        /* æé«˜é¥±å’Œåº¦ä½†é¿å…é©¬å…‹é¾™è‰²è°ƒ */
        .btn-primary:hover {
            background: linear-gradient(135deg, #4a56d2 0%, #3f4bbf 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #25958a 0%, #1e857a 100%);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #2f7ec7 0%, #276fb2 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #ce4a8c 0%, #be4081 100%);
        }

        .btn-github:hover {
            background: linear-gradient(135deg, #1a202c 0%, #0d1117 100%);
        }

        /* æ™ºèƒ½åˆ†å‰²è¯´æ˜ */
        .smart-split-info {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border-radius: 6px;
            padding: 14px;
            margin-top: 12px;
            border: 1px solid #81e6d9;
            font-size: 13px;
            color: #234e52;
        }

        .smart-split-info h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #234e52;
        }

        .smart-split-info ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }

        .smart-split-info li {
            margin-bottom: 4px;
        }

        /* CSVæ ¼å¼ç¤ºä¾‹ */
        .csv-example {
            background: #f7fafc;
            border-radius: 4px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            color: #4a5568;
            border: 1px dashed #cbd5e0;
        }

        /* ==================== */
        /* CSVåˆ—æ£€æµ‹ç»“æœæ ·å¼ - ç´§å‡‘ä¼˜åŒ–ç‰ˆ */
        /* ==================== */

        /* æ£€æµ‹ç»“æœæ¡†æ ·å¼ - æ›´ç´§å‡‘ */
        #columnDetectionResult {
            display: none;
            margin-bottom: 16px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #f8fdff 0%, #edf7ff 100%);
            border-radius: 8px;
            border: 1px solid #d1e9ff;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            box-shadow: 0 1px 4px rgba(14, 165, 233, 0.08);
            overflow: hidden;
            font-size: 13px;
        }

        /* å·¦ä¾§è£…é¥°æ¡ - æ›´ç»† */
        #columnDetectionResult::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #0ea5e9, #3b82f6);
            border-radius: 3px 0 0 3px;
        }

        /* æ£€æµ‹ç»“æœå¤´éƒ¨ - æ›´ç´§å‡‘ */
        #columnDetectionResult>div:first-child {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        /* æ£€æµ‹å›¾æ ‡å’Œæ ‡ç­¾ */
        #columnDetectionResult>div:first-child span:first-child {
            font-weight: 600;
            color: #1d4ed8;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            padding-top: 2px;
        }

        #columnDetectionResult>div:first-child span:first-child::before {
            font-size: 14px;
            opacity: 0.9;
        }

        /* æ£€æµ‹æ‘˜è¦ - ç´§å‡‘æ’åˆ— */
        #detectionSummary {
            font-weight: 500;
            color: #374151;
            font-size: 12.5px;
            line-height: 1.4;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            flex: 1;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        /* æ£€æµ‹è¯¦æƒ… - åªåœ¨éœ€è¦æ—¶æ˜¾ç¤º */
        #detectionDetails {
            display: none;
            /* é»˜è®¤éšè— */
            font-size: 12px;
            color: #4b5563;
            line-height: 1.5;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            margin-top: 10px;
            border-left: 3px solid #f59e0b;
        }

        #detectionDetails strong {
            color: #1e40af;
            font-weight: 600;
            font-size: 12px;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            #columnDetectionResult {
                padding: 12px 14px;
                margin-bottom: 14px;
            }

            #columnDetectionResult>div:first-child {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            #detectionSummary {
                width: 100%;
                font-size: 12px;
                padding: 6px 10px;
            }

            #detectionDetails {
                padding: 8px 10px;
                font-size: 11.5px;
            }
        }

        /* æ‚¬åœæ•ˆæœ */
        #columnDetectionResult:hover {
            border-color: #93c5fd;
            box-shadow: 0 2px 6px rgba(14, 165, 233, 0.12);
            transition: all 0.2s ease;
        }

        /* æ£€æµ‹æˆåŠŸçŠ¶æ€ */
        #columnDetectionResult.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #86efac;
        }

        #columnDetectionResult.success::before {
            background: linear-gradient(to bottom, #10b981, #059669);
        }

        #columnDetectionResult.success #detectionSummary {
            color: #065f46;
            border-color: #a7f3d0;
        }

        /* æ£€æµ‹è­¦å‘ŠçŠ¶æ€ */
        #columnDetectionResult.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: #fcd34d;
        }

        #columnDetectionResult.warning::before {
            background: linear-gradient(to bottom, #f59e0b, #d97706);
        }

        #columnDetectionResult.warning #detectionSummary {
            color: #92400e;
            border-color: #fde68a;
        }

        /* æé«˜æ•´ä½“é¥±å’Œåº¦ */
        body {
            background: linear-gradient(135deg, #5d6de0 0%, #6a4fa3 100%);
        }

        .card-header {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, #5d6de0 0%, #4a56d2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2da69a 0%, #25958a 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #3a8fd9 0%, #2f7ec7 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #e0559c 0%, #ce4a8c 100%);
        }

        .result-box::before {
            background: linear-gradient(to bottom, #5d6de0, #4a56d2);
        }

        /* element.style {
            margin-bottom: 0px;
            padding-bottom: 4px;
            padding-top: 4px;
        } */


        /* æ–°å¢ï¼šä»¤ç‰Œä¿å­˜é€‰é¡¹æ ·å¼ - ä¿®æ”¹ä¸ºå°æ–‡å­—æ˜¾ç¤ºåœ¨GitHubä»¤ç‰Œå³ä¾§ */
        .token-save-label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
            margin-bottom: 0Px;
            font-size: 11px;
            color: #718096;
            font-weight: normal;
            padding: 2px 6px;
            border: 1px solid #e2e8f0;
            border-radius: 3px;
            background: #f7fafc;
            cursor: pointer;
            user-select: none;
        }

        .token-save-label:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .token-save-label input[type="checkbox"] {
            width: 12px;
            height: 12px;
            margin: 0;
        }

        /* æ–°å¢ï¼šä¸Šä¼ æŒ‰é’®æ ·å¼ */
        .btn-upload-merged {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        /* æ–°å¢ï¼šè·¯å¾„é€‰æ‹©è¡Œå¸ƒå±€ */
        .path-select-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 1px;
        }

        @media (max-width: 768px) {
            .path-select-row {
                grid-template-columns: 1fr;
            }
        }

        /* æ–°å¢ï¼šä»¤ç‰Œè¾“å…¥ç»„æ ·å¼ */
        .token-input-group {
            position: relative;
            margin-bottom: 12px;
        }

        .token-label-container {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .token-label {
            margin-bottom: 0;
            margin-right: 8px;
        }

        /* æ–°å¢ï¼šè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ - æ›´ç®€æ´å¤§æ°” */
        .custom-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeInDialog 0.3s ease-out;
        }

        .custom-dialog {
            background: white;
            border-radius: 16px;
            padding: 32px;
            min-width: 420px;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUpDialog 0.4s ease-out;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .custom-dialog-header {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .custom-dialog-icon {
            background: linear-gradient(135deg, #5d6de0, #4a56d2);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
            font-weight: bold;
        }

        .custom-dialog-title {
            color: #2d3748;
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            line-height: 1.3;
        }

        .custom-dialog-content {
            color: #4a5568;
            font-size: 16px;
            line-height: 1.6;
            margin: 0 0 32px 0;
            padding: 0 8px;
        }

        .custom-dialog-content strong {
            color: #5d6de0;
            font-weight: 700;
        }

        .custom-dialog-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
        }

        .custom-dialog-btn {
            padding: 14px 28px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            min-width: 100px;
            letter-spacing: 0.3px;
        }

        .custom-dialog-btn-cancel {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }

        .custom-dialog-btn-cancel:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }

        .custom-dialog-btn-confirm {
            background: linear-gradient(135deg, #5d6de0, #4a56d2);
            color: white;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.3);
        }

        .custom-dialog-btn-confirm:hover {
            background: linear-gradient(135deg, #4a56d2, #3f4bbf);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.4);
        }

        /* è‡ªå®šä¹‰å¯¹è¯æ¡†åŠ¨ç”» */
        @keyframes fadeInDialog {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUpDialog {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* æˆåŠŸ/è­¦å‘Š/é”™è¯¯å¯¹è¯æ¡†çš„å›¾æ ‡é¢œè‰² */
        .custom-dialog.warning .custom-dialog-icon {
            background: linear-gradient(135deg, #e0559c, #ce4a8c);
        }

        .custom-dialog.error .custom-dialog-icon {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .custom-dialog.success .custom-dialog-icon {
            background: linear-gradient(135deg, #2da69a, #25958a);
        }
    </style>
</head>

<body>
    <!-- å…¨å±€é€šçŸ¥å®¹å™¨ -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- é¡¶éƒ¨ä¿¡æ¯æç¤ºæ¡ï¼ˆå¯éšè—ï¼‰ -->
        <div class="header-info" id="headerInfo">
            <button class="toggle-header-btn" id="toggleHeaderBtn">éšè—</button>
            <h1>VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·4.0</h1>
            <p>CSVè½¬Vless + Base64è®¢é˜… + GitHubè‡ªåŠ¨åŒæ­¥</p>
        </div>

        <!-- å¿«æ·æ“ä½œæŒ‰é’®ç»„ï¼ˆè°ƒæ•´äº†é¡ºåºï¼‰ -->
        <div class="quick-actions">
            <button class="quick-btn" onclick="generateVless()">
                <span>âš¡</span> ç”ŸæˆèŠ‚ç‚¹
            </button>
            <button class="quick-btn" onclick="downloadRemote()">
                <span>â¬‡ï¸</span> ä¸‹è½½è¿œç¨‹
            </button>
            <button class="quick-btn" onclick="mergeAndShow()">
                <span>ğŸ”„</span> åˆå¹¶èŠ‚ç‚¹
            </button>
            <button class="quick-btn" onclick="oneClickSync()">
                <span>ğŸš€</span> ä¸€é”®åŒæ­¥
            </button>
            <button class="quick-btn" onclick="uploadLocalBase64ToPath()">
                <span>ğŸ“¤</span> ä¸Šä¼ æœ¬åœ°è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
            </button>
            <button class="quick-btn" onclick="uploadMergedBase64()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¸»è¦è®¢é˜…
            </button>
            <button class="quick-btn" onclick="uploadMergedOptimal()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…
            </button>
            <button class="quick-btn" onclick="uploadPlainNodes()">
                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…
            </button>
            <button class="quick-btn" onclick="toggleLog()">
                <span>ğŸ“‹</span> æ˜¾ç¤ºæ—¥å¿—
            </button>
            <button class="quick-btn" onclick="document.getElementById('toggleHeaderBtn').click()">
                <span>ğŸ‘ï¸</span> æ˜¾ç¤º/éšè—æ ‡é¢˜
            </button>
        </div>

        <div class="main-layout">
            <!-- CSVæ•°æ®æºå¡ç‰‡ - æœ€å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“</span>
                        CSVæ•°æ®æº
                        <span id="sourceBadge" class="source-badge">æœªé€‰æ‹©</span>
                    </h2>
                </div>
                <div class="card-body">
                    <!-- CSVæ•°æ®æºæ ‡ç­¾é¡µå¯¼èˆª -->
                    <div class="card-tab-navigation" id="csvTabNav">
                        <button class="card-tab-btn active" data-tab="upload-tab">ä¸Šä¼ æ–‡ä»¶</button>
                        <button class="card-tab-btn" data-tab="paste-tab">ç²˜è´´å†…å®¹</button>
                        <button class="card-tab-btn" data-tab="config-tab">é…ç½®</button>
                    </div>

                    <!-- ä¸Šä¼ æ–‡ä»¶æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content active" id="upload-tab">
                        <div class="section">
                            <div class="file-upload-container">
                                <div class="file-upload-area" id="dropArea">
                                    <div class="upload-icon">ğŸ“</div>
                                    <p><strong>æ‹–æ”¾CSVæ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©</strong></p>
                                    <small>æ”¯æŒ.csvæˆ–.txtæ–‡ä»¶æ ¼å¼</small>
                                    <input type="file" id="fileInput" accept=".csv,.txt">
                                </div>

                                <div id="fileInfo" class="file-info">
                                    <div class="file-info-content">
                                        <div class="file-info-text">
                                            <span id="fileName" class="file-name"></span>
                                            <span id="fileSize" class="file-size"></span>
                                        </div>
                                        <button type="button" id="removeFileBtn" class="remove-file-btn">
                                            <span>ğŸ—‘ï¸</span> ç§»é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="section-title">
                                <span>ğŸ“Š CSVåˆ—é…ç½®</span>
                                <button class="btn btn-info"
                                    style="padding: 6px 12px; font-size: 12px; margin-left: auto;"
                                    onclick="autoDetectCSVColumns()">
                                    <span>ğŸ”</span> æ™ºèƒ½æ£€æµ‹åˆ—
                                </button>
                            </div>

                            <div id="columnDetectionResult"
                                style="display: none; margin-bottom: 16px; padding: 12px; background: #f0f9ff; border-radius: 6px; border: 1px solid #b6e0fe;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0px;">
                                    <span style="font-weight: bold; color: #1e40af;">ğŸ” æ£€æµ‹ç»“æœ:</span>
                                    <span id="detectionSummary" style="color: #4b5563;"></span>
                                </div>
                                <div style="font-size: 12px; color: #6b7280;" id="detectionDetails"></div>
                            </div>

                            <div class="config-row">
                                <div class="form-group">
                                    <label for="ipColumn">IPåœ°å€åˆ—</label>
                                    <input type="number" id="ipColumn" value="0" min="0">
                                    <div class="help-text">Aåˆ—=0ï¼ŒBåˆ—=1ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedIpCol">æœªæ£€æµ‹</span></div>
                                </div>
                                <div class="form-group">
                                    <label for="portColumn">ç«¯å£åˆ—</label>
                                    <input type="number" id="portColumn" value="-1" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— ç«¯å£åˆ—ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedPortCol">æœªæ£€æµ‹</span>
                                    </div>
                                </div>
                            </div>
                            <!-- æ–°å¢ï¼šCSVå…¶ä»–åˆ—é…ç½® -->
                            <div class="config-row">
                                <div class="form-group">
                                    <label for="cityColumn">åŸå¸‚åˆ—</label>
                                    <input type="number" id="cityColumn" value="-1" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— åŸå¸‚åˆ—ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedCityCol">æœªæ£€æµ‹</span></div>
                                </div>
                                <div class="form-group">
                                    <label for="countryColumn">å›½å®¶åˆ—</label>
                                    <input type="number" id="countryColumn" value="-1" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— å›½å®¶åˆ—ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedCountryCol">æœªæ£€æµ‹</span></div>
                                </div>
                            </div>
                            <div class="config-row">
                                <div class="form-group">
                                    <label for="regionColumn">åœ°åŒºç åˆ—</label>
                                    <input type="number" id="regionColumn" value="-1" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— åœ°åŒºç åˆ—ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedRegionCol">æœªæ£€æµ‹</span></div>
                                </div>
                                <div class="form-group">
                                    <label for="speedColumn">ä¸‹è½½é€Ÿåº¦åˆ—</label>
                                    <input type="number" id="speedColumn" value="-1" min="-1">
                                    <div class="help-text">-1è¡¨ç¤ºæ— ä¸‹è½½é€Ÿåº¦åˆ—ã€‚æ£€æµ‹åˆ°åˆ—ï¼š<span id="detectedSpeedCol">æœªæ£€æµ‹</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç²˜è´´å†…å®¹æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="paste-tab">
                        <div class="section">
                            <div class="section-title">
                                <span>ğŸ“ ç²˜è´´CSVæˆ–IPå’Œç«¯å£å†…å®¹</span>
                            </div>

                            <div class="form-group">
                                <label for="csvInput">CSVæ•°æ®å†…å®¹ï¼š</label>
                                <textarea id="csvInput" placeholder="æ”¯æŒå¤šç§æ ¼å¼ï¼Œæ™ºèƒ½åˆ†å‰²ï¼š
1. å•è¡Œæˆ–å¤šè¡Œæ ¼å¼ï¼š
2. ç´§å‡‘æ ¼å¼ï¼ˆä¸€è¡Œå¤šä¸ªï¼‰ï¼š
3. æ··åˆåˆ†éš”ç¬¦ï¼š
4. åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰ï¼š"></textarea>
                            </div>

                            <!-- æ™ºèƒ½åˆ†å‰²è¯´æ˜ -->
                            <div class="smart-split-info">
                                <h4>ğŸ“‹ æ™ºèƒ½åˆ†å‰²è¯´æ˜</h4>
                                <p>æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰ï¼š</p>
                                <ul>
                                    <li>IP:ç«¯å£ï¼ˆå†’å·åˆ†éš”ï¼‰</li>
                                    <li>IP,ç«¯å£ï¼ˆé€—å·åˆ†éš”ï¼‰</li>
                                    <li>IP ç«¯å£ï¼ˆå•ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åˆ†éš”ï¼‰</li>
                                    <li>IP;ç«¯å£ï¼ˆåˆ†å·åˆ†éš”ï¼‰</li>
                                    <li>åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰</li>
                                </ul>
                                <p>æ”¯æŒæ··åˆæ ¼å¼å’Œç´§å‡‘æ ¼å¼ï¼Œè‡ªåŠ¨å»é‡å’Œæ¸…ç†ã€‚</p>
                                <!-- CSVæ ¼å¼ç¤ºä¾‹ -->
                                <div class="csv-example">
                                    <strong>ç¤ºä¾‹ï¼š</strong><br>
                                    8.209.202.241:443<br>
                                    104.238.162.245,8080<br>
                                    45.76.123.234 8443<br>
                                    142.93.128.233<br>
                                    15.25.152.123 8443 (å¤šä¸ªç©ºæ ¼)
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- é…ç½®æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="config-tab">
                        <div class="section">
                            <div class="section-title">
                                <span>âš™ï¸ èŠ‚ç‚¹é…ç½®</span>
                            </div>

                            <div class="config-row">
                                <div class="form-group">
                                    <label for="defaultPort">é»˜è®¤ç«¯å£</label>
                                    <input type="number" id="defaultPort" value="443" min="1" max="65535">
                                </div>

                                <div class="form-group">
                                    <label for="remarksPrefix">åˆ«åå‰ç¼€</label>
                                    <input type="text" id="remarksPrefix" value="è‡ªé€‰">
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="forcePort443">
                                <label for="forcePort443"><strong>å¼ºåˆ¶æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨443ç«¯å£</strong></label>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="autoLocation" checked>
                                <label for="autoLocation"><strong>è‡ªåŠ¨è¯†åˆ«IPå±åœ°ç”Ÿæˆåˆ«å</strong></label>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="renameOnMerge" checked>
                                <label for="renameOnMerge"><strong>åˆå¹¶æ—¶é‡æ–°è®¾ç½®æ‰€æœ‰èŠ‚ç‚¹åˆ«å</strong></label>
                            </div>
                            <!-- æ–°å¢ï¼šä½¿ç”¨CSVä¿¡æ¯ç”Ÿæˆåˆ«å -->
                            <div class="checkbox-group">
                                <input type="checkbox" id="useCsvInfo" checked>
                                <label for="useCsvInfo"><strong>ä¼˜å…ˆä½¿ç”¨CSVä¿¡æ¯ç”Ÿæˆåˆ«å</strong></label>
                            </div>
                        </div>
                    </div>

                    <!-- ç”ŸæˆæŒ‰é’®åŒºåŸŸ -->
                    <div class="generate-section">
                        <div class="section-title">
                            <span>ğŸš€ ç”Ÿæˆæ“ä½œ</span>
                            <span id="localNodeCount" class="node-counter">0èŠ‚ç‚¹</span>
                        </div>

                        <button id="generateBtn" class="btn btn-primary btn-block">
                            <span>âš¡</span> ç”ŸæˆVlessèŠ‚ç‚¹
                        </button>

                        <div class="loading" id="loading">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                        </div>
                    </div>

                    <!-- é«˜çº§é…ç½®æŠ˜å é¢æ¿ -->
                    <div class="accordion">
                        <div class="accordion-header" id="advancedConfigToggle">
                            <span>âš™ï¸ é«˜çº§é…ç½®ï¼ˆå›ºå®šé»˜è®¤å€¼ï¼‰</span>
                            <span class="icon">â–¼</span>
                        </div>
                        <div class="accordion-content" id="advancedConfigContent">
                            <div class="config-row">
                                <div class="form-group">
                                    <label>ç”¨æˆ·ID (UUID)</label>
                                    <input type="text" id="uuid" value="471a8e64-7b21-4703-b1d1-45a221098459" readonly>
                                </div>

                                <div class="form-group">
                                    <label>ä¼ªè£…åŸŸå (Host)</label>
                                    <input type="text" id="host" value="knny.dpdns.org">
                                </div>
                            </div>

                            <div class="config-row">
                                <div class="form-group">
                                    <label>SNIåŸŸå</label>
                                    <input type="text" id="sni" value="knny.dpdns.org">
                                </div>

                                <div class="form-group">
                                    <label>æµè§ˆå™¨æŒ‡çº¹ (fp)</label>
                                    <input type="text" id="fp" value="chrome">
                                </div>
                            </div>

                            <div class="help-text">
                                å…¶ä»–å›ºå®šå‚æ•°ï¼š<br>
                                â€¢ åŠ å¯†æ–¹å¼ï¼šnone<br>
                                â€¢ ç½‘ç»œç±»å‹ï¼šws<br>
                                â€¢ Pathï¼š/<br>
                                â€¢ TLSï¼šå¯ç”¨<br>
                                â€¢ Flowï¼šç©º<br>
                                â€¢ ä¼ªè£…æ–¹å¼ï¼šç©º
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿæˆç»“æœå¡ç‰‡ - å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ“Š</span>
                        ç”Ÿæˆç»“æœï¼ˆèŠ‚ç‚¹æ±‡æ€»ï¼‰
                        <span id="resultCount" class="badge">0èŠ‚ç‚¹</span>
                    </h2>
                </div>
                <div class="card-body">
                    <!-- ç”Ÿæˆç»“æœæ ‡ç­¾é¡µ -->
                    <div class="card-tab-navigation" id="resultTabNav">
                        <button class="card-tab-btn active" data-tab="vless-tab">æœ¬åœ°Vless</button>
                        <button class="card-tab-btn" data-tab="local-base64-tab">æœ¬åœ°Base64</button>
                        <button class="card-tab-btn" data-tab="merged-tab">åˆå¹¶Vless</button>
                        <button class="card-tab-btn" data-tab="auto-base64-tab">åˆå¹¶Base64</button>
                    </div>

                    <!-- Vlessé“¾æ¥æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content active" id="vless-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Vlessé“¾æ¥ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰</h3>
                            <button id="copyVlessBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶å…¨éƒ¨Vlessé“¾æ¥
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="vless-links" class="result-content empty">Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>

                        <div class="button-group" style="margin-top: 14px;">
                            <!-- åªä¿ç•™ä¸€ä¸ªä¸‹è½½æŒ‰é’® -->
                            <button id="downloadAllBtn" class="btn btn-success">
                                <span>ğŸ“</span> ä¸‹è½½æ˜æ–‡è®¢é˜…æ–‡ä»¶
                            </button>
                        </div>
                    </div>

                    <!-- æœ¬åœ°Base64æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="local-base64-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Base64è®¢é˜…ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰</h3>
                            <button id="copyLocalBase64Btn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="localBase64Output" class="result-content empty">Base64è®¢é˜…å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                        <div class="help-text">
                            æ­¤Base64å¯ç›´æ¥ä½œä¸ºè®¢é˜…é“¾æ¥å¯¼å…¥Clashã€Shadowrocketç­‰å·¥å…·
                        </div>
                    </div>

                    <!-- åˆå¹¶ç»“æœæ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="merged-tab">
                        <div class="result-header">
                            <h3>ğŸ”„ åˆå¹¶ç»“æœé¢„è§ˆï¼ˆæ˜æ–‡ï¼‰</h3>
                            <button id="copyMergedBtn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶æ˜æ–‡
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="mergedResult" class="result-content empty">åˆå¹¶åçš„èŠ‚ç‚¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                    </div>

                    <!-- åˆå¹¶Base64è®¢é˜…æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="auto-base64-tab">
                        <div class="result-header">
                            <h3>ğŸ”— Base64è®¢é˜…ï¼ˆæœ¬åœ°+è¿œç¨‹åˆå¹¶ï¼‰</h3>
                            <button id="copyAutoBase64Btn" class="btn btn-success">
                                <span>ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                        </div>
                        <div class="result-box">
                            <div id="autoBase64Output" class="result-content empty">åˆå¹¶å»é‡åå°†è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…å†…å®¹...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GitHubåŒæ­¥å¡ç‰‡ - æ¬¡å¸¸ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ™</span>
                        GitHubè®¢é˜…åŒæ­¥
                        <span class="node-counter" id="syncNodeCount">0èŠ‚ç‚¹</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="github-config">
                        <!-- GitHubé…ç½®å¸®åŠ©æ–‡æœ¬ - æ”¾åœ¨å³ä¸Šè§’ -->
                        <div class="github-config-help">
                            GitHub APIä»¤ç‰Œ <a href="https://github.com/settings/tokens" target="_blank">è·å–ä»¤ç‰Œ</a>:éœ€repoæƒé™
                            <a href="#" onclick="copyGitToken()">å¤åˆ¶æŸ¥çœ‹ç¤ºä¾‹ä»¤ç‰Œ</a>
                        </div>

                        <div class="section-title">
                            <span>ğŸ”§ GitHubé…ç½®</span>
                        </div>

                        <!-- GitHubä¸‰ä¸ªé…ç½®é¡¹åœ¨ä¸€è¡Œæ˜¾ç¤º -->
                        <div class="github-config-row">
                            <div class="form-group">
                                <div class="token-label-container">
                                    <label for="githubToken" class="token-label">GitHubä»¤ç‰Œï¼š</label>
                                    <!-- ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨ - ä¿®æ”¹ä¸ºå°æ–‡å­—æ˜¾ç¤ºåœ¨æ ‡ç­¾å³ä¾§ -->
                                    <label class="token-save-label" for="saveToken">
                                        <input type="checkbox" id="saveToken" checked>
                                        ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨
                                    </label>
                                </div>
                                <input type="password" id="githubToken" placeholder="ghp_XXXXXXXXXXXXXXXXXXXX">
                            </div>

                            <div class="form-group">
                                <label for="githubRepo">GitHubä»“åº“ï¼š</label>
                                <input type="text" id="githubRepo" value="DaiZhouHui/CustomNode">
                            </div>

                            <div class="form-group">
                                <label for="githubBranch">åˆ†æ”¯ï¼š</label>
                                <input type="text" id="githubBranch" value="main">
                            </div>
                        </div>

                        <!-- æ–°å¢ï¼šä¼˜é€‰è®¢é˜…æ–‡ä»¶ã€ä¸»è¦è®¢é˜…æ–‡ä»¶ã€æ˜æ–‡è®¢é˜…æ–‡ä»¶ -->
                        <div class="config-row">
                            <div class="form-group">
                                <label for="optimalNodeFile">ä¼˜é€‰è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="optimalNodeFile" value="OptimalNode">
                            </div>

                            <div class="form-group">
                                <label for="mainNodeFile">ä¸»è¦è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="mainNodeFile" value="MainNode">
                            </div>

                            <div class="form-group">
                                <label for="plainNodeFile">æ˜æ–‡è®¢é˜…æ–‡ä»¶</label>
                                <input type="text" id="plainNodeFile" value="PlainNode">
                            </div>
                        </div>

                        <!-- è·¯å¾„é€‰æ‹©è¡Œ - ä¸¤ä¸ªé€‰æ‹©æ¡†åœ¨åŒä¸€è¡Œ -->
                        <div class="path-select-row">
                            <div class="form-group">
                                <label for="downloadUrlSelect">ä¸‹è½½è¿œç¨‹è®¢é˜…è·¯å¾„ï¼š</label>
                                <select id="downloadUrlSelect">
                                    <option value="MainNode">MainNodeï¼ˆä¸»è¦è®¢é˜…ï¼‰</option>
                                    <option value="OptimalNode">OptimalNodeï¼ˆä¼˜é€‰è®¢é˜…ï¼‰</option>
                                    <option value="PlainNode">PlainNodeï¼ˆæ˜æ–‡è®¢é˜…ï¼‰</option>
                                    <option value="custom">è‡ªå®šä¹‰è·¯å¾„</option>
                                </select>
                                <input type="text" id="customDownloadUrl" class="custom-url-input"
                                    placeholder="è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œå¦‚ï¼šOtherNode">
                                <div class="help-text">é€‰æ‹©è¦ä¸‹è½½çš„è¿œç¨‹è®¢é˜…æ–‡ä»¶è·¯å¾„</div>
                            </div>

                            <div class="form-group">
                                <label for="uploadPathSelect">è®¢é˜…å¾…ä¸Šä¼ è·¯å¾„ï¼š</label>
                                <select id="uploadPathSelect">
                                    <option value="OptimalNode">OptimalNodeï¼ˆä¼˜é€‰è®¢é˜…ï¼‰</option>
                                    <option value="MainNode">MainNodeï¼ˆä¸»è¦è®¢é˜…ï¼‰</option>
                                    <option value="PlainNode">PlainNodeï¼ˆæ˜æ–‡è®¢é˜…ï¼‰</option>
                                    <option value="custom">è‡ªå®šä¹‰è·¯å¾„</option>
                                </select>
                                <input type="text" id="customUploadPath" class="custom-url-input"
                                    placeholder="è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œå¦‚ï¼šOtherNode">
                                <div class="help-text">é€‰æ‹©è®¢é˜…çš„å¾…ä¸Šä¼ åˆ°è¿œç¨‹çš„è·¯å¾„</div>
                            </div>
                        </div>
                    </div>

                    <!-- GitHubæ“ä½œæŒ‰é’® - é‡æ–°è°ƒæ•´å¸ƒå±€ -->
                    <div class="github-buttons">
                        <!-- ç¬¬ä¸€è¡Œï¼šä¸‰ä¸ªæŒ‰é’® -->
                        <div class="github-buttons-row1">
                            <button id="downloadSubBtn" class="btn btn-primary">
                                <span>â¬‡ï¸</span> ä¸‹è½½è¿œç¨‹è®¢é˜…
                            </button>
                            <button id="mergeBtn" class="btn btn-success">
                                <span>ğŸ”„</span> æœ¬åœ°ä¸è¿œç¨‹åˆå¹¶å»é‡
                            </button>
                            <button id="uploadLocalBase64ToPathBtn" class="btn btn-local-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ æœ¬åœ°è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
                            </button>
                        </div>

                        <!-- ç¬¬äºŒè¡Œï¼šä¸‰ä¸ªæŒ‰é’® -->
                        <div class="github-buttons-row2">
                            <button id="uploadMergedOptimalBtn" class="btn btn-upload-merged">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…
                            </button>
                            <button id="uploadMergedBase64Btn" class="btn btn-subscription-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶çš„ä¸»è¦è®¢é˜…
                            </button>
                            <button id="uploadPlainNodesBtn" class="btn btn-merge-upload">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…
                            </button>
                        </div>

                        <!-- ç¬¬ä¸‰è¡Œï¼šæ–°å¢"ä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„"å’Œ"ä¸€é”®åŒæ­¥"æŒ‰é’® -->
                        <div class="github-buttons-row3">
                            <button id="uploadMergedToPathBtn" class="btn btn-merge-to-path btn-block">
                                <span>ğŸ“¤</span> ä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
                            </button>
                            <button id="syncBtn" class="btn btn-oneclick-sync btn-block">
                                <span>ğŸš€</span> ä¸€é”®åŒæ­¥ï¼ˆå…¨éƒ¨ä¸Šä¼ ï¼‰
                            </button>
                        </div>
                    </div>

                    <!-- GitHubç»Ÿè®¡ -->
                    <div class="github-stats" id="githubStats" style="display: none;">
                        <div class="stat-item">
                            <span class="stat-label">æœ¬åœ°èŠ‚ç‚¹</span>
                            <span class="stat-value" id="localNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">è¿œç¨‹èŠ‚ç‚¹</span>
                            <span class="stat-value" id="remoteNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">åˆå¹¶èŠ‚ç‚¹</span>
                            <span class="stat-value" id="mergedNodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å»é‡åèŠ‚ç‚¹</span>
                            <span class="stat-value" id="uniqueNodes">0</span>
                        </div>
                    </div>

                    <!-- æ—¥å¿—è®°å½•åŒºåŸŸ -->
                    <div class="log-section" id="logSection">
                        <div class="log-header">
                            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
                            <div class="log-controls">
                                <button id="clearLogBtn" class="btn btn-info"
                                    style="padding: 6px 12px; font-size: 12px;">
                                    <span>ğŸ—‘ï¸</span> æ¸…ç©ºæ—¥å¿—
                                </button>
                                <button id="toggleLogBtn" class="btn btn-info"
                                    style="padding: 6px 12px; font-size: 12px;">
                                    <span>ğŸ“‹</span> æ”¶èµ·æ—¥å¿—
                                </button>
                            </div>
                        </div>
                        <div class="log-content" id="logContent">
                            <div class="log-entry">
                                <span class="log-time" id="logTime">[ç³»ç»Ÿå¯åŠ¨]</span>
                                <span class="log-level info">ä¿¡æ¯</span>
                                <span class="log-message">VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·å·²å¯åŠ¨</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ‰‹åŠ¨è½¬æ¢å¡ç‰‡ - æœ€å°‘ç”¨ -->
            <div class="card">
                <div class="card-header">
                    <h2>
                        <span>ğŸ”„</span>
                        æ‰‹åŠ¨Vlessè½¬æ¢å·¥å…·
                    </h2>
                </div>
                <div class="card-body">
                    <!-- æ‰‹åŠ¨è½¬æ¢å·¥å…·æ ‡ç­¾é¡µå¯¼èˆª -->
                    <div class="card-tab-navigation" id="manualTabNav">
                        <button class="card-tab-btn active" data-tab="base64-tab">è½¬Base64</button>
                        <button class="card-tab-btn" data-tab="ip-port-tab">è½¬IP:ç«¯å£</button>
                    </div>

                    <!-- è½¬Base64æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content active" id="base64-tab">
                        <div class="form-group">
                            <label for="manualVlessInput">ç²˜è´´VlessèŠ‚ç‚¹ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                            <textarea id="manualVlessInput" placeholder="ç²˜è´´vless://å¼€å¤´çš„èŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
                        </div>
                        <div class="button-group">
                            <button id="convertToBase64Btn" class="btn btn-success">
                                <span>ğŸ”—</span> è½¬æ¢ä¸ºBase64
                            </button>
                            <button id="copyManualBase64Btn" class="btn btn-info">
                                <span>ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                        </div>
                        <div class="result-box" id="manualBase64Section" style="display: none; margin-top: 12px;">
                            <div class="result-header">
                                <h3>æ‰‹åŠ¨è½¬æ¢çš„Base64è®¢é˜…</h3>
                            </div>
                            <div id="manualBase64Output" class="result-content empty">Base64å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                    </div>

                    <!-- è½¬IP:ç«¯å£æ ‡ç­¾é¡µ -->
                    <div class="card-tab-content" id="ip-port-tab">
                        <div class="form-group">
                            <label for="manualVlessInput2">ç²˜è´´VlessèŠ‚ç‚¹ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                            <textarea id="manualVlessInput2" placeholder="ç²˜è´´vless://å¼€å¤´çš„èŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
                        </div>
                        <div class="button-group">
                            <button id="convertToIpPortBtn" class="btn btn-success">
                                <span>ğŸ”—</span> æå–IP:ç«¯å£
                            </button>
                            <button id="copyIpPortBtn" class="btn btn-info">
                                <span>ğŸ“‹</span> å¤åˆ¶IP:ç«¯å£
                            </button>
                            <button id="downloadIpPortBtn" class="btn btn-primary">
                                <span>ğŸ“</span> ä¸‹è½½TXT
                            </button>
                        </div>
                        <div class="result-box" id="manualIpPortSection" style="display: none; margin-top: 12px;">
                            <div class="result-header">
                                <h3>æå–çš„IP:ç«¯å£åˆ—è¡¨</h3>
                            </div>
                            <div id="manualIpPortOutput" class="result-content empty">IP:ç«¯å£åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Â© 2025 VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…· 4.0 ä¼˜åŒ–ç‰ˆ</p>
        </div>
    </div>
    <script>
        // å…¨å±€æ•°æ®
        let data = {
            vlessLinks: [],
            localBase64Content: '',  // æœ¬åœ°ç”Ÿæˆè‡ªåŠ¨Base64
            autoBase64Content: '',   // åˆå¹¶åè‡ªåŠ¨Base64
            manualBase64Content: '', // æ‰‹åŠ¨è½¬æ¢Base64
            manualIpPortContent: '', // æ‰‹åŠ¨æå–IP:ç«¯å£
            remoteNodes: [],
            uniqueNodes: [],
            nodeSha: null,
            plainSha: null,
            optimalSha: null, // æ–°å¢ï¼šä¼˜é€‰è®¢é˜…æ–‡ä»¶çš„sha
            locationSha: null, // æœ¬åœ°ç”ŸæˆBase64æ–‡ä»¶çš„sha
            stats: { local: 0, remote: 0, merged: 0, unique: 0 },
            currentSource: 'none',
            // æ–°å¢ï¼šç¼“å­˜ç®¡ç†æ•°æ®
            cache: {
                remoteNodes: [],      // è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜
                lastDownloadTime: 0,  // ä¸Šæ¬¡ä¸‹è½½æ—¶é—´æˆ³f
                downloadPath: '',     // ä¸Šæ¬¡ä¸‹è½½çš„è·¯å¾„
                needsUpdate: false,   // æ ‡è®°ç¼“å­˜æ˜¯å¦éœ€è¦æ›´æ–°
                lastLocalGeneration: 0 // ä¸Šæ¬¡æœ¬åœ°ç”ŸæˆèŠ‚ç‚¹æ—¶é—´
            },
            // æ–°å¢ï¼šCSVåˆ—æ£€æµ‹ç»“æœ
            csvColumnDetection: {
                ipColumn: 0,
                portColumn: -1,
                cityColumn: -1,
                countryColumn: -1,
                regionColumn: -1,
                speedColumn: -1,
                hasHeader: false,
                detected: false
            }
        };

        // æ–°å¢ï¼šåœ°åŒºç åˆ°ä¸­æ–‡åç§°çš„æ˜ å°„
        const regionCodeToChinese = {
            // åŒ—ç¾åœ°åŒº - ç¾å›½åŸå¸‚
            'LAX': 'æ´›æ‰çŸ¶', 'SJC': 'åœ£ä½•å¡', 'SFO': 'æ—§é‡‘å±±', 'NYC': 'çº½çº¦', 'MIA': 'è¿ˆé˜¿å¯†',
            'DFW': 'è¾¾æ‹‰æ–¯', 'ORD': 'èŠåŠ å“¥', 'ATL': 'äºšç‰¹å…°å¤§', 'SEA': 'è¥¿é›…å›¾', 'IAD': 'åç››é¡¿',
            'DEN': 'ä¸¹ä½›', 'PHX': 'è²å°¼å…‹æ–¯', 'LAS': 'æ‹‰æ–¯ç»´åŠ æ–¯', 'BOS': 'æ³¢å£«é¡¿', 'PDX': 'æ³¢ç‰¹å…°',
            'AUS': 'å¥¥æ–¯æ±€', 'MSP': 'æ˜å°¼é˜¿æ³¢åˆ©æ–¯', 'DTW': 'åº•ç‰¹å¾‹', 'CLE': 'å…‹åˆ©å¤«å…°', 'PHL': 'è´¹åŸ',
            'HOU': 'ä¼‘æ–¯é¡¿', 'SLC': 'ç›æ¹–åŸ', 'MCO': 'å¥¥å…°å¤š', 'TPA': 'å¦å¸•', 'BNA': 'çº³ä»€ç»´å°”',

            // åŒ—ç¾åœ°åŒº - ç¾å›½å·ä»£ç 
            'CA': 'åŠ åˆ©ç¦å°¼äºš', 'NY': 'çº½çº¦', 'TX': 'å¾—å…‹è¨æ–¯', 'FL': 'ä½›ç½—é‡Œè¾¾', 'IL': 'ä¼Šåˆ©è¯ºä¼Š',
            'PA': 'å®¾å¤•æ³•å°¼äºš', 'OH': 'ä¿„äº¥ä¿„', 'GA': 'ä½æ²»äºš', 'NC': 'åŒ—å¡ç½—æ¥çº³', 'MI': 'å¯†æ­‡æ ¹',
            'NJ': 'æ–°æ³½è¥¿', 'VA': 'å¼—å‰å°¼äºš', 'WA': 'åç››é¡¿', 'MA': 'é©¬è¨è¯¸å¡', 'IN': 'å°ç¬¬å®‰çº³',
            'AZ': 'äºšåˆ©æ¡‘é‚£', 'TN': 'ç”°çº³è¥¿', 'MO': 'å¯†è‹é‡Œ', 'MD': 'é©¬é‡Œå…°', 'WI': 'å¨æ–¯åº·æ˜Ÿ',
            'MN': 'æ˜å°¼è‹è¾¾', 'CO': 'ç§‘ç½—æ‹‰å¤š', 'AL': 'é˜¿æ‹‰å·´é©¬', 'SC': 'å—å¡ç½—æ¥çº³', 'LA': 'è·¯æ˜“æ–¯å®‰é‚£',
            'KY': 'è‚¯å¡”åŸº', 'OR': 'ä¿„å‹’å†ˆ', 'OK': 'ä¿„å…‹æ‹‰è·é©¬', 'CT': 'åº·æ¶…ç‹„æ ¼', 'IA': 'çˆ±è·å',
            'MS': 'å¯†è¥¿è¥¿æ¯”', 'AR': 'é˜¿è‚¯è‰²', 'KS': 'å ªè¨æ–¯', 'UT': 'çŠ¹ä»–', 'NV': 'å†…åè¾¾',
            'NM': 'æ–°å¢¨è¥¿å“¥', 'NE': 'å†…å¸ƒæ‹‰æ–¯åŠ ', 'WV': 'è¥¿å¼—å‰å°¼äºš', 'ID': 'çˆ±è¾¾è·', 'HI': 'å¤å¨å¤·',
            'ME': 'ç¼…å› ', 'NH': 'æ–°ç½•å¸ƒä»€å°”', 'RI': 'ç½—å¾·å²›', 'MT': 'è’™å¤§æ‹¿', 'DE': 'ç‰¹æ‹‰å',
            'SD': 'å—è¾¾ç§‘ä»–', 'ND': 'åŒ—è¾¾ç§‘ä»–', 'AK': 'é˜¿æ‹‰æ–¯åŠ ', 'VT': 'ä½›è’™ç‰¹', 'WY': 'æ€€ä¿„æ˜',

            // åŠ æ‹¿å¤§ - åŸå¸‚
            'YYZ': 'å¤šä¼¦å¤š', 'YVR': 'æ¸©å“¥å', 'YUL': 'è’™ç‰¹åˆ©å°”', 'YYC': 'å¡å°”åŠ é‡Œ', 'YEG': 'åŸƒå¾·è’™é¡¿',
            'YOW': 'æ¸¥å¤ªå', 'YHZ': 'å“ˆåˆ©æ³•å…‹æ–¯', 'YWG': 'æ¸©å°¼ä¼¯', 'YYJ': 'ç»´å¤šåˆ©äºš',

            // åŠ æ‹¿å¤§ - çœä»½ä»£ç 
            'ON': 'å®‰å¤§ç•¥', 'QC': 'é­åŒ—å…‹', 'BC': 'ä¸åˆ—é¢ å“¥ä¼¦æ¯”äºš', 'AB': 'è‰¾ä¼¯å¡”', 'MB': 'é©¬å°¼æ‰˜å·´',
            'SK': 'è¨æ–¯å–€å½»æ¸©', 'NS': 'æ–°æ–¯ç§‘èˆ', 'NB': 'æ–°ä¸ä¼¦ç‘å…‹', 'NL': 'çº½èŠ¬å…°ä¸æ‹‰å¸ƒæ‹‰å¤š',
            'PE': 'çˆ±å¾·åç‹å­å²›', 'NT': 'è¥¿åŒ—åœ°åŒº', 'YT': 'è‚²ç©º', 'NU': 'åŠªçº³æ­¦ç‰¹',

            // å¢¨è¥¿å“¥
            'MEX': 'å¢¨è¥¿å“¥åŸ', 'GDL': 'ç“œè¾¾æ‹‰å“ˆæ‹‰', 'TIJ': 'è’‚åçº³',

            // æ—¥æœ¬åœ°åŒº - åŸå¸‚
            'TYO': 'ä¸œäº¬', 'OSA': 'å¤§é˜ª', 'NRT': 'æˆç”°', 'HND': 'ç¾½ç”°', 'KIX': 'å…³è¥¿',
            'ITM': 'ä¼Šä¸¹', 'FUK': 'ç¦å†ˆ', 'CTS': 'æœ­å¹Œ', 'NGO': 'åå¤å±‹', 'OKA': 'å†²ç»³',

            // æ—¥æœ¬ - åœ°åŒºä»£ç 
            'TK': 'ä¸œäº¬éƒ½', 'OS': 'å¤§é˜ªåºœ', 'KY': 'äº¬éƒ½åºœ', 'HK': 'åŒ—æµ·é“', 'FK': 'ç¦å†ˆå¿',
            'NG': 'çˆ±çŸ¥å¿', 'OK': 'å†²ç»³å¿', 'HI': 'å¹¿å²›å¿', 'SG': 'ç¥å¥ˆå·å¿', 'CH': 'åƒå¶å¿',
            'ST': 'åŸ¼ç‰å¿',

            // éŸ©å›½åœ°åŒº - åŸå¸‚
            'ICN': 'é¦–å°”ä»å·', 'GMP': 'é¦–å°”é‡‘æµ¦', 'PUS': 'é‡œå±±', 'CJU': 'æµå·', 'TAE': 'å¤§é‚±',

            // éŸ©å›½ - åœ°åŒºä»£ç 
            'SE': 'é¦–å°”', 'BS': 'é‡œå±±', 'DG': 'å¤§é‚±', 'IC': 'ä»å·', 'GJ': 'å…‰å·',
            'DJ': 'å¤§ç”°', 'US': 'è”šå±±', 'SJ': 'ä¸–å®—', 'JJ': 'æµå·',

            // é¦™æ¸¯åœ°åŒº
            'HKG': 'é¦™æ¸¯', 'HK': 'é¦™æ¸¯',

            // æ¾³é—¨åœ°åŒº
            'MFM': 'æ¾³é—¨', 'MO': 'æ¾³é—¨',

            // å°æ¹¾åœ°åŒº - åŸå¸‚
            'TPE': 'å°åŒ—æ¡ƒå›­', 'TSA': 'å°åŒ—æ¾å±±', 'KHH': 'é«˜é›„', 'RMQ': 'å°ä¸­', 'TNN': 'å°å—',

            // å°æ¹¾ - åœ°åŒºä»£ç 
            'TP': 'å°åŒ—', 'KH': 'é«˜é›„', 'TC': 'å°ä¸­', 'TN': 'å°å—', 'TY': 'æ¡ƒå›­',
            'KS': 'åŸºéš†', 'HC': 'æ–°ç«¹', 'CH': 'å½°åŒ–',

            // æ–°åŠ å¡åœ°åŒº
            'SIN': 'æ–°åŠ å¡', 'SG': 'æ–°åŠ å¡',

            // æ³°å›½ - åŸå¸‚
            'BKK': 'æ›¼è°·ç´ ä¸‡é‚£æ™®', 'DMK': 'æ›¼è°·å»Šæ›¼', 'HKT': 'æ™®å‰å²›', 'CNX': 'æ¸…è¿ˆ',

            // æ³°å›½ - åœ°åŒºä»£ç 
            'BK': 'æ›¼è°·', 'CM': 'æ¸…è¿ˆ', 'PH': 'æ™®å‰', 'PT': 'èŠ­å ¤é›…', 'CR': 'æ¸…è±',
            'HK': 'åæ¬£',

            // è¶Šå— - åŸå¸‚
            'SGN': 'èƒ¡å¿—æ˜å¸‚', 'HAN': 'æ²³å†…', 'DAD': 'å²˜æ¸¯',

            // é©¬æ¥è¥¿äºš - åŸå¸‚
            'KUL': 'å‰éš†å¡', 'PEN': 'æ§ŸåŸ', 'BKI': 'äºšåº‡',

            // å°åº¦å°¼è¥¿äºš - åŸå¸‚
            'CGK': 'é›…åŠ è¾¾', 'DPS': 'å·´å˜å²›', 'SUB': 'æ³—æ°´',

            // è²å¾‹å®¾ - åŸå¸‚
            'MNL': 'é©¬å°¼æ‹‰', 'CEB': 'å®¿åŠ¡',

            // å°åº¦ - åŸå¸‚
            'DEL': 'å¾·é‡Œ', 'BOM': 'å­Ÿä¹°', 'MAA': 'é‡‘å¥ˆ', 'CCU': 'åŠ å°”å„ç­”',

            // æ¬§æ´² - è‹±å›½åŸå¸‚
            'LHR': 'ä¼¦æ•¦', 'LGW': 'ä¼¦æ•¦ç›–ç‰¹å¨å…‹', 'MAN': 'æ›¼å½»æ–¯ç‰¹', 'BHX': 'ä¼¯æ˜ç¿°', 'GLA': 'æ ¼æ‹‰æ–¯å“¥',
            'EDI': 'çˆ±ä¸å ¡', 'BRS': 'å¸ƒé‡Œæ–¯æ‰˜å°”',

            // è‹±å›½ - åœ°åŒºä»£ç 
            'LN': 'ä¼¦æ•¦', 'MN': 'æ›¼å½»æ–¯ç‰¹', 'BH': 'ä¼¯æ˜ç¿°', 'GL': 'æ ¼æ‹‰æ–¯å“¥', 'ED': 'çˆ±ä¸å ¡',
            'LV': 'åˆ©ç‰©æµ¦', 'LF': 'åˆ©å…¹',

            // æ³•å›½ - åŸå¸‚
            'CDG': 'å·´é»', 'ORY': 'å·´é»å¥¥åˆ©', 'MRS': 'é©¬èµ›', 'LYS': 'é‡Œæ˜‚', 'NCE': 'å°¼æ–¯',
            'TLS': 'å›¾å¢å…¹',

            // å¾·å›½ - åŸå¸‚
            'FRA': 'æ³•å…°å…‹ç¦', 'MUC': 'æ…•å°¼é»‘', 'DUS': 'æœå¡å°”å¤šå¤«', 'HAM': 'æ±‰å ¡', 'BER': 'æŸæ—',
            'STR': 'æ–¯å›¾åŠ ç‰¹',

            // æ„å¤§åˆ© - åŸå¸‚
            'FCO': 'ç½—é©¬', 'MXP': 'ç±³å…°', 'LIN': 'ç±³å…°åˆ©çº³ç‰¹', 'VCE': 'å¨å°¼æ–¯', 'FLR': 'ä½›ç½—ä¼¦è¨',
            'NAP': 'é‚£ä¸å‹’æ–¯',

            // è¥¿ç­ç‰™ - åŸå¸‚
            'MAD': 'é©¬å¾·é‡Œ', 'BCN': 'å·´å¡ç½—é‚£', 'AGP': 'é©¬æ‹‰åŠ ', 'VLC': 'ç“¦ä¼¦è¥¿äºš', 'SVQ': 'å¡ç»´åˆ©äºš',

            // è·å…°
            'AMS': 'é˜¿å§†æ–¯ç‰¹ä¸¹',

            // ç‘å£«
            'ZRH': 'è‹é»ä¸–', 'GVA': 'æ—¥å†…ç“¦',

            // å…¶ä»–æ¬§æ´²
            'BRU': 'å¸ƒé²å¡å°”', 'VIE': 'ç»´ä¹Ÿçº³', 'CPH': 'å“¥æœ¬å“ˆæ ¹', 'ARN': 'æ–¯å¾·å“¥å°”æ‘©',
            'OSL': 'å¥¥æ–¯é™†', 'HEL': 'èµ«å°”è¾›åŸº', 'WAW': 'åæ²™', 'PRG': 'å¸ƒæ‹‰æ ¼',
            'BUD': 'å¸ƒè¾¾ä½©æ–¯', 'DUB': 'éƒ½æŸæ—', 'LIS': 'é‡Œæ–¯æœ¬', 'ATH': 'é›…å…¸',
            'IST': 'ä¼Šæ–¯å¦å¸ƒå°”',

            // å¤§æ´‹æ´² - æ¾³å¤§åˆ©äºšåŸå¸‚
            'SYD': 'æ‚‰å°¼', 'MEL': 'å¢¨å°”æœ¬', 'BNE': 'å¸ƒé‡Œæ–¯ç­', 'PER': 'ç€æ–¯', 'ADL': 'é˜¿å¾·è±å¾·',
            'CBR': 'å ªåŸ¹æ‹‰',

            // æ¾³å¤§åˆ©äºš - å·ä»£ç 
            'NSW': 'æ–°å—å¨å°”å£«', 'VIC': 'ç»´å¤šåˆ©äºš', 'QLD': 'æ˜†å£«å…°', 'WA': 'è¥¿æ¾³å¤§åˆ©äºš',
            'SA': 'å—æ¾³å¤§åˆ©äºš', 'TAS': 'å¡”æ–¯é©¬å°¼äºš', 'ACT': 'é¦–éƒ½é¢†åœ°', 'NT': 'åŒ—é¢†åœ°',

            // æ–°è¥¿å…°
            'AKL': 'å¥¥å…‹å…°', 'WLG': 'æƒ çµé¡¿', 'CHC': 'åŸºç£åŸ',

            // ä¸­ä¸œåœ°åŒº
            'DXB': 'è¿ªæ‹œ', 'AUH': 'é˜¿å¸ƒæ‰æ¯”', 'DOH': 'å¤šå“ˆ', 'RUH': 'åˆ©é›…å¾—', 'JED': 'å‰è¾¾',
            'TLV': 'ç‰¹æ‹‰ç»´å¤«',

            // å—ç¾åœ°åŒº
            'GRU': 'åœ£ä¿ç½—', 'GIG': 'é‡Œçº¦çƒ­å†…å¢', 'EZE': 'å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯', 'SCL': 'åœ£åœ°äºšå“¥',
            'LIM': 'åˆ©é©¬', 'BOG': 'æ³¢å“¥å¤§',

            // éæ´²åœ°åŒº
            'JNB': 'çº¦ç¿°å†…æ–¯å ¡', 'CPT': 'å¼€æ™®æ•¦', 'CAI': 'å¼€ç½—', 'NBO': 'å†…ç½—æ¯•', 'ADD': 'äºšçš„æ–¯äºšè´å·´'
        };


        // æ–°å¢ï¼šè‹±æ–‡å›½å®¶ååˆ°ä¸­æ–‡çš„æ˜ å°„
        const countryNameToChinese = {
            // äºšæ´²
            'China': 'ä¸­å›½', 'CN': 'ä¸­å›½', 'Japan': 'æ—¥æœ¬', 'JP': 'æ—¥æœ¬', 'South Korea': 'éŸ©å›½',
            'Korea, Republic of': 'éŸ©å›½', 'Korea': 'éŸ©å›½', 'KR': 'éŸ©å›½', 'North Korea': 'æœé²œ',
            'Korea, Democratic People\'s Republic of': 'æœé²œ', 'KP': 'æœé²œ', 'Singapore': 'æ–°åŠ å¡',
            'SG': 'æ–°åŠ å¡', 'Hong Kong': 'é¦™æ¸¯', 'Hong Kong SAR': 'é¦™æ¸¯', 'HK': 'é¦™æ¸¯',
            'Macau': 'æ¾³é—¨', 'Macao SAR': 'æ¾³é—¨', 'MO': 'æ¾³é—¨', 'Taiwan': 'å°æ¹¾',
            'Taiwan, Province of China': 'å°æ¹¾', 'TW': 'å°æ¹¾', 'Thailand': 'æ³°å›½', 'TH': 'æ³°å›½',
            'Vietnam': 'è¶Šå—', 'VN': 'è¶Šå—', 'Malaysia': 'é©¬æ¥è¥¿äºš', 'MY': 'é©¬æ¥è¥¿äºš',
            'Indonesia': 'å°åº¦å°¼è¥¿äºš', 'ID': 'å°åº¦å°¼è¥¿äºš', 'Philippines': 'è²å¾‹å®¾', 'PH': 'è²å¾‹å®¾',
            'India': 'å°åº¦', 'IN': 'å°åº¦', 'Pakistan': 'å·´åŸºæ–¯å¦', 'PK': 'å·´åŸºæ–¯å¦',
            'Bangladesh': 'å­ŸåŠ æ‹‰å›½', 'BD': 'å­ŸåŠ æ‹‰å›½', 'Sri Lanka': 'æ–¯é‡Œå…°å¡', 'LK': 'æ–¯é‡Œå…°å¡',
            'Myanmar': 'ç¼…ç”¸', 'MM': 'ç¼…ç”¸', 'Cambodia': 'æŸ¬åŸ”å¯¨', 'KH': 'æŸ¬åŸ”å¯¨', 'Laos': 'è€æŒ',
            'LA': 'è€æŒ', 'Mongolia': 'è’™å¤', 'MN': 'è’™å¤', 'Nepal': 'å°¼æ³Šå°”', 'NP': 'å°¼æ³Šå°”',
            'Bhutan': 'ä¸ä¸¹', 'BT': 'ä¸ä¸¹', 'Maldives': 'é©¬å°”ä»£å¤«', 'MV': 'é©¬å°”ä»£å¤«',
            'Brunei': 'æ–‡è±', 'BN': 'æ–‡è±', 'East Timor': 'ä¸œå¸æ±¶', 'TL': 'ä¸œå¸æ±¶',

            // ä¸­ä¸œ
            'Iran': 'ä¼Šæœ—', 'IR': 'ä¼Šæœ—', 'Iraq': 'ä¼Šæ‹‰å…‹', 'IQ': 'ä¼Šæ‹‰å…‹', 'Saudi Arabia': 'æ²™ç‰¹é˜¿æ‹‰ä¼¯',
            'SA': 'æ²™ç‰¹é˜¿æ‹‰ä¼¯', 'United Arab Emirates': 'é˜¿è”é…‹', 'AE': 'é˜¿è”é…‹', 'Qatar': 'å¡å¡”å°”',
            'QA': 'å¡å¡”å°”', 'Oman': 'é˜¿æ›¼', 'OM': 'é˜¿æ›¼', 'Kuwait': 'ç§‘å¨ç‰¹', 'KW': 'ç§‘å¨ç‰¹',
            'Bahrain': 'å·´æ—', 'BH': 'å·´æ—', 'Jordan': 'çº¦æ—¦', 'JO': 'çº¦æ—¦', 'Lebanon': 'é»å·´å«©',
            'LB': 'é»å·´å«©', 'Syria': 'å™åˆ©äºš', 'SY': 'å™åˆ©äºš', 'Yemen': 'ä¹Ÿé—¨', 'YE': 'ä¹Ÿé—¨',
            'Israel': 'ä»¥è‰²åˆ—', 'IL': 'ä»¥è‰²åˆ—', 'Palestine': 'å·´å‹’æ–¯å¦', 'PS': 'å·´å‹’æ–¯å¦',
            'Turkey': 'åœŸè€³å…¶', 'TR': 'åœŸè€³å…¶',

            // æ¬§æ´²
            'Russia': 'ä¿„ç½—æ–¯', 'RU': 'ä¿„ç½—æ–¯', 'United Kingdom': 'è‹±å›½', 'UK': 'è‹±å›½', 'GB': 'è‹±å›½',
            'Germany': 'å¾·å›½', 'DE': 'å¾·å›½', 'France': 'æ³•å›½', 'FR': 'æ³•å›½', 'Italy': 'æ„å¤§åˆ©',
            'IT': 'æ„å¤§åˆ©', 'Spain': 'è¥¿ç­ç‰™', 'ES': 'è¥¿ç­ç‰™', 'Netherlands': 'è·å…°', 'NL': 'è·å…°',
            'Belgium': 'æ¯”åˆ©æ—¶', 'BE': 'æ¯”åˆ©æ—¶', 'Switzerland': 'ç‘å£«', 'CH': 'ç‘å£«', 'Sweden': 'ç‘å…¸',
            'SE': 'ç‘å…¸', 'Norway': 'æŒªå¨', 'NO': 'æŒªå¨', 'Finland': 'èŠ¬å…°', 'FI': 'èŠ¬å…°',
            'Denmark': 'ä¸¹éº¦', 'DK': 'ä¸¹éº¦', 'Poland': 'æ³¢å…°', 'PL': 'æ³¢å…°', 'Austria': 'å¥¥åœ°åˆ©',
            'AT': 'å¥¥åœ°åˆ©', 'Portugal': 'è‘¡è„ç‰™', 'PT': 'è‘¡è„ç‰™', 'Ireland': 'çˆ±å°”å…°', 'IE': 'çˆ±å°”å…°',
            'Greece': 'å¸Œè…Š', 'GR': 'å¸Œè…Š', 'Czech Republic': 'æ·å…‹', 'CZ': 'æ·å…‹', 'Hungary': 'åŒˆç‰™åˆ©',
            'HU': 'åŒˆç‰™åˆ©', 'Romania': 'ç½—é©¬å°¼äºš', 'RO': 'ç½—é©¬å°¼äºš', 'Bulgaria': 'ä¿åŠ åˆ©äºš',
            'BG': 'ä¿åŠ åˆ©äºš', 'Serbia': 'å¡å°”ç»´äºš', 'RS': 'å¡å°”ç»´äºš', 'Croatia': 'å…‹ç½—åœ°äºš',
            'HR': 'å…‹ç½—åœ°äºš', 'Slovakia': 'æ–¯æ´›ä¼å…‹', 'SK': 'æ–¯æ´›ä¼å…‹', 'Slovenia': 'æ–¯æ´›æ–‡å°¼äºš',
            'SI': 'æ–¯æ´›æ–‡å°¼äºš', 'Estonia': 'çˆ±æ²™å°¼äºš', 'EE': 'çˆ±æ²™å°¼äºš', 'Latvia': 'æ‹‰è„±ç»´äºš',
            'LV': 'æ‹‰è„±ç»´äºš', 'Lithuania': 'ç«‹é™¶å®›', 'LT': 'ç«‹é™¶å®›', 'Ukraine': 'ä¹Œå…‹å…°',
            'UA': 'ä¹Œå…‹å…°', 'Belarus': 'ç™½ä¿„ç½—æ–¯', 'BY': 'ç™½ä¿„ç½—æ–¯', 'Moldova': 'æ‘©å°”å¤šç“¦',
            'MD': 'æ‘©å°”å¤šç“¦', 'Albania': 'é˜¿å°”å·´å°¼äºš', 'AL': 'é˜¿å°”å·´å°¼äºš', 'Macedonia': 'åŒ—é©¬å…¶é¡¿',
            'MK': 'åŒ—é©¬å…¶é¡¿', 'Montenegro': 'é»‘å±±', 'ME': 'é»‘å±±', 'Bosnia and Herzegovina': 'æ³¢é»‘',
            'BA': 'æ³¢é»‘',

            // åŒ—ç¾
            'United States': 'ç¾å›½', 'United States of America': 'ç¾å›½', 'USA': 'ç¾å›½', 'US': 'ç¾å›½',
            'Canada': 'åŠ æ‹¿å¤§', 'CA': 'åŠ æ‹¿å¤§', 'Mexico': 'å¢¨è¥¿å“¥', 'MX': 'å¢¨è¥¿å“¥', 'Cuba': 'å¤å·´',
            'CU': 'å¤å·´', 'Jamaica': 'ç‰™ä¹°åŠ ', 'JM': 'ç‰™ä¹°åŠ ', 'Dominican Republic': 'å¤šç±³å°¼åŠ ',
            'DO': 'å¤šç±³å°¼åŠ ', 'Haiti': 'æµ·åœ°', 'HT': 'æµ·åœ°', 'Bahamas': 'å·´å“ˆé©¬', 'BS': 'å·´å“ˆé©¬',

            // å—ç¾
            'Brazil': 'å·´è¥¿', 'BR': 'å·´è¥¿', 'Argentina': 'é˜¿æ ¹å»·', 'AR': 'é˜¿æ ¹å»·', 'Chile': 'æ™ºåˆ©',
            'CL': 'æ™ºåˆ©', 'Colombia': 'å“¥ä¼¦æ¯”äºš', 'CO': 'å“¥ä¼¦æ¯”äºš', 'Peru': 'ç§˜é²', 'PE': 'ç§˜é²',
            'Venezuela': 'å§”å†…ç‘æ‹‰', 'VE': 'å§”å†…ç‘æ‹‰', 'Ecuador': 'å„ç“œå¤šå°”', 'EC': 'å„ç“œå¤šå°”',
            'Bolivia': 'ç»åˆ©ç»´äºš', 'BO': 'ç»åˆ©ç»´äºš', 'Paraguay': 'å·´æ‹‰åœ­', 'PY': 'å·´æ‹‰åœ­',
            'Uruguay': 'ä¹Œæ‹‰åœ­', 'UY': 'ä¹Œæ‹‰åœ­', 'Guyana': 'åœ­äºšé‚£', 'GY': 'åœ­äºšé‚£',
            'Suriname': 'è‹é‡Œå—', 'SR': 'è‹é‡Œå—',

            // å¤§æ´‹æ´²
            'Australia': 'æ¾³å¤§åˆ©äºš', 'AU': 'æ¾³å¤§åˆ©äºš', 'New Zealand': 'æ–°è¥¿å…°', 'NZ': 'æ–°è¥¿å…°',
            'Fiji': 'æ–æµ', 'FJ': 'æ–æµ', 'Papua New Guinea': 'å·´å¸ƒäºšæ–°å‡ å†…äºš', 'PG': 'å·´å¸ƒäºšæ–°å‡ å†…äºš',
            'Solomon Islands': 'æ‰€ç½—é—¨ç¾¤å²›', 'SB': 'æ‰€ç½—é—¨ç¾¤å²›', 'Vanuatu': 'ç“¦åŠªé˜¿å›¾', 'VU': 'ç“¦åŠªé˜¿å›¾',

            // éæ´²
            'South Africa': 'å—é', 'ZA': 'å—é', 'Egypt': 'åŸƒåŠ', 'EG': 'åŸƒåŠ', 'Nigeria': 'å°¼æ—¥åˆ©äºš',
            'NG': 'å°¼æ—¥åˆ©äºš', 'Kenya': 'è‚¯å°¼äºš', 'KE': 'è‚¯å°¼äºš', 'Ethiopia': 'åŸƒå¡ä¿„æ¯”äºš',
            'ET': 'åŸƒå¡ä¿„æ¯”äºš', 'Ghana': 'åŠ çº³', 'GH': 'åŠ çº³', 'Tanzania': 'å¦æ¡‘å°¼äºš',
            'TZ': 'å¦æ¡‘å°¼äºš', 'Morocco': 'æ‘©æ´›å“¥', 'MA': 'æ‘©æ´›å“¥', 'Algeria': 'é˜¿å°”åŠåˆ©äºš',
            'DZ': 'é˜¿å°”åŠåˆ©äºš', 'Sudan': 'è‹ä¸¹', 'SD': 'è‹ä¸¹', 'Uganda': 'ä¹Œå¹²è¾¾', 'UG': 'ä¹Œå¹²è¾¾',
            'Mozambique': 'è«æ¡‘æ¯”å…‹', 'MZ': 'è«æ¡‘æ¯”å…‹', 'Madagascar': 'é©¬è¾¾åŠ æ–¯åŠ ',
            'MG': 'é©¬è¾¾åŠ æ–¯åŠ ', 'Angola': 'å®‰å“¥æ‹‰', 'AO': 'å®‰å“¥æ‹‰', 'Zambia': 'èµæ¯”äºš',
            'ZM': 'èµæ¯”äºš', 'Zimbabwe': 'æ´¥å·´å¸ƒéŸ¦', 'ZW': 'æ´¥å·´å¸ƒéŸ¦'
        };

        // æ–°å¢ï¼šæ—¥å¿—æ•°æ®
        let logData = {
            entries: [],
            maxEntries: 50
        };

        // æ–°å¢ï¼šé€šçŸ¥æ•°æ®
        let notifications = {
            active: [],
            maxNotifications: 5
        };

        // æ–°å¢ï¼šç¼“å­˜æ—¶é—´æˆ³
        let lastDownloadTimestamp = 0;
        const DOWNLOAD_CACHE_TIME = 2000; // 2ç§’ç¼“å­˜æ—¶é—´

        // æ–°å¢ï¼šç¡®è®¤å¯¹è¯æ¡†é”®ç›˜äº‹ä»¶å¤„ç†å™¨
        let dialogKeyHandler = null;

        document.addEventListener('DOMContentLoaded', () => {
            initDragDrop();
            initEvents();
            loadSavedToken();
            updateStats();
            addLog('ç³»ç»Ÿå¯åŠ¨', 'VlessèŠ‚ç‚¹ç”Ÿæˆå·¥å…·å·²å¯åŠ¨ï¼Œæ¬¢è¿ä½¿ç”¨ï¼', 'info');
            initTabs();
            initAccordion();
            initHeaderToggle();

            // åˆå§‹åŒ–ç²˜è´´è¾“å…¥æ¡†çŠ¶æ€
            updateCSVInputState();

            // åˆå§‹åŒ–ä¸Šä¼ è·¯å¾„é€‰æ‹©
            initUploadPathSelect();

            // è‡ªåŠ¨éšè—æ ‡é¢˜æç¤º
            setTimeout(() => {
                const headerInfo = document.getElementById('headerInfo');
                if (headerInfo && !headerInfo.classList.contains('hidden')) {
                    headerInfo.classList.add('hidden');
                }
            }, 5000);
        });

        // é€šç”¨ä¸Šä¼ å‡½æ•°ï¼ŒåŒ…å«SHAé‡è¯•é€»è¾‘
        async function uploadToGitHub(fileName, content, isBase64 = false, customMessage = '') {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                throw new Error('ç¼ºå°‘GitHub Tokenï¼Œè¯·å…ˆåœ¨GitHubé…ç½®ä¸­è¾“å…¥æœ‰æ•ˆçš„ä»¤ç‰Œ');
            }

            const repo = document.getElementById('githubRepo').value.trim();
            if (!repo) {
                throw new Error('GitHubä»“åº“åç§°ä¸èƒ½ä¸ºç©º');
            }

            const branch = document.getElementById('githubBranch').value.trim() || 'main';

            // è®°å½•åŸå§‹æ“ä½œ
            const originalFileName = fileName;
            const isRetry = customMessage.includes('[é‡è¯•]');

            // æ­¥éª¤1: å°è¯•è·å–æœ€æ–°çš„SHAå€¼
            let fileSha = null;
            let retryCount = 0;
            const maxRetries = 2;

            while (retryCount <= maxRetries) {
                try {
                    // æ¸…é™¤å¯èƒ½çš„ç¼“å­˜ï¼Œä½¿ç”¨æ—¶é—´æˆ³
                    const timestamp = Date.now();
                    const checkUrl = `https://api.github.com/repos/${repo}/contents/${fileName}?ref=${branch}&t=${timestamp}`;

                    const checkRes = await fetch(checkUrl, {
                        headers: {
                            Authorization: `token ${token}`,
                            Accept: 'application/vnd.github.v3+json'
                        }
                    });

                    if (checkRes.ok) {
                        const json = await checkRes.json();
                        fileSha = json.sha;
                        console.log(`âœ… è·å–åˆ° ${fileName} çš„æœ€æ–°SHA: ${fileSha.substring(0, 8)}...`);
                        break; // æˆåŠŸè·å–SHAï¼Œé€€å‡ºå¾ªç¯
                    } else if (checkRes.status === 404) {
                        console.log(`ğŸ“„ ${fileName} æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶`);
                        fileSha = null;
                        break; // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé€€å‡ºå¾ªç¯
                    } else {
                        const err = await checkRes.json();
                        console.warn(`âš ï¸ è·å– ${fileName} SHA å¤±è´¥(${checkRes.status}):`, err.message);

                        // å¦‚æœæ˜¯403æˆ–429é”™è¯¯ï¼Œå¯èƒ½æ˜¯é€Ÿç‡é™åˆ¶ï¼Œç­‰å¾…åé‡è¯•
                        if ((checkRes.status === 403 || checkRes.status === 429) && retryCount < maxRetries) {
                            retryCount++;
                            const waitTime = 2000 * retryCount;
                            console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else {
                            // å…¶ä»–é”™è¯¯ï¼ŒæŠ›å‡ºå¼‚å¸¸
                            throw new Error(`è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥: ${err.message || checkRes.statusText}`);
                        }
                    }
                } catch (e) {
                    console.error(`âŒ è·å– ${fileName} SHA æ—¶å‡ºé”™:`, e);
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const waitTime = 1000 * retryCount;
                        console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    } else {
                        throw e;
                    }
                }
            }

            // æ­¥éª¤2: å‡†å¤‡ä¸Šä¼ æ•°æ®
            const defaultMessage = isRetry
                ? `[é‡è¯•]ä¸Šä¼ æ–‡ä»¶ ${fileName} - ${new Date().toLocaleString()}`
                : `ä¸Šä¼ æ–‡ä»¶ ${fileName} - ${new Date().toLocaleString()}`;

            const message = customMessage || defaultMessage;

            const body = {
                message: message,
                content: content,
                branch: branch
            };

            // åªæœ‰å½“æ–‡ä»¶å·²å­˜åœ¨ä¸”æœ‰æœ‰æ•ˆçš„SHAæ—¶æ‰æ·»åŠ shaå‚æ•°
            if (fileSha) {
                body.sha = fileSha;
            }

            // æ­¥éª¤3: æ‰§è¡Œä¸Šä¼ 
            retryCount = 0;
            while (retryCount <= maxRetries) {
                try {
                    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                        method: 'PUT',
                        headers: {
                            Authorization: `token ${token}`,
                            Accept: 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (res.ok) {
                        const result = await res.json();
                        console.log(`âœ… ${fileName} ä¸Šä¼ æˆåŠŸï¼Œæ–°SHA: ${result.content.sha.substring(0, 8)}...`);
                        return { success: true, sha: result.content.sha, isNew: !fileSha };
                    } else {
                        const err = await res.json();
                        console.error(`âŒ ${fileName} ä¸Šä¼ å¤±è´¥(${res.status}):`, err);

                        // å¤„ç†ç‰¹å®šçš„é”™è¯¯ç±»å‹
                        if (err.message && err.message.includes('does not match') && retryCount < maxRetries) {
                            // SHAä¸åŒ¹é…ï¼Œéœ€è¦é‡æ–°è·å–SHAå¹¶é‡è¯•
                            console.log(`âš ï¸ ${fileName} SHAä¸åŒ¹é…ï¼Œé‡æ–°è·å–SHAå¹¶é‡è¯•...`);

                            // å¼ºåˆ¶é‡æ–°è·å–SHAï¼ˆè·³è¿‡ç¼“å­˜ï¼‰
                            const timestamp = Date.now();
                            const retryCheckUrl = `https://api.github.com/repos/${repo}/contents/${fileName}?ref=${branch}&t=${timestamp}&force=true`;

                            const retryCheckRes = await fetch(retryCheckUrl, {
                                headers: {
                                    Authorization: `token ${token}`,
                                    Accept: 'application/vnd.github.v3+json'
                                }
                            });

                            if (retryCheckRes.ok) {
                                const retryJson = await retryCheckRes.json();
                                body.sha = retryJson.sha; // æ›´æ–°SHA
                                console.log(`âœ… é‡è¯•è·å–åˆ° ${fileName} çš„æ–°SHA: ${retryJson.sha.substring(0, 8)}...`);
                            } else {
                                // å¦‚æœè·å–å¤±è´¥ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶å·²è¢«åˆ é™¤ï¼Œç§»é™¤SHAå°è¯•åˆ›å»ºæ–°æ–‡ä»¶
                                console.log(`ğŸ“„ ${fileName} å¯èƒ½å·²è¢«åˆ é™¤ï¼Œå°è¯•åˆ›å»ºæ–°æ–‡ä»¶`);
                                delete body.sha;
                            }

                            // æ›´æ–°æ¶ˆæ¯ï¼Œæ ‡è®°ä¸ºé‡è¯•
                            body.message = `[é‡è¯•]${message}`;

                            retryCount++;
                            const waitTime = 1000 * retryCount;
                            console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•ä¸Šä¼ ...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else if ((res.status === 403 || res.status === 429) && retryCount < maxRetries) {
                            // GitHub APIé™åˆ¶ï¼Œç­‰å¾…åé‡è¯•
                            retryCount++;
                            const waitTime = 3000 * retryCount;
                            console.log(`â³ GitHub APIé™åˆ¶ï¼Œç­‰å¾… ${waitTime}ms åé‡è¯•...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                            continue;
                        } else {
                            throw new Error(`${fileName} ä¸Šä¼ å¤±è´¥: ${err.message || res.statusText}`);
                        }
                    }
                } catch (e) {
                    console.error(`âŒ ${fileName} ä¸Šä¼ å¼‚å¸¸:`, e);
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const waitTime = 2000 * retryCount;
                        console.log(`â³ ç­‰å¾… ${waitTime}ms åé‡è¯•ä¸Šä¼ ...`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    } else {
                        throw e;
                    }
                }
            }

            throw new Error(`${fileName} ä¸Šä¼ å¤±è´¥ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°`);
        }

        function initEvents() {
            document.getElementById('fileInput').addEventListener('change', e => e.target.files[0] && handleFile(e.target.files[0]));
            document.getElementById('removeFileBtn').addEventListener('click', removeFile);
            document.getElementById('generateBtn').addEventListener('click', generateVless);
            document.getElementById('copyVlessBtn').addEventListener('click', () => copyText(data.vlessLinks.join('\n')));
            // ç§»é™¤downloadVlessBtnäº‹ä»¶ç›‘å¬ï¼Œåªä¿ç•™downloadAllBtn
            document.getElementById('downloadAllBtn').addEventListener('click', downloadAll);
            document.getElementById('downloadSubBtn').addEventListener('click', () => {
                // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°ä¸‹è½½
                const now = Date.now();
                if (now - lastDownloadTimestamp > DOWNLOAD_CACHE_TIME) {
                    // å¦‚æœè·ç¦»ä¸Šæ¬¡ä¸‹è½½è¶…è¿‡2ç§’ï¼Œæ¸…é™¤ç¼“å­˜
                    data.remoteNodes = [];
                    data.nodeSha = null;
                    data.plainSha = null;
                    data.optimalSha = null;
                    updateStats();
                }
                lastDownloadTimestamp = now;
                downloadRemote();
            });
            document.getElementById('mergeBtn').addEventListener('click', () => {
                validateAndMerge();
            });
            document.getElementById('syncBtn').addEventListener('click', oneClickSync);
            document.getElementById('copyMergedBtn').addEventListener('click', () => copyText(data.uniqueNodes.join('\n')));
            document.getElementById('copyLocalBase64Btn').addEventListener('click', () => copyText(data.localBase64Content));
            document.getElementById('copyAutoBase64Btn').addEventListener('click', () => copyText(data.autoBase64Content));
            document.getElementById('convertToBase64Btn').addEventListener('click', convertManualToBase64);
            document.getElementById('copyManualBase64Btn').addEventListener('click', () => copyText(data.manualBase64Content));

            // åŸæœ‰çš„å››ä¸ªä¸Šä¼ æŒ‰é’® - æ·»åŠ ç¡®è®¤æç¤º
            document.getElementById('uploadLocalBase64ToPathBtn').addEventListener('click', () => {
                validateAndUpload('uploadLocalBase64ToPath');
            });
            document.getElementById('uploadPlainNodesBtn').addEventListener('click', () => {
                validateAndUpload('uploadPlainNodes');
            });
            document.getElementById('uploadMergedBase64Btn').addEventListener('click', () => {
                validateAndUpload('uploadMergedBase64');
            });
            document.getElementById('uploadMergedOptimalBtn').addEventListener('click', () => {
                validateAndUpload('uploadMergedOptimal');
            });

            // æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„æŒ‰é’®
            document.getElementById('uploadMergedToPathBtn').addEventListener('click', () => {
                validateAndUpload('uploadMergedToPath');
            });

            // æ–°å¢ï¼šä¸‹è½½è·¯å¾„é€‰æ‹©äº‹ä»¶
            document.getElementById('downloadUrlSelect').addEventListener('change', function () {
                const customInput = document.getElementById('customDownloadUrl');
                customInput.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customInput.value = '';
                }
            });

            // æ–°å¢ï¼šä¸Šä¼ è·¯å¾„é€‰æ‹©äº‹ä»¶
            document.getElementById('uploadPathSelect').addEventListener('change', function () {
                const customInput = document.getElementById('customUploadPath');
                customInput.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customInput.value = '';
                }
            });

            // æ–°å¢ï¼šæ—¥å¿—æ§åˆ¶æŒ‰é’®äº‹ä»¶
            document.getElementById('clearLogBtn').addEventListener('click', clearLog);
            document.getElementById('toggleLogBtn').addEventListener('click', toggleLog);

            // ä¿®å¤ï¼šç²˜è´´CSVå†…å®¹ç”ŸæˆèŠ‚ç‚¹çš„åŠŸèƒ½
            let csvTimer;
            document.getElementById('csvInput').addEventListener('input', () => {
                clearTimeout(csvTimer);
                // å½“ç”¨æˆ·åœæ­¢è¾“å…¥1ç§’åè‡ªåŠ¨ç”Ÿæˆ
                csvTimer = setTimeout(() => {
                    if (data.currentSource !== 'file') {
                        generateVless();
                    }
                }, 1000);
            });

            // ä¿®å¤ï¼šå½“åˆ‡æ¢åˆ°ç²˜è´´æ ‡ç­¾é¡µæ—¶ï¼Œå¦‚æœå·²æœ‰å†…å®¹ï¼Œè‡ªåŠ¨ç”Ÿæˆ
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('card-tab-btn') && e.target.getAttribute('data-tab') === 'paste-tab') {
                    const csvInput = document.getElementById('csvInput');
                    if (csvInput.value.trim() && data.currentSource !== 'file') {
                        generateVless();
                    }
                }
            });

            // æ–°å¢ï¼šæ‰‹åŠ¨Vlessè½¬IP:ç«¯å£æŒ‰é’®äº‹ä»¶
            document.getElementById('convertToIpPortBtn').addEventListener('click', convertManualToIpPort);
            document.getElementById('copyIpPortBtn').addEventListener('click', () => copyText(data.manualIpPortContent));
            document.getElementById('downloadIpPortBtn').addEventListener('click', downloadIpPortTxt);

            // åˆå§‹åŒ–æ‰‹åŠ¨è½¬æ¢å·¥å…·æ ‡ç­¾é¡µ
            const manualTabNav = document.getElementById('manualTabNav');
            if (manualTabNav) {
                const tabButtons = manualTabNav.querySelectorAll('.card-tab-btn');
                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const cardBody = button.closest('.card-body');
                        const tabId = button.getAttribute('data-tab');

                        // åªåœ¨å½“å‰å¡ç‰‡å†…éƒ¨åˆ‡æ¢
                        const allTabBtns = cardBody.querySelectorAll('.card-tab-btn');
                        const allTabContents = cardBody.querySelectorAll('.card-tab-content');

                        allTabBtns.forEach(btn => btn.classList.remove('active'));
                        allTabContents.forEach(content => content.classList.remove('active'));

                        button.classList.add('active');
                        const targetTab = cardBody.querySelector(`#${tabId}`);
                        if (targetTab) {
                            targetTab.classList.add('active');
                        }
                    });
                });
            }
        }

        // æ¸…é™¤è¿œç¨‹ç¼“å­˜å‡½æ•°
        function clearRemoteCache() {
            data.remoteNodes = [];
            data.nodeSha = null;
            data.plainSha = null;
            data.optimalSha = null;
            data.locationSha = null;
            updateStats();
            console.log('ğŸ—‘ï¸ è¿œç¨‹ç¼“å­˜å·²æ¸…é™¤');
            addLog('ç¼“å­˜æ¸…ç†', 'è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜å·²æ¸…é™¤', 'info');
        }

        // æ˜æ–‡è®¢é˜…ä¸Šä¼ 
        async function uploadPlainNodes() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('é”™è¯¯', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    plainNodeFile,
                    btoa(plainText),
                    false,
                    `ä¸Šä¼ åˆå¹¶æ˜æ–‡è®¢é˜…åˆ° ${plainNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºæ˜æ–‡èŠ‚ç‚¹æ–‡ä»¶ ${plainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°æ˜æ–‡èŠ‚ç‚¹æ–‡ä»¶ ${plainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // åˆå§‹åŒ–ä¸Šä¼ è·¯å¾„é€‰æ‹©
        function initUploadPathSelect() {
            const uploadPathSelect = document.getElementById('uploadPathSelect');
            const customUploadPath = document.getElementById('customUploadPath');

            uploadPathSelect.addEventListener('change', function () {
                customUploadPath.classList.toggle('show', this.value === 'custom');
                if (this.value !== 'custom') {
                    customUploadPath.value = '';
                }
            });
        }

        // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
        function updateCSVInputState() {
            const csvInput = document.getElementById('csvInput');
            const pasteTabBtn = document.querySelector('.card-tab-btn[data-tab="paste-tab"]');

            if (data.currentSource === 'file') {
                // æœ‰æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œç¦ç”¨ç²˜è´´è¾“å…¥æ¡†
                csvInput.disabled = true;
                csvInput.placeholder = "å·²ä¸Šä¼ æ–‡ä»¶ï¼Œç²˜è´´åŠŸèƒ½å·²ç¦ç”¨ã€‚è¯·å…ˆç§»é™¤æ–‡ä»¶ã€‚";
                pasteTabBtn.style.opacity = "0.6";
                pasteTabBtn.style.cursor = "not-allowed";
            } else {
                // æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œå¯ç”¨ç²˜è´´è¾“å…¥æ¡†
                csvInput.disabled = false;
                csvInput.placeholder = "æ”¯æŒå¤šç§æ ¼å¼ï¼Œæ™ºèƒ½åˆ†å‰²ï¼š\n1. å•è¡Œæˆ–å¤šè¡Œæ ¼å¼ï¼ˆå†’å·,é€—å·ï¼Œç©ºæ ¼åˆ†éš”ï¼‰ï¼š\n2. ç´§å‡‘æ ¼å¼ï¼ˆä¸€è¡Œå¤šä¸ªï¼‰ï¼š\n3. æ··åˆåˆ†éš”ç¬¦ï¼š\n4. åªæœ‰IPï¼ˆä½¿ç”¨é»˜è®¤ç«¯å£ï¼‰ï¼š";
                pasteTabBtn.style.opacity = "1";
                pasteTabBtn.style.cursor = "pointer";
            }
        }

        // åˆå§‹åŒ–æ ‡ç­¾é¡µ - ä¿®å¤ï¼šç¡®ä¿æ¯ä¸ªå¡ç‰‡çš„æ ‡ç­¾é¡µç‹¬ç«‹
        function initTabs() {
            // ä¸ºæ¯ä¸ªå¡ç‰‡çš„æ ‡ç­¾é¡µåˆ†åˆ«åˆå§‹åŒ–
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const tabButtons = card.querySelectorAll('.card-tab-btn');
                if (tabButtons.length > 0) {
                    tabButtons.forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                            const cardBody = button.closest('.card-body');
                            const tabId = button.getAttribute('data-tab');

                            // åªåœ¨å½“å‰å¡ç‰‡å†…éƒ¨åˆ‡æ¢
                            const allTabBtns = cardBody.querySelectorAll('.card-tab-btn');
                            const allTabContents = cardBody.querySelectorAll('.card-tab-content');

                            allTabBtns.forEach(btn => btn.classList.remove('active'));
                            allTabContents.forEach(content => content.classList.remove('active'));

                            button.classList.add('active');
                            const targetTab = cardBody.querySelector(`#${tabId}`);
                            if (targetTab) {
                                targetTab.classList.add('active');
                            }
                        });
                    });
                }
            });
        }

        // åˆå§‹åŒ–æŠ˜å é¢æ¿
        function initAccordion() {
            const accordionToggle = document.getElementById('advancedConfigToggle');
            const accordionContent = document.getElementById('advancedConfigContent');

            accordionToggle.addEventListener('click', () => {
                accordionToggle.classList.toggle('active');
                accordionContent.classList.toggle('show');
            });
        }

        // åˆå§‹åŒ–æ ‡é¢˜æ˜¾ç¤º/éšè—
        function initHeaderToggle() {
            const toggleBtn = document.getElementById('toggleHeaderBtn');
            const headerInfo = document.getElementById('headerInfo');

            toggleBtn.addEventListener('click', () => {
                if (headerInfo.classList.contains('hidden')) {
                    headerInfo.classList.remove('hidden');
                    toggleBtn.textContent = 'éšè—';
                    showNotification('æç¤º', 'æ ‡é¢˜å·²æ˜¾ç¤º', 'info');
                } else {
                    headerInfo.classList.add('hidden');
                    toggleBtn.textContent = 'æ˜¾ç¤º';
                    showNotification('æç¤º', 'æ ‡é¢˜å·²éšè—', 'info');
                }
            });
        }

        function initDragDrop() {
            const area = document.getElementById('dropArea');

            // ä¿®å¤ï¼šç¡®ä¿æ‹–æ‹½åŠŸèƒ½æ­£å¸¸å·¥ä½œ
            ['dragenter', 'dragover'].forEach(e => {
                area.addEventListener(e, (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    area.classList.add('dragover');
                });
            });

            ['dragleave', 'drop'].forEach(e => {
                area.addEventListener(e, (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    area.classList.remove('dragover');
                });
            });

            // ä¿®å¤ï¼šæ­£ç¡®å¤„ç†dropäº‹ä»¶
            area.addEventListener('drop', e => {
                e.preventDefault();
                e.stopPropagation();
                const files = e.dataTransfer.files;
                if (files && files.length > 0) {
                    handleFile(files[0]);
                }
            });

            area.addEventListener('click', () => document.getElementById('fileInput').click());
        }

        function handleFile(file) {
            if (!/\.(csv|txt)$/i.test(file.name)) {
                showNotification('æ–‡ä»¶é”™è¯¯', 'è¯·ä¸Šä¼ CSVæˆ–TXTæ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ', 'error');
                addLog('æ–‡ä»¶æ“ä½œ', `æ–‡ä»¶æ ¼å¼é”™è¯¯: ${file.name}`, 'error');
                return;
            }

            // ä¿®å¤ï¼šç¡®ä¿æ–‡ä»¶è¢«æ­£ç¡®è®¾ç½®åˆ°fileInputå…ƒç´ 
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            document.getElementById('fileInput').files = dataTransfer.files;

            const reader = new FileReader();
            reader.onload = e => {
                data.currentSource = 'file';
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatSize(file.size);
                document.getElementById('fileInfo').classList.add('show');
                document.getElementById('csvInput').value = '';
                updateSourceBadge();
                // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
                updateCSVInputState();

                // æ–‡ä»¶ä¸Šä¼ åè‡ªåŠ¨è¿›è¡Œåˆ—æ£€æµ‹
                autoDetectCSVColumns();

                // ä¿®å¤ï¼šæ–‡ä»¶ä¸Šä¼ åè‡ªåŠ¨ç”ŸæˆèŠ‚ç‚¹
                setTimeout(() => {
                    generateVless();
                }, 100);

                addLog('æ–‡ä»¶æ“ä½œ', `æˆåŠŸä¸Šä¼ æ–‡ä»¶: ${file.name}`, 'success');
            };
            reader.onerror = e => {
                showNotification('æ–‡ä»¶è¯»å–å¤±è´¥', 'æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸåæˆ–é‡æ–°ä¸Šä¼ ', 'error');
                addLog('æ–‡ä»¶æ“ä½œ', `æ–‡ä»¶è¯»å–å¤±è´¥: ${file.name} - ${e.message}`, 'error');
            };
            reader.readAsText(file);
        }

        function removeFile() {
            data.currentSource = 'none';
            document.getElementById('fileInfo').classList.remove('show');
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('fileSize').textContent = '';
            updateSourceBadge();
            // æ›´æ–°CSVè¾“å…¥æ¡†çŠ¶æ€
            updateCSVInputState();

            // æ¸…é™¤æ£€æµ‹ç»“æœ
            document.getElementById('columnDetectionResult').style.display = 'none';

            addLog('æ–‡ä»¶æ“ä½œ', 'å·²ç§»é™¤ä¸Šä¼ çš„æ–‡ä»¶', 'info');

            // æ¸…ç©ºç”Ÿæˆç»“æœ
            data.vlessLinks = [];
            data.localBase64Content = '';
            data.autoBase64Content = '';
            displayVlessLinks();
            document.getElementById('localBase64Output').textContent = 'Base64è®¢é˜…å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            document.getElementById('localBase64Output').classList.add('empty');
            document.getElementById('autoBase64Output').textContent = 'åˆå¹¶å»é‡åå°†è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…å†…å®¹...';
            document.getElementById('autoBase64Output').classList.add('empty');
            updateStats();
        }

        function updateSourceBadge() {
            const badge = document.getElementById('sourceBadge');
            badge.textContent = data.currentSource === 'file' ? 'å·²ä¸Šä¼ æ–‡ä»¶' : 'ç²˜è´´å†…å®¹';
        }

        // æ–°å¢ï¼šæ™ºèƒ½æ£€æµ‹CSVåˆ—åŠŸèƒ½ - ä¿®å¤ï¼šå‡†ç¡®æ£€æµ‹é€Ÿåº¦åˆ—å’Œç«¯å£åˆ—
        // æ–°å¢ï¼šæ™ºèƒ½æ£€æµ‹CSVåˆ—åŠŸèƒ½ - å®Œæ•´ä¿®å¤ç‰ˆ
        function autoDetectCSVColumns() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('æ£€æµ‹å¤±è´¥', 'è¯·å…ˆä¸Šä¼ CSVæ–‡ä»¶', 'warning');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const text = e.target.result;
                const lines = text.split(/\r?\n/).filter(line => line.trim());

                if (lines.length === 0) {
                    showNotification('æ£€æµ‹å¤±è´¥', 'CSVæ–‡ä»¶ä¸ºç©º', 'error');
                    return;
                }

                // å°è¯•è§£æCSVå†…å®¹
                const firstFewLines = lines.slice(0, 15); // åˆ†æå‰15è¡Œä»¥è·å¾—æ›´å¤šæ ·æœ¬
                const rows = [];

                for (let line of firstFewLines) {
                    try {
                        const row = parseCSVLine(line);
                        if (row.length > 0) {
                            rows.push(row);
                        }
                    } catch (e) {
                        console.warn('è§£æCSVè¡Œå¤±è´¥:', e);
                    }
                }

                if (rows.length === 0) {
                    showNotification('æ£€æµ‹å¤±è´¥', 'æ— æ³•è§£æCSVæ–‡ä»¶æ ¼å¼', 'error');
                    return;
                }

                // æ£€æµ‹æ˜¯å¦æœ‰æ ‡é¢˜è¡Œ
                let hasHeader = false;
                const firstRow = rows[0];
                const secondRow = rows.length > 1 ? rows[1] : [];

                // æ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦åŒ…å«å¸¸è§çš„æ ‡é¢˜å…³é”®è¯
                const headerKeywords = [
                    'host', 'ip', 'address', 'æœåŠ¡å™¨', 'ipåœ°å€', 'IP åœ°å€',
                    'port', 'ç«¯å£',
                    'city', 'åŸå¸‚', 'åœ°åŒº', 'location',
                    'country', 'å›½å®¶', 'country_code', 'nation', 'country_name',
                    'region', 'åŒºåŸŸ', 'å·', 'çœ', 'area', 'code', 'åœ°åŒºç ',
                    'speed', 'é€Ÿåº¦', 'ä¸‹è½½é€Ÿåº¦', 'å¸¦å®½', 'download', 'mb/s', 'mb', 'mbit',
                    'delay', 'å»¶è¿Ÿ', 'å¹³å‡å»¶è¿Ÿ', 'ping', 'time', 'ms' // å»¶è¿Ÿç›¸å…³å…³é”®è¯
                ];

                let headerMatchCount = 0;
                let firstRowIsLikelyData = false;

                // æ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦æ˜¯æ•°æ®ï¼ˆåŒ…å«IPæˆ–æ•°å­—ï¼‰
                for (let cell of firstRow) {
                    const cellStr = cell.toString().trim();
                    if (isValidIP(cellStr) || /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(cellStr)) {
                        firstRowIsLikelyData = true;
                        break;
                    }
                    if (/^\d{1,5}$/.test(cellStr) && parseInt(cellStr) >= 1 && parseInt(cellStr) <= 65535) {
                        firstRowIsLikelyData = true;
                        break;
                    }
                }

                // æ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦åŒ…å«æ ‡é¢˜å…³é”®è¯
                for (let cell of firstRow) {
                    const lowerCell = cell.toString().toLowerCase().trim();
                    for (let keyword of headerKeywords) {
                        if (lowerCell.includes(keyword.toLowerCase())) {
                            headerMatchCount++;
                            break;
                        }
                    }
                }

                // åˆ¤æ–­æ˜¯å¦æœ‰æ ‡é¢˜è¡Œ
                hasHeader = headerMatchCount >= 2 && !firstRowIsLikelyData;

                // ç¡®å®šæ•°æ®èµ·å§‹è¡Œ
                const dataStartIndex = hasHeader ? 1 : 0;
                const dataRows = rows.slice(dataStartIndex).slice(0, 10); // åªåˆ†æå‰10è¡Œæ•°æ®

                if (dataRows.length === 0) {
                    showNotification('æ£€æµ‹å¤±è´¥', 'CSVæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®è¡Œ', 'error');
                    return;
                }

                // æ£€æµ‹å„åˆ—
                const columnCount = Math.max(...dataRows.map(row => row.length));
                const columnStats = new Array(columnCount).fill().map(() => ({
                    ipCount: 0,
                    portCount: 0,
                    speedCount: 0,
                    delayCount: 0,
                    textCount: 0,
                    numericCount: 0,
                    total: 0,
                    values: [] // å­˜å‚¨å®é™…å€¼ç”¨äºåˆ†æ
                }));

                // æ”¶é›†åˆ—ç»Ÿè®¡ä¿¡æ¯
                for (let row of dataRows) {
                    for (let i = 0; i < row.length; i++) {
                        const cell = row[i].toString().trim();
                        columnStats[i].total++;
                        columnStats[i].values.push(cell);

                        if (isValidIP(cell)) {
                            columnStats[i].ipCount++;
                        }
                        // æ£€æµ‹ç«¯å£ï¼ˆ1-65535çš„æ•´æ•°ï¼‰
                        else if (/^\d{1,5}$/.test(cell)) {
                            const num = parseInt(cell);
                            if (num >= 1 && num <= 65535) {
                                columnStats[i].portCount++;
                            }
                        }
                        // æ£€æµ‹é€Ÿåº¦ï¼ˆåŒ…å«æ•°å­—å’Œé€Ÿåº¦å•ä½ï¼‰
                        else if (isSpeedValue(cell)) {
                            columnStats[i].speedCount++;
                        }
                        // æ£€æµ‹å»¶è¿Ÿï¼ˆåŒ…å«æ•°å­—å’Œæ—¶é—´å•ä½ï¼‰
                        else if (isDelayValue(cell)) {
                            columnStats[i].delayCount++;
                        }
                        // æ£€æµ‹æ•°å­—ï¼ˆåŒ…å«å°æ•°ï¼‰
                        else if (/^-?\d+(\.\d+)?$/.test(cell)) {
                            columnStats[i].numericCount++;
                        }
                        // æ–‡æœ¬å†…å®¹
                        else if (cell.length > 0) {
                            columnStats[i].textCount++;
                        }
                    }
                }

                // æ£€æµ‹IPåˆ—
                let ipColumn = 0;
                let maxIpScore = 0;
                for (let i = 0; i < columnStats.length; i++) {
                    const ipScore = columnStats[i].ipCount / Math.max(1, columnStats[i].total);
                    if (ipScore > maxIpScore) {
                        maxIpScore = ipScore;
                        ipColumn = i;
                    }
                }

                // æ£€æµ‹ç«¯å£åˆ— - æ”¹è¿›ç®—æ³•
                let portColumn = -1;
                let maxPortScore = 0;

                // æ–¹æ³•1ï¼šåŸºäºæ ‡é¢˜æ£€æµ‹
                if (hasHeader) {
                    for (let i = 0; i < firstRow.length; i++) {
                        const header = firstRow[i].toString().toLowerCase();
                        if (header.includes('port') || header.includes('ç«¯å£')) {
                            portColumn = i;
                            break;
                        }
                    }
                }

                // æ–¹æ³•2ï¼šåŸºäºæ•°æ®æ¨¡å¼æ£€æµ‹
                if (portColumn === -1) {
                    for (let i = 0; i < columnStats.length; i++) {
                        if (i === ipColumn) continue;

                        // è®¡ç®—ç«¯å£å¾—åˆ†
                        const portScore = columnStats[i].portCount / Math.max(1, columnStats[i].total);

                        // æ£€æŸ¥æ˜¯å¦æ˜¯å¸¸è§ç«¯å£
                        const commonPorts = [80, 443, 8080, 8443, 22, 21, 25, 53];
                        let commonPortMatches = 0;
                        for (const value of columnStats[i].values) {
                            if (commonPorts.includes(parseInt(value))) {
                                commonPortMatches++;
                            }
                        }
                        const commonPortScore = commonPortMatches / Math.max(1, columnStats[i].total);

                        // ç»¼åˆå¾—åˆ†
                        const totalScore = portScore * 0.7 + commonPortScore * 0.3;

                        if (totalScore > maxPortScore && totalScore > 0.4) { // é˜ˆå€¼æé«˜åˆ°40%
                            maxPortScore = totalScore;
                            portColumn = i;
                        }
                    }
                }

                // æ£€æµ‹é€Ÿåº¦åˆ— - é‡ç‚¹ä¿®å¤Gåˆ—ï¼ˆç´¢å¼•6ï¼‰æ£€æµ‹
                let speedColumn = -1;
                let maxSpeedScore = 0;

                // ç‰¹åˆ«æ£€æŸ¥Gåˆ—ï¼ˆç¬¬7åˆ—ï¼Œç´¢å¼•6ï¼‰
                if (columnStats.length > 6) {
                    const gColumn = 6;
                    const gColumnValues = columnStats[gColumn].values;
                    let gSpeedScore = 0;

                    for (const value of gColumnValues) {
                        if (isSpeedValue(value)) {
                            gSpeedScore++;
                        }
                    }

                    if (gSpeedScore / Math.max(1, gColumnValues.length) > 0.5) {
                        speedColumn = gColumn;
                        maxSpeedScore = gSpeedScore / gColumnValues.length;
                    }
                }

                // å¦‚æœGåˆ—ä¸æ˜¯é€Ÿåº¦åˆ—ï¼Œç»§ç»­æ­£å¸¸æ£€æµ‹
                if (speedColumn === -1) {
                    for (let i = 0; i < columnStats.length; i++) {
                        if (i === ipColumn || i === portColumn) continue;

                        // åŸºäºæ ‡é¢˜æ£€æµ‹
                        if (hasHeader) {
                            const header = firstRow[i].toString().toLowerCase();
                            const speedKeywords = ['speed', 'é€Ÿåº¦', 'download', 'bandwidth', 'å¸¦å®½', 'mb/s', 'mb', 'mbit', 'mbit/s'];
                            for (const keyword of speedKeywords) {
                                if (header.includes(keyword)) {
                                    speedColumn = i;
                                    break;
                                }
                            }
                            if (speedColumn !== -1) break;
                        }

                        // åŸºäºæ•°æ®æ£€æµ‹
                        const speedScore = columnStats[i].speedCount / Math.max(1, columnStats[i].total);
                        if (speedScore > maxSpeedScore && speedScore > 0.3) {
                            maxSpeedScore = speedScore;
                            speedColumn = i;
                        }
                    }
                }

                // æ£€æµ‹å»¶è¿Ÿåˆ—ï¼ˆé˜²æ­¢è¯¯åˆ¤ï¼‰
                let delayColumn = -1;
                let maxDelayScore = 0;
                for (let i = 0; i < columnStats.length; i++) {
                    if (i === ipColumn || i === portColumn || i === speedColumn) continue;

                    if (hasHeader) {
                        const header = firstRow[i].toString().toLowerCase();
                        if (header.includes('delay') || header.includes('å»¶è¿Ÿ') ||
                            header.includes('ping') || header.includes('ms') ||
                            header.includes('time')) {
                            delayColumn = i;
                            break;
                        }
                    }

                    const delayScore = columnStats[i].delayCount / Math.max(1, columnStats[i].total);
                    if (delayScore > maxDelayScore && delayScore > 0.3) {
                        maxDelayScore = delayScore;
                        delayColumn = i;
                    }
                }

                // æ£€æµ‹åŸå¸‚åˆ—
                let cityColumn = -1;
                for (let i = 0; i < columnStats.length; i++) {
                    if (i === ipColumn || i === portColumn || i === speedColumn || i === delayColumn) continue;

                    if (hasHeader) {
                        const header = firstRow[i].toString().toLowerCase();
                        if (header.includes('city') || header.includes('åŸå¸‚') ||
                            header.includes('åœ°åŒº') || header.includes('location')) {
                            cityColumn = i;
                            break;
                        }
                    }

                    // æ–‡æœ¬åˆ—å¯èƒ½æ˜¯åŸå¸‚
                    if (columnStats[i].textCount / Math.max(1, columnStats[i].total) > 0.7) {
                        cityColumn = i;
                    }
                }

                // æ£€æµ‹å›½å®¶åˆ—
                let countryColumn = -1;
                for (let i = 0; i < columnStats.length; i++) {
                    if (i === ipColumn || i === portColumn || i === speedColumn ||
                        i === delayColumn || i === cityColumn) continue;

                    if (hasHeader) {
                        const header = firstRow[i].toString().toLowerCase();
                        if (header.includes('country') || header.includes('å›½å®¶') ||
                            header.includes('nation') || header.includes('country_code') || header.includes('country_name')) {
                            countryColumn = i;
                            break;
                        }
                    }
                }

                // æ£€æµ‹åœ°åŒºç åˆ—
                let regionColumn = -1;
                for (let i = 0; i < columnStats.length; i++) {
                    if (i === ipColumn || i === portColumn || i === speedColumn ||
                        i === delayColumn || i === cityColumn || i === countryColumn) continue;

                    if (hasHeader) {
                        const header = firstRow[i].toString().toLowerCase();
                        if (header.includes('region') || header.includes('åŒºåŸŸ') ||
                            header.includes('å·') || header.includes('çœ') ||
                            header.includes('area') || header.includes('code') || header.includes('åœ°åŒºç ')) {
                            regionColumn = i;
                            break;
                        }
                    }
                }

                // ä¿å­˜æ£€æµ‹ç»“æœ
                data.csvColumnDetection = {
                    ipColumn: ipColumn,
                    portColumn: portColumn,
                    cityColumn: cityColumn,
                    countryColumn: countryColumn,
                    regionColumn: regionColumn,
                    speedColumn: speedColumn,
                    delayColumn: delayColumn,
                    hasHeader: hasHeader,
                    detected: true,
                    columnStats: columnStats
                };

                // æ›´æ–°UI
                updateColumnDetectionUI();

                // åº”ç”¨æ£€æµ‹ç»“æœåˆ°è¡¨å•
                applyDetectedColumns();

                // æ ¹æ®æ£€æµ‹è´¨é‡è®¾ç½®çŠ¶æ€ç±»
                const resultDiv = document.getElementById('columnDetectionResult');
                let detectionQuality = 'success';

                // åˆ¤æ–­æ£€æµ‹è´¨é‡
                if (portColumn === -1 || speedColumn === -1) {
                    detectionQuality = 'warning';
                }

                // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
                resultDiv.classList.remove('success', 'warning');
                // æ·»åŠ å½“å‰çŠ¶æ€ç±»
                resultDiv.classList.add(detectionQuality);

                const summary = `æ£€æµ‹åˆ°${columnCount}åˆ—ï¼Œ${hasHeader ? 'æœ‰æ ‡é¢˜è¡Œ' : 'æ— æ ‡é¢˜è¡Œ'}ï¼ŒIPåˆ—: ${ipColumn + 1}(${String.fromCharCode(65 + ipColumn)})ï¼Œ${portColumn !== -1 ? `ç«¯å£åˆ—: ${portColumn + 1}(${String.fromCharCode(65 + portColumn)})` : 'æœªæ£€æµ‹åˆ°ç«¯å£åˆ—'}`;
                showNotification('æ£€æµ‹å®Œæˆ', summary, 'success');
                addLog('CSVåˆ—æ£€æµ‹', summary, 'success');
            };

            reader.onerror = function (e) {
                showNotification('æ£€æµ‹å¤±è´¥', 'æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹', 'error');
                addLog('CSVåˆ—æ£€æµ‹', 'æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
            };

            reader.readAsText(file);
        }


        // æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºé€Ÿåº¦å€¼
        // æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºé€Ÿåº¦å€¼
        function isSpeedValue(value) {
            if (!value || typeof value !== 'string') return false;

            const normalized = value.toLowerCase().trim();

            // åŒ¹é…é€Ÿåº¦æ¨¡å¼
            const speedPatterns = [
                /^(\d+(\.\d+)?)\s*(mb\/s|mbps|mbit\/s|mbit|mb)$/i,
                /^(\d+(\.\d+)?)\s*(gb\/s|gbps|gbit\/s|gbit|gb)$/i,
                /^(\d+(\.\d+)?)\s*(kb\/s|kbps|kbit\/s|kbit|kb)$/i,
                /^(\d+(\.\d+)?)\s*(m\/s)$/i,
                /^(\d+(\.\d+)?)\s*é€Ÿåº¦$/i,
                /^ä¸‹è½½é€Ÿåº¦\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i,
                /^å¸¦å®½\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i
            ];

            for (const pattern of speedPatterns) {
                if (pattern.test(normalized)) {
                    return true;
                }
            }

            // æ£€æŸ¥æ˜¯å¦åŒ…å«é€Ÿåº¦å•ä½
            const speedUnits = ['mb/s', 'mbps', 'mbit/s', 'gb/s', 'gbps', 'gbit/s', 'kb/s', 'kbps', 'm/s', 'é€Ÿåº¦', 'å¸¦å®½'];
            for (const unit of speedUnits) {
                if (normalized.includes(unit)) {
                    return true;
                }
            }

            return false;
        }

        // æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå»¶è¿Ÿå€¼
        function isDelayValue(value) {
            if (!value || typeof value !== 'string') return false;

            const normalized = value.toLowerCase().trim();

            // åŒ¹é…å»¶è¿Ÿæ¨¡å¼
            const delayPatterns = [
                /^(\d+(\.\d+)?)\s*(ms|æ¯«ç§’)$/i,
                /^(\d+(\.\d+)?)\s*(s|ç§’)$/i,
                /^å»¶è¿Ÿ\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i,
                /^ping\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i,
                /^(\d+(\.\d+)?)\s*ms$/i
            ];

            for (const pattern of delayPatterns) {
                if (pattern.test(normalized)) {
                    return true;
                }
            }

            // æ£€æŸ¥æ˜¯å¦åŒ…å«å»¶è¿Ÿå•ä½
            const delayUnits = ['ms', 'æ¯«ç§’', 'å»¶è¿Ÿ', 'ping', 'latency'];
            for (const unit of delayUnits) {
                if (normalized.includes(unit)) {
                    return true;
                }
            }

            return false;
        }

        // æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå»¶è¿Ÿå€¼
        function isDelayValue(value) {
            if (!value || typeof value !== 'string') return false;

            const normalized = value.toLowerCase().trim();

            // åŒ¹é…å»¶è¿Ÿæ¨¡å¼
            const delayPatterns = [
                /^(\d+(\.\d+)?)\s*(ms|æ¯«ç§’)$/i,
                /^(\d+(\.\d+)?)\s*(s|ç§’)$/i,
                /^å»¶è¿Ÿ\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i,
                /^ping\s*[:ï¼š]?\s*(\d+(\.\d+)?)/i,
                /^(\d+(\.\d+)?)\s*ms$/i
            ];

            for (const pattern of delayPatterns) {
                if (pattern.test(normalized)) {
                    return true;
                }
            }

            // æ£€æŸ¥æ˜¯å¦åŒ…å«å»¶è¿Ÿå•ä½
            const delayUnits = ['ms', 'æ¯«ç§’', 'å»¶è¿Ÿ', 'ping', 'latency'];
            for (const unit of delayUnits) {
                if (normalized.includes(unit)) {
                    return true;
                }
            }

            return false;
        }

        // æ›´æ–°åˆ—æ£€æµ‹ç»“æœæ˜¾ç¤º - ä¼˜åŒ–æ ·å¼
        // æ›´æ–°åˆ—æ£€æµ‹ç»“æœæ˜¾ç¤º - ä¼˜åŒ–æ ·å¼å’Œé€»è¾‘
        // æ›´æ–°åˆ—æ£€æµ‹ç»“æœæ˜¾ç¤º - ä¼˜åŒ–æ ·å¼å’Œé€»è¾‘
        function updateColumnDetectionUI() {
            const detection = data.csvColumnDetection;
            const resultDiv = document.getElementById('columnDetectionResult');
            const summarySpan = document.getElementById('detectionSummary');
            const detailsDiv = document.getElementById('detectionDetails');

            if (detection.detected) {
                resultDiv.style.display = 'block';

                // æ„å»ºæ£€æµ‹ç»“æœæ‘˜è¦ï¼ˆæ›´ç´§å‡‘çš„æ ¼å¼ï¼‰
                let summaryParts = [];
                summaryParts.push(`IPåˆ—: ${detection.ipColumn + 1}(${String.fromCharCode(65 + detection.ipColumn)})`);

                if (detection.portColumn !== -1) {
                    summaryParts.push(`ç«¯å£åˆ—: ${detection.portColumn + 1}(${String.fromCharCode(65 + detection.portColumn)})`);
                }

                if (detection.speedColumn !== -1) {
                    summaryParts.push(`é€Ÿåº¦åˆ—: ${detection.speedColumn + 1}(${String.fromCharCode(65 + detection.speedColumn)})`);
                }

                if (detection.cityColumn !== -1) {
                    summaryParts.push(`åŸå¸‚åˆ—: ${detection.cityColumn + 1}(${String.fromCharCode(65 + detection.cityColumn)})`);
                }

                summarySpan.textContent = summaryParts.join(' | ');

                // æ„å»ºè¯¦ç»†è¯´æ˜ - åªåœ¨æœ‰éœ€è¦è¯´æ˜çš„å†…å®¹æ—¶æ‰æ˜¾ç¤º
                let detailsContent = '';
                let hasImportantNotes = false;

                if (detection.portColumn === -1) {
                    detailsContent += 'â€¢ æœªæ£€æµ‹åˆ°ç«¯å£åˆ—ï¼Œå°†ä½¿ç”¨é»˜è®¤ç«¯å£443<br>';
                    hasImportantNotes = true;
                }

                if (detection.speedColumn === -1) {
                    detailsContent += 'â€¢ æœªæ£€æµ‹åˆ°é€Ÿåº¦åˆ—ï¼Œåˆ«åä¸­å°†ä¸åŒ…å«é€Ÿåº¦ä¿¡æ¯<br>';
                    hasImportantNotes = true;
                }

                if (detection.speedColumn !== -1) {
                    const speedColStats = detection.columnStats[detection.speedColumn];
                    const confidence = Math.round((speedColStats.speedCount / Math.max(1, speedColStats.total)) * 100);
                    if (confidence < 70) {
                        detailsContent += `â€¢ é€Ÿåº¦åˆ—æ£€æµ‹ç½®ä¿¡åº¦è¾ƒä½(${confidence}%)ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´<br>`;
                        hasImportantNotes = true;
                    }
                }

                if (detection.portColumn !== -1) {
                    const portColStats = detection.columnStats[detection.portColumn];
                    const confidence = Math.round((portColStats.portCount / Math.max(1, portColStats.total)) * 100);
                    if (confidence < 70) {
                        detailsContent += `â€¢ ç«¯å£åˆ—æ£€æµ‹ç½®ä¿¡åº¦è¾ƒä½(${confidence}%)ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´<br>`;
                        hasImportantNotes = true;
                    }
                }

                // å¦‚æœæœ‰é‡è¦è¯´æ˜æ‰æ˜¾ç¤ºï¼Œå¦åˆ™ä¸æ˜¾ç¤ºè¯´æ˜éƒ¨åˆ†
                if (hasImportantNotes) {
                    detailsDiv.innerHTML = '<strong>æ£€æµ‹è¯´æ˜ï¼š</strong><br>' + detailsContent;
                    detailsDiv.style.display = 'block';
                } else {
                    detailsDiv.style.display = 'none';
                }
            }
        }
        // åº”ç”¨æ£€æµ‹ç»“æœåˆ°è¡¨å•
        function applyDetectedColumns() {
            const detection = data.csvColumnDetection;
            if (!detection.detected) return;

            document.getElementById('ipColumn').value = detection.ipColumn;
            document.getElementById('portColumn').value = detection.portColumn;
            document.getElementById('cityColumn').value = detection.cityColumn;
            document.getElementById('countryColumn').value = detection.countryColumn;
            document.getElementById('regionColumn').value = detection.regionColumn;
            document.getElementById('speedColumn').value = detection.speedColumn;

            // æ›´æ–°å¸®åŠ©æ–‡æœ¬ä¸­çš„æ£€æµ‹ç»“æœ - æ›´æ¸…æ™°çš„æ˜¾ç¤º
            const formatColumnInfo = (colIndex) => {
                if (colIndex === -1) return 'æœªæ£€æµ‹';
                return `ç¬¬${colIndex + 1}åˆ—(${String.fromCharCode(65 + colIndex)})`;
            };

            document.getElementById('detectedIpCol').textContent = formatColumnInfo(detection.ipColumn);
            document.getElementById('detectedPortCol').textContent = formatColumnInfo(detection.portColumn);
            document.getElementById('detectedCityCol').textContent = formatColumnInfo(detection.cityColumn);
            document.getElementById('detectedCountryCol').textContent = formatColumnInfo(detection.countryColumn);
            document.getElementById('detectedRegionCol').textContent = formatColumnInfo(detection.regionColumn);
            document.getElementById('detectedSpeedCol').textContent = formatColumnInfo(detection.speedColumn);
        }

        async function generateVless() {
            showLoading(true);
            try {
                const config = getConfig();

                let text = '';
                if (data.currentSource === 'file') {
                    const fileInput = document.getElementById('fileInput');
                    if (!fileInput.files || fileInput.files.length === 0) {
                        showNotification('ç”ŸæˆèŠ‚ç‚¹å¤±è´¥', 'è¯·å…ˆä¸Šä¼ CSVæ–‡ä»¶æˆ–ç²˜è´´å†…å®¹', 'error');
                        showLoading(false);
                        return;
                    }
                    const file = fileInput.files[0];
                    text = await readFile(file);
                } else {
                    text = document.getElementById('csvInput').value.trim();
                    if (!text) {
                        showNotification('ç”ŸæˆèŠ‚ç‚¹å¤±è´¥', 'è¯·æä¾›CSVæ•°æ®ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶æˆ–ç²˜è´´å†…å®¹', 'error');
                        showLoading(false);
                        return;
                    }
                }

                data.vlessLinks = parseAndGenerate(text, config);
                data.stats.local = data.vlessLinks.length;
                data.cache.lastLocalGeneration = Date.now();

                // è‡ªåŠ¨ç”Ÿæˆæœ¬åœ°Base64
                if (data.vlessLinks.length > 0) {
                    data.localBase64Content = btoa(data.vlessLinks.join('\n'));
                    document.getElementById('localBase64Output').textContent = data.localBase64Content;
                    document.getElementById('localBase64Output').classList.remove('empty');
                }

                displayVlessLinks();
                updateStats();

                // æ™ºèƒ½æ£€æŸ¥ï¼šå¦‚æœå·²æœ‰è¿œç¨‹èŠ‚ç‚¹ç¼“å­˜ï¼Œè‡ªåŠ¨æç¤ºåˆå¹¶
                if (data.remoteNodes.length > 0 || data.cache.remoteNodes.length > 0) {
                    // å¦‚æœè¿œç¨‹èŠ‚ç‚¹ä¸ºç©ºä½†ç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œæ¢å¤ç¼“å­˜
                    if (data.remoteNodes.length === 0 && data.cache.remoteNodes.length > 0) {
                        data.remoteNodes = [...data.cache.remoteNodes];
                        data.stats.remote = data.remoteNodes.length;
                        updateStats();
                    }

                    // æ˜¾ç¤ºåˆå¹¶æç¤º
                    setTimeout(() => {
                        showNotification('æç¤º', `å·²ç”Ÿæˆ ${data.vlessLinks.length} ä¸ªæœ¬åœ°èŠ‚ç‚¹ï¼Œæ£€æµ‹åˆ° ${data.remoteNodes.length} ä¸ªè¿œç¨‹èŠ‚ç‚¹ï¼Œç‚¹å‡»"åˆå¹¶èŠ‚ç‚¹"æŒ‰é’®è¿›è¡Œåˆå¹¶`, 'info');
                    }, 500);
                }

                showNotification('èŠ‚ç‚¹ç”ŸæˆæˆåŠŸ', `æˆåŠŸç”Ÿæˆ ${data.vlessLinks.length} ä¸ªVlessèŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨ç”ŸæˆBase64è®¢é˜…`, 'success');
                addLog('ç”ŸæˆèŠ‚ç‚¹', `æˆåŠŸç”Ÿæˆ ${data.vlessLinks.length} ä¸ªVlessèŠ‚ç‚¹`, 'success');
            } catch (e) {
                showNotification('èŠ‚ç‚¹ç”Ÿæˆå¤±è´¥', 'ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ç”ŸæˆèŠ‚ç‚¹', 'ç”Ÿæˆå¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function getConfig() {
            return {
                uuid: "471a8e64-7b21-4703-b1d1-45a221098459",
                host: document.getElementById('host').value.trim() || "knny.dpdns.org",
                sni: document.getElementById('sni').value.trim() || "knny.dpdns.org",
                fp: document.getElementById('fp').value.trim() || "chrome",
                force443: document.getElementById('forcePort443').checked,
                defaultPort: parseInt(document.getElementById('defaultPort').value) || 443,
                prefix: document.getElementById('remarksPrefix').value.trim() || 'è‡ªé€‰',
                autoLoc: document.getElementById('autoLocation').checked,
                useCsvInfo: document.getElementById('useCsvInfo').checked,
                ipColumn: parseInt(document.getElementById('ipColumn').value) || 0,
                portColumn: parseInt(document.getElementById('portColumn').value) || -1,
                cityColumn: parseInt(document.getElementById('cityColumn').value) || -1,
                countryColumn: parseInt(document.getElementById('countryColumn').value) || -1,
                regionColumn: parseInt(document.getElementById('regionColumn').value) || -1,
                speedColumn: parseInt(document.getElementById('speedColumn').value) || -1
            };
        }

        function parseAndGenerate(text, config) {
            // å¦‚æœæ˜¯æ–‡ä»¶ä¸Šä¼ çš„CSVï¼Œå°è¯•è§£æå®Œæ•´CSV
            if (data.currentSource === 'file') {
                return parseCSVFile(text, config);
            } else {
                // å¦‚æœæ˜¯ç²˜è´´å†…å®¹ï¼Œä½¿ç”¨æ™ºèƒ½åˆ†å‰²
                return parsePasteText(text, config);
            }
        }

        // è§£æCSVæ–‡ä»¶ - ä¿®å¤åˆ«åç”Ÿæˆé€»è¾‘
        // è§£æCSVæ–‡ä»¶ - ä¿®å¤åˆ«åç”Ÿæˆé€»è¾‘ï¼ŒæŒ‰ç…§éœ€æ±‚1ç”Ÿæˆåˆ«å
        function parseCSVFile(text, config) {
            const nodes = [];
            const regionGroups = {};
            const lines = text.split(/\r?\n/).filter(line => line.trim());

            if (lines.length === 0) return [];

            // æ£€æŸ¥æ˜¯å¦æœ‰æ ‡é¢˜è¡Œ
            let hasHeader = data.csvColumnDetection.detected ? data.csvColumnDetection.hasHeader : false;
            if (!data.csvColumnDetection.detected) {
                // å¦‚æœæ²¡æœ‰æ£€æµ‹è¿‡ï¼Œè¿›è¡Œç®€å•æ£€æµ‹
                const firstLine = lines[0].toLowerCase();
                hasHeader = firstLine.includes('ip') || firstLine.includes('host') ||
                    firstLine.includes('port') || firstLine.includes('åœ°å€') ||
                    firstLine.includes('ç«¯å£');
            }

            let startIndex = hasHeader ? 1 : 0;

            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                try {
                    const row = parseCSVLine(line);

                    // è·å–IPå’Œç«¯å£
                    let ip = '';
                    let port = config.defaultPort;

                    // ä»æŒ‡å®šåˆ—è·å–IP
                    if (config.ipColumn >= 0 && config.ipColumn < row.length) {
                        ip = row[config.ipColumn].trim();
                        // å¦‚æœIPåŒ…å«ç«¯å£ï¼Œåˆ†å‰²å‡ºæ¥
                        if (ip.includes(':')) {
                            const parts = ip.split(':');
                            ip = parts[0];
                            if (parts.length > 1) {
                                const portStr = parts[1];
                                if (portStr && /^\d{1,5}$/.test(portStr)) {
                                    port = parseInt(portStr) || config.defaultPort;
                                }
                            }
                        }
                    }

                    // ä»æŒ‡å®šåˆ—è·å–ç«¯å£
                    if (config.portColumn >= 0 && config.portColumn < row.length) {
                        const portStr = row[config.portColumn].trim();
                        if (portStr && /^\d{1,5}$/.test(portStr)) {
                            const parsedPort = parseInt(portStr);
                            if (parsedPort >= 1 && parsedPort <= 65535) {
                                port = parsedPort;
                            }
                        }
                    }

                    // éªŒè¯IPæœ‰æ•ˆæ€§
                    if (!isValidIP(ip)) {
                        continue;
                    }

                    // å¼ºåˆ¶ä½¿ç”¨443ç«¯å£ï¼ˆå¦‚æœå‹¾é€‰äº†æ­¤é€‰é¡¹ï¼‰
                    if (config.force443) {
                        port = 443;
                    }

                    // è·å–CSVä¸­çš„ä¿¡æ¯ç”¨äºç”Ÿæˆåˆ«å
                    let city = '';
                    let country = '';
                    let region = '';
                    let speed = '';

                    if (config.cityColumn >= 0 && config.cityColumn < row.length) {
                        city = row[config.cityColumn].trim();
                    }

                    if (config.countryColumn >= 0 && config.countryColumn < row.length) {
                        country = row[config.countryColumn].trim();
                    }

                    if (config.regionColumn >= 0 && config.regionColumn < row.length) {
                        region = row[config.regionColumn].trim();
                    }

                    if (config.speedColumn >= 0 && config.speedColumn < row.length) {
                        speed = row[config.speedColumn].trim();
                        // æå–é€Ÿåº¦æ•°å€¼
                        const speedMatch = speed.match(/(\d+(\.\d+)?)/);
                        if (speedMatch) {
                            speed = `${speedMatch[1]}MB/s`;
                        }
                    }

                    // è½¬æ¢åœ°åŒºç ä¸ºä¸­æ–‡åç§°
                    let chineseRegion = '';
                    if (region && region.trim()) {
                        const regionUpper = region.trim().toUpperCase();
                        if (regionCodeToChinese[regionUpper]) {
                            chineseRegion = regionCodeToChinese[regionUpper];
                        }
                    }

                    // è½¬æ¢åŸå¸‚åä¸ºä¸­æ–‡åç§°
                    let chineseCity = '';
                    if (city && city.trim()) {
                        const cityUpper = city.trim().toUpperCase();
                        if (regionCodeToChinese[cityUpper]) {
                            chineseCity = regionCodeToChinese[cityUpper];
                        } else {
                            chineseCity = city;
                        }
                    }

                    // è½¬æ¢å›½å®¶åä¸ºä¸­æ–‡åç§°
                    let chineseCountry = '';
                    if (country && country.trim()) {
                        const countryName = country.trim();
                        if (countryNameToChinese[countryName]) {
                            chineseCountry = countryNameToChinese[countryName];
                        } else {
                            chineseCountry = country;
                        }
                    }

                    // ç¡®å®šåœ°åŒºåç”¨äºåˆ†ç»„å’Œåºå·
                    let regionNameForGroup = '';

                    // ä¼˜å…ˆä½¿ç”¨CSVä¿¡æ¯ï¼ˆå¦‚æœç”¨æˆ·å‹¾é€‰äº†ä½¿ç”¨CSVä¿¡æ¯ï¼‰
                    if (config.useCsvInfo) {
                        if (chineseRegion) {
                            regionNameForGroup = chineseRegion;
                        } else if (chineseCity) {
                            regionNameForGroup = chineseCity;
                        } else if (chineseCountry) {
                            regionNameForGroup = chineseCountry;
                        }
                    }

                    // å¦‚æœæ²¡æœ‰ä»CSVè·å–åˆ°åœ°åŒºä¿¡æ¯ï¼Œä½¿ç”¨IPæ£€æµ‹
                    if (!regionNameForGroup) {
                        const detectedLocation = getLocation(ip);
                        regionNameForGroup = detectedLocation !== 'æœªçŸ¥' ? detectedLocation : config.prefix;
                    }

                    // åˆå§‹åŒ–åœ°åŒºç»„
                    if (!regionGroups[regionNameForGroup]) {
                        regionGroups[regionNameForGroup] = {
                            nodes: [],
                            counter: 1
                        };
                    }

                    // ä¸ºå½“å‰èŠ‚ç‚¹ç”Ÿæˆåºå·
                    const sequence = regionGroups[regionNameForGroup].counter.toString().padStart(2, '0');

                    // ç”Ÿæˆåˆ«åéƒ¨åˆ†æ•°ç»„
                    const aliasParts = [];

                    // 1. åœ°åŒºå+åºå·ï¼ˆå¦‚ï¼šåœ£ä½•å¡01ï¼‰
                    aliasParts.push(`${regionNameForGroup}${sequence}`);

                    // 2. ä¸‹è½½é€Ÿåº¦ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (speed) {
                        aliasParts.push(speed);
                    }

                    // 3. ç«¯å£
                    aliasParts.push(port.toString());

                    // 4. å›½å®¶ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (chineseCountry) {
                        aliasParts.push(chineseCountry);
                    }

                    // 5. IPåœ°å€
                    aliasParts.push(ip);

                    // ç”¨"-"è¿æ¥æ‰€æœ‰éƒ¨åˆ†
                    const remark = aliasParts.join('-');

                    // ä¿å­˜èŠ‚ç‚¹ä¿¡æ¯
                    regionGroups[regionNameForGroup].nodes.push({
                        ip: ip,
                        port: port,
                        remark: remark,
                        config: config
                    });

                    // å¢åŠ è®¡æ•°å™¨
                    regionGroups[regionNameForGroup].counter++;
                } catch (e) {
                    console.warn(`è§£æCSVè¡Œå¤±è´¥: ${line}`, e);
                }
            }

            // ç”Ÿæˆæ‰€æœ‰èŠ‚ç‚¹
            Object.keys(regionGroups).forEach(regionName => {
                regionGroups[regionName].nodes.forEach(node => {
                    nodes.push(generateLink(node.ip, node.port, node.config, node.remark));
                });
            });

            console.log(`CSVè§£æå®Œæˆï¼šç”Ÿæˆ ${nodes.length} ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‰ ${Object.keys(regionGroups).length} ä¸ªåœ°åŒºåˆ†ç»„`);
            return nodes;
        }

        // æ–°å¢ï¼šä»CSVä¿¡æ¯ç”Ÿæˆåˆ«åï¼ˆæ ¹æ®éœ€æ±‚1ï¼‰
        function generateRemarkFromCSV(ip, port, city, country, region, speed, config) {
            // å¦‚æœä¸ä½¿ç”¨CSVä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤æ–¹å¼
            if (!config.useCsvInfo) {
                const location = getLocation(ip);
                const regionKey = location !== 'æœªçŸ¥' ? location : config.prefix;
                return {
                    remark: `${location}-${port}-${ip}`,
                    regionKey: regionKey
                };
            }

            // è½¬æ¢åœ°åŒºç ä¸ºä¸­æ–‡åç§°ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
            let chineseRegion = region;
            if (region && region.trim()) {
                const regionUpper = region.trim().toUpperCase();
                if (regionCodeToChinese[regionUpper]) {
                    chineseRegion = regionCodeToChinese[regionUpper];
                }
            }

            // è½¬æ¢åŸå¸‚åä¸ºä¸­æ–‡åç§°ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
            let chineseCity = city;
            if (city && city.trim()) {
                const cityUpper = city.trim().toUpperCase();
                if (regionCodeToChinese[cityUpper]) {
                    chineseCity = regionCodeToChinese[cityUpper];
                }
            }

            // è½¬æ¢å›½å®¶åä¸ºä¸­æ–‡åç§°ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
            let chineseCountry = country;
            if (country && country.trim()) {
                const countryName = country.trim();
                if (countryNameToChinese[countryName]) {
                    chineseCountry = countryNameToChinese[countryName];
                }
            }

            // æ„å»ºåˆ«åéƒ¨åˆ† - æŒ‰ç…§éœ€æ±‚1çš„é¡ºåºï¼šåŸå¸‚/åœ°åŒºç ï¼Œä¸‹è½½é€Ÿåº¦ï¼Œç«¯å£ï¼Œå›½å®¶
            const parts = [];

            // 1. åŸå¸‚æˆ–åœ°åŒºç ï¼ˆä¼˜å…ˆåœ°åŒºç ï¼Œç„¶ååŸå¸‚ï¼‰
            if (chineseRegion && chineseRegion.trim()) {
                parts.push(chineseRegion.trim());
            } else if (chineseCity && chineseCity.trim()) {
                parts.push(chineseCity.trim());
            }

            // 2. ä¸‹è½½é€Ÿåº¦ï¼ˆå¦‚æœæœ‰ï¼‰
            if (speed && speed.trim()) {
                // æå–æ•°å­—éƒ¨åˆ†
                const speedMatch = speed.match(/(\d+(\.\d+)?)/);
                if (speedMatch) {
                    parts.push(`${speedMatch[1]}MB/s`);
                }
            }

            // 3. ç«¯å£
            parts.push(port.toString());

            // 4. å›½å®¶ï¼ˆå¦‚æœæœ‰ï¼‰
            if (chineseCountry && chineseCountry.trim()) {
                parts.push(chineseCountry.trim());
            }

            // ç¡®å®šåœ°åŒºkeyç”¨äºåˆ†ç»„
            let regionKey = '';
            if (chineseRegion && chineseRegion.trim()) {
                regionKey = chineseRegion.trim();
            } else if (chineseCity && chineseCity.trim()) {
                regionKey = chineseCity.trim();
            } else if (chineseCountry && chineseCountry.trim()) {
                regionKey = chineseCountry.trim();
            } else {
                // å¦‚æœCSVä¸­æ²¡æœ‰ä»»ä½•åœ°åŒºä¿¡æ¯ï¼Œä½¿ç”¨IPæ£€æµ‹çš„åœ°åŒº
                const detectedLocation = getLocation(ip);
                regionKey = detectedLocation !== 'æœªçŸ¥' ? detectedLocation : config.prefix;
            }

            // å¦‚æœæ²¡æœ‰ä»»ä½•ä¿¡æ¯ï¼Œä½¿ç”¨IPæ£€æµ‹çš„åœ°åŒº
            if (parts.length === 0) {
                const detectedLocation = getLocation(ip);
                parts.push(detectedLocation !== 'æœªçŸ¥' ? detectedLocation : config.prefix);
                parts.push(port.toString());
                parts.push(ip);
                regionKey = detectedLocation !== 'æœªçŸ¥' ? detectedLocation : config.prefix;
            }

            return {
                remark: parts.join('-'),
                regionKey: regionKey
            };
        }

        // è§£æç²˜è´´æ–‡æœ¬ - ä¿®å¤ï¼šä½¿ç”¨æ–°çš„åˆ«åç”Ÿæˆé€»è¾‘
        // è§£æç²˜è´´æ–‡æœ¬ - ä¿®å¤åˆ«åç”Ÿæˆé€»è¾‘ï¼ŒæŒ‰ç…§éœ€æ±‚2ç”Ÿæˆåˆ«å
        function parsePasteText(text, config) {
            const ipPortPairs = smartSplitIPPort(text);
            const nodes = [];
            const regionGroups = {};

            ipPortPairs.forEach(pair => {
                const { ip, port } = pair;

                if (!ip) return;

                // å¼ºåˆ¶ä½¿ç”¨443ç«¯å£ï¼ˆå¦‚æœå‹¾é€‰äº†æ­¤é€‰é¡¹ï¼‰
                let finalPort = port;
                if (config.force443) {
                    finalPort = 443;
                }
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç«¯å£ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£
                else if (!finalPort) {
                    finalPort = config.defaultPort;
                }

                // ä½¿ç”¨IPæ£€æµ‹è·å–åœ°åŒºä¿¡æ¯
                const location = getLocation(ip);
                const regionName = location !== 'æœªçŸ¥' ? location : config.prefix;

                // åˆå§‹åŒ–åœ°åŒºç»„
                if (!regionGroups[regionName]) {
                    regionGroups[regionName] = {
                        nodes: [],
                        counter: 1
                    };
                }

                // ä¸ºå½“å‰èŠ‚ç‚¹ç”Ÿæˆåºå·
                const sequence = regionGroups[regionName].counter.toString().padStart(2, '0');

                // ç”Ÿæˆåˆ«åï¼šåœ°åŒºååºå·-ç«¯å£-IPï¼ˆå¦‚ï¼šé¦™æ¸¯01-443-127.0.0.1ï¼‰
                const remark = `${regionName}${sequence}-${finalPort}-${ip}`;

                // ä¿å­˜èŠ‚ç‚¹ä¿¡æ¯
                regionGroups[regionName].nodes.push({
                    ip: ip,
                    port: finalPort,
                    remark: remark,
                    config: config
                });

                // å¢åŠ è®¡æ•°å™¨
                regionGroups[regionName].counter++;
            });

            // ç”Ÿæˆæ‰€æœ‰èŠ‚ç‚¹
            Object.keys(regionGroups).forEach(regionName => {
                regionGroups[regionName].nodes.forEach(node => {
                    nodes.push(generateLink(node.ip, node.port, node.config, node.remark));
                });
            });

            return nodes;
        }

        // æ–°å¢ï¼šæ™ºèƒ½åˆ†å‰²IPå’Œç«¯å£ - ä¿®å¤ï¼šæ”¯æŒå¤šä¸ªç©ºæ ¼åˆ†éš”
        function smartSplitIPPort(text) {
            const result = [];
            const seen = new Set(); // ç”¨äºå»é‡

            // æ›¿æ¢å¸¸è§åˆ†éš”ç¬¦ä¸ºç»Ÿä¸€çš„åˆ†éš”ç¬¦ï¼Œå¤„ç†å¤šä¸ªç©ºæ ¼
            let normalizedText = text.replace(/[,;\s]+/g, ' ');
            normalizedText = normalizedText.replace(/\s+/g, ' '); // å°†å¤šä¸ªç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼

            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…IP:ç«¯å£æˆ–IP ç«¯å£
            // åŒ¹é…æ ¼å¼: IP:ç«¯å£ æˆ– IP ç«¯å£ æˆ– åªæœ‰IP
            // ä¿®å¤ï¼šæ”¯æŒIPå’Œç«¯å£ä¹‹é—´å¤šä¸ªç©ºæ ¼çš„æƒ…å†µ
            const ipPortPattern = /(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?:\s*[:,\s]\s*(\d{1,5}))?/g;

            let match;
            while ((match = ipPortPattern.exec(text)) !== null) {
                const ip = match[1];
                const port = match[2] ? parseInt(match[2]) : null;

                // éªŒè¯IPæœ‰æ•ˆæ€§
                if (!isValidIP(ip)) continue;

                // éªŒè¯ç«¯å£æœ‰æ•ˆæ€§
                if (port !== null && (port < 1 || port > 65535)) continue;

                // å»é‡
                const key = `${ip}:${port || 'default'}`;
                if (!seen.has(key)) {
                    seen.add(key);
                    result.push({ ip, port });
                }
            }

            // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°IP:ç«¯å£æ ¼å¼ï¼Œå°è¯•å…¶ä»–æ ¼å¼
            if (result.length === 0) {
                // åˆ†å‰²æ–‡æœ¬æˆå•è¯
                const words = normalizedText.split(/\s+/).filter(w => w.trim());

                for (let i = 0; i < words.length; i++) {
                    const word = words[i].trim();

                    // æ£€æŸ¥æ˜¯å¦æ˜¯IPåœ°å€
                    if (isValidIP(word)) {
                        const ip = word;
                        let port = null;

                        // æ£€æŸ¥ä¸‹ä¸€ä¸ªå•è¯æ˜¯å¦æ˜¯ç«¯å£
                        if (i + 1 < words.length) {
                            const nextWord = words[i + 1];
                            const possiblePort = parseInt(nextWord);
                            if (!isNaN(possiblePort) && possiblePort >= 1 && possiblePort <= 65535) {
                                port = possiblePort;
                                i++; // è·³è¿‡ç«¯å£å•è¯
                            }
                        }

                        // å»é‡
                        const key = `${ip}:${port || 'default'}`;
                        if (!seen.has(key)) {
                            seen.add(key);
                            result.push({ ip, port });
                        }
                    }
                    // æ£€æŸ¥æ˜¯å¦æ˜¯IP:ç«¯å£æ ¼å¼ï¼ˆå·²å¤„ç†è¿‡ï¼Œä½†è¿™é‡Œä½œä¸ºåå¤‡ï¼‰
                    else if (word.includes(':')) {
                        const parts = word.split(':');
                        if (parts.length === 2) {
                            const ip = parts[0].trim();
                            const portStr = parts[1].trim();

                            if (isValidIP(ip)) {
                                const port = parseInt(portStr);
                                if (!isNaN(port) && port >= 1 && port <= 65535) {
                                    const key = `${ip}:${port}`;
                                    if (!seen.has(key)) {
                                        seen.add(key);
                                        result.push({ ip, port });
                                    }
                                }
                            }
                        }
                    }
                }
            }

            return result;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const next = line[i + 1];

                if (char === '"' && !inQuotes) inQuotes = true;
                else if (char === '"' && inQuotes && next === '"') { current += '"'; i++; }
                else if (char === '"' && inQuotes) inQuotes = false;
                else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; }
                else current += char;
            }
            result.push(current.trim());
            return result;
        }

        function generateLink(ip, port, config, remark) {
            const params = [
                'encryption=none',
                'security=tls',
                `sni=${encodeURIComponent(config.sni)}`,
                `fp=${config.fp}`,
                'type=ws',
                `host=${encodeURIComponent(config.host)}`,
                'path=%2F',
                'alpn=h2%2Chttp%2F1.1',
                'flow='
            ];
            return `vless://${config.uuid}@${ip}:${port}?${params.join('&')}#${encodeURIComponent(remark)}`;
        }

        function displayVlessLinks() {
            const el = document.getElementById('vless-links');
            el.textContent = data.vlessLinks.length ? data.vlessLinks.join('\n\n') : 'Vlessé“¾æ¥å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            el.classList.toggle('empty', data.vlessLinks.length === 0);
            document.getElementById('resultCount').textContent = `${data.vlessLinks.length}èŠ‚ç‚¹`;
            document.getElementById('localNodeCount').textContent = `${data.vlessLinks.length}èŠ‚ç‚¹`;
        }

        function convertManualToBase64() {
            const input = document.getElementById('manualVlessInput').value.trim();
            if (!input) {
                showNotification('è½¬æ¢å¤±è´¥', 'è¯·å…ˆç²˜è´´VlessèŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªvless://å¼€å¤´çš„é“¾æ¥', 'error');
                return;
            }

            const lines = input.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
            if (lines.length === 0) {
                showNotification('è½¬æ¢å¤±è´¥', 'æœªæ£€æµ‹åˆ°æœ‰æ•ˆvlessé“¾æ¥ï¼Œè¯·ç¡®ä¿æ¯è¡Œä»¥vless://å¼€å¤´', 'error');
                return;
            }

            const plain = lines.join('\n');
            data.manualBase64Content = btoa(plain);

            const sec = document.getElementById('manualBase64Section');
            sec.style.display = 'block';
            document.getElementById('manualBase64Output').textContent = data.manualBase64Content;
            document.getElementById('manualBase64Output').classList.remove('empty');

            showNotification('è½¬æ¢æˆåŠŸ', `æˆåŠŸè½¬æ¢ ${lines.length} ä¸ªèŠ‚ç‚¹ä¸ºBase64è®¢é˜…ï¼Œå¯ç”¨äºå¯¼å…¥å®¢æˆ·ç«¯`, 'success');
            addLog('è½¬æ¢èŠ‚ç‚¹', `æˆåŠŸè½¬æ¢ ${lines.length} ä¸ªèŠ‚ç‚¹ä¸ºBase64è®¢é˜…`, 'success');
        }

        // æ–°å¢ï¼šæ‰‹åŠ¨Vlessè½¬IP:ç«¯å£
        function convertManualToIpPort() {
            const input = document.getElementById('manualVlessInput2').value.trim();
            if (!input) {
                showNotification('è½¬æ¢å¤±è´¥', 'è¯·å…ˆç²˜è´´VlessèŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªvless://å¼€å¤´çš„é“¾æ¥', 'error');
                return;
            }

            const lines = input.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
            if (lines.length === 0) {
                showNotification('è½¬æ¢å¤±è´¥', 'æœªæ£€æµ‹åˆ°æœ‰æ•ˆvlessé“¾æ¥ï¼Œè¯·ç¡®ä¿æ¯è¡Œä»¥vless://å¼€å¤´', 'error');
                return;
            }

            const ipPortList = [];
            lines.forEach(line => {
                // æå–IPå’Œç«¯å£
                const match = line.match(/vless:\/\/[^@]+@([^:]+):(\d+)/);
                if (match) {
                    const ip = match[1];
                    const port = match[2];
                    ipPortList.push(`${ip}:${port}`);
                }
            });

            if (ipPortList.length === 0) {
                showNotification('è½¬æ¢å¤±è´¥', 'æ— æ³•ä»Vlessé“¾æ¥ä¸­æå–IPå’Œç«¯å£', 'error');
                return;
            }

            data.manualIpPortContent = ipPortList.join('\n');

            const sec = document.getElementById('manualIpPortSection');
            sec.style.display = 'block';
            document.getElementById('manualIpPortOutput').textContent = data.manualIpPortContent;
            document.getElementById('manualIpPortOutput').classList.remove('empty');

            showNotification('è½¬æ¢æˆåŠŸ', `æˆåŠŸæå– ${ipPortList.length} ä¸ªIP:ç«¯å£ç»„åˆ`, 'success');
            addLog('æå–IPç«¯å£', `æˆåŠŸæå– ${ipPortList.length} ä¸ªIP:ç«¯å£ç»„åˆ`, 'success');
        }

        // æ–°å¢ï¼šä¸‹è½½IP:ç«¯å£TXTæ–‡ä»¶
        function downloadIpPortTxt() {
            if (!data.manualIpPortContent) {
                showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆæå–IP:ç«¯å£', 'error');
                return;
            }

            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            downloadBlob(data.manualIpPortContent, `ip_port_${timestamp}.txt`);
            showNotification('ä¸‹è½½æˆåŠŸ', 'IP:ç«¯å£æ–‡ä»¶å·²ä¸‹è½½åˆ°æœ¬åœ°', 'success');
            addLog('ä¸‹è½½æ–‡ä»¶', 'IP:ç«¯å£TXTæ–‡ä»¶å·²ä¸‹è½½', 'success');
        }

        // æ–°å¢ï¼šç»Ÿä¸€çš„ç¡®è®¤å¯¹è¯æ¡† - æ›´ç®€æ´å¤§æ°”ï¼Œæ”¯æŒé”®ç›˜å¿«æ·é”®
        function showConfirmDialog(title, message, onConfirm, onCancel = null, type = 'info') {
            // ç§»é™¤å·²å­˜åœ¨çš„å¯¹è¯æ¡†
            const existingDialog = document.querySelector('.custom-dialog-overlay');
            if (existingDialog) {
                existingDialog.remove();
                if (dialogKeyHandler) {
                    document.removeEventListener('keydown', dialogKeyHandler);
                    dialogKeyHandler = null;
                }
            }

            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.className = 'custom-dialog-overlay';

            // æ ¹æ®ç±»å‹è®¾ç½®å›¾æ ‡
            let iconText = '!';
            let dialogClass = '';

            if (type === 'warning') iconText = 'âš ';
            else if (type === 'error') iconText = 'âœ•';
            else if (type === 'success') iconText = 'âœ“';

            if (type !== 'info') dialogClass = ` ${type}`;

            // åˆ›å»ºå¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.className = `custom-dialog${dialogClass}`;
            dialog.tabIndex = -1; // ä½¿å¯¹è¯æ¡†å¯èšç„¦

            dialog.innerHTML = `
            <div class="custom-dialog-header">
                <div class="custom-dialog-icon">${iconText}</div>
                <h3 class="custom-dialog-title">${title}</h3>
            </div>
            <div class="custom-dialog-content">${message}</div>
            <div class="custom-dialog-actions">
                <button class="custom-dialog-btn custom-dialog-btn-cancel" id="dialogCancelBtn">
                    å–æ¶ˆ (ESC)
                </button>
                <button class="custom-dialog-btn custom-dialog-btn-confirm" id="dialogConfirmBtn">
                    ç¡®è®¤ (Enter)
                </button>
            </div>
        `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // å…³é—­å¯¹è¯æ¡†å‡½æ•°
            const closeDialog = (action) => {
                // ç§»é™¤äº‹ä»¶ç›‘å¬
                if (dialogKeyHandler) {
                    document.removeEventListener('keydown', dialogKeyHandler);
                    dialogKeyHandler = null;
                }
                overlay.remove();

                // æ‰§è¡Œç›¸åº”çš„å›è°ƒ
                if (action === 'confirm' && onConfirm) {
                    onConfirm();
                } else if (action === 'cancel' && onCancel) {
                    onCancel();
                }
            };

            // é”®ç›˜äº‹ä»¶å¤„ç†å‡½æ•°
            dialogKeyHandler = (e) => {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    e.stopPropagation();
                    closeDialog('cancel');
                } else if (e.key === 'Enter' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeDialog('confirm');
                }
            };

            // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
            document.addEventListener('keydown', dialogKeyHandler);

            // ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('dialogConfirmBtn').addEventListener('click', () => {
                closeDialog('confirm');
            });

            document.getElementById('dialogCancelBtn').addEventListener('click', () => {
                closeDialog('cancel');
            });

            // ç‚¹å‡»é®ç½©å±‚å…³é—­ï¼ˆç›¸å½“äºå–æ¶ˆï¼‰
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeDialog('cancel');
                }
            });

            // å¯¹è¯æ¡†è·å–ç„¦ç‚¹ï¼Œæ–¹ä¾¿é”®ç›˜æ“ä½œ
            setTimeout(() => {
                dialog.focus();
                document.getElementById('dialogCancelBtn').focus(); // é»˜è®¤ç„¦ç‚¹åœ¨å–æ¶ˆæŒ‰é’®
            }, 100);
        }

        // æ–°å¢ï¼šéªŒè¯å¹¶åˆå¹¶ - æ™ºèƒ½ç¼“å­˜æ£€æŸ¥
        function validateAndMerge() {
            const localCount = data.vlessLinks.length;
            const remoteCount = data.remoteNodes.length;
            const cachedRemoteCount = data.cache.remoteNodes.length;

            // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„èŠ‚ç‚¹æ•°æ®
            if (localCount === 0 && remoteCount === 0 && cachedRemoteCount === 0) {
                showConfirmDialog(
                    'æ— æ³•åˆå¹¶',
                    'æœ¬åœ°å’Œè¿œç¨‹éƒ½æ²¡æœ‰èŠ‚ç‚¹æ•°æ®ï¼Œæ— æ³•è¿›è¡Œåˆå¹¶æ“ä½œã€‚<br><br>è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹æˆ–ä¸‹è½½è¿œç¨‹è®¢é˜…ã€‚',
                    () => {
                        showNotification('æç¤º', 'è¯·å…ˆç”ŸæˆèŠ‚ç‚¹æˆ–ä¸‹è½½è¿œç¨‹è®¢é˜…', 'info');
                    },
                    null,
                    'warning'
                );
                return;
            }

            // æ£€æŸ¥æ˜¯å¦éœ€è¦ä½¿ç”¨ç¼“å­˜æ•°æ®
            if (localCount > 0 && remoteCount === 0 && cachedRemoteCount > 0) {
                showConfirmDialog(
                    'ä½¿ç”¨ç¼“å­˜æ•°æ®',
                    `æœ¬åœ°æœ‰ <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹ï¼Œè¿œç¨‹èŠ‚ç‚¹æ•°æ®ä¸ºç©ºï¼Œä½†ç¼“å­˜ä¸­æœ‰ <strong>${cachedRemoteCount}</strong> ä¸ªè¿œç¨‹èŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ä½¿ç”¨ç¼“å­˜ä¸­çš„è¿œç¨‹èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ï¼Ÿ<br><br>æç¤ºï¼šå¦‚æœç¼“å­˜æ•°æ®å¯èƒ½å·²è¿‡æ—¶ï¼Œå»ºè®®é‡æ–°ä¸‹è½½è¿œç¨‹è®¢é˜…ã€‚`,
                    () => {
                        // ä½¿ç”¨ç¼“å­˜æ•°æ®
                        data.remoteNodes = [...data.cache.remoteNodes];
                        data.stats.remote = data.remoteNodes.length;
                        updateStats();
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ£€æŸ¥æœ¬åœ°èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
            if (localCount === 0 && (remoteCount > 0 || cachedRemoteCount > 0)) {
                const actualRemoteCount = remoteCount > 0 ? remoteCount : cachedRemoteCount;
                showConfirmDialog(
                    'ç¡®è®¤åˆå¹¶',
                    `æœ¬åœ°æ²¡æœ‰ç”ŸæˆèŠ‚ç‚¹ï¼Œä½†æœ‰ <strong>${actualRemoteCount}</strong> ä¸ªè¿œç¨‹èŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ç»§ç»­åˆå¹¶ï¼ˆä»…ä½¿ç”¨è¿œç¨‹èŠ‚ç‚¹ï¼‰ï¼Ÿ<br><br>æç¤ºï¼šæ‚¨å¯ä»¥å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹å†åˆå¹¶ã€‚`,
                    () => {
                        // å¦‚æœå½“å‰è¿œç¨‹èŠ‚ç‚¹ä¸ºç©ºä½†ç¼“å­˜æœ‰æ•°æ®ï¼Œä½¿ç”¨ç¼“å­˜
                        if (remoteCount === 0 && cachedRemoteCount > 0) {
                            data.remoteNodes = [...data.cache.remoteNodes];
                            data.stats.remote = data.remoteNodes.length;
                            updateStats();
                        }
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ£€æŸ¥è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
            if (remoteCount === 0 && localCount > 0) {
                showConfirmDialog(
                    'ç¡®è®¤åˆå¹¶',
                    `è¿œç¨‹æ²¡æœ‰èŠ‚ç‚¹ï¼Œæœ¬åœ°æœ‰ <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹ã€‚<br><br>æ˜¯å¦ç»§ç»­åˆå¹¶ï¼ˆä»…ä½¿ç”¨æœ¬åœ°èŠ‚ç‚¹ï¼‰ï¼Ÿ<br><br>æç¤ºï¼šæ‚¨å¯ä»¥å…ˆä¸‹è½½è¿œç¨‹è®¢é˜…å†åˆå¹¶ã€‚`,
                    () => {
                        mergeAndShow();
                    },
                    () => {
                        // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                        showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                    },
                    'info'
                );
                return;
            }

            // æ­£å¸¸åˆå¹¶
            const totalNodes = localCount + remoteCount;
            showConfirmDialog(
                'ç¡®è®¤åˆå¹¶',
                `å³å°†åˆå¹¶æœ¬åœ° <strong>${localCount}</strong> ä¸ªèŠ‚ç‚¹å’Œè¿œç¨‹ <strong>${remoteCount}</strong> ä¸ªèŠ‚ç‚¹ï¼Œæ€»è®¡ <strong>${totalNodes}</strong> ä¸ªèŠ‚ç‚¹ã€‚<br><br>åˆå¹¶åå°†è‡ªåŠ¨å»é‡å¹¶é‡æ–°è®¾ç½®åˆ«åã€‚<br><br>æ˜¯å¦ç»§ç»­ï¼Ÿ`,
                () => {
                    mergeAndShow();
                },
                () => {
                    // ç”¨æˆ·é€‰æ‹©ä¸åˆå¹¶
                    showNotification('æç¤º', 'å·²å–æ¶ˆåˆå¹¶æ“ä½œ', 'info');
                },
                'info'
            );
        }

        // æ–°å¢ï¼šéªŒè¯å¹¶ä¸Šä¼ 
        function validateAndUpload(uploadFunction) {
            let nodeCount = 0;
            let targetPath = '';
            let uploadFunc = null;
            let uploadType = '';

            // æ ¹æ®ä¸åŒçš„ä¸Šä¼ å‡½æ•°è®¾ç½®å‚æ•°
            switch (uploadFunction) {
                case 'uploadLocalBase64ToPath':
                    nodeCount = data.vlessLinks.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    const uploadPathSelect = document.getElementById('uploadPathSelect');
                    let uploadPath = uploadPathSelect.value;
                    if (uploadPath === 'custom') {
                        const customPath = document.getElementById('customUploadPath').value.trim();
                        if (!customPath) {
                            showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                            return;
                        }
                        targetPath = customPath;
                    } else {
                        targetPath = uploadPath;
                    }
                    uploadFunc = () => uploadLocalBase64ToPath();
                    uploadType = 'æœ¬åœ°è®¢é˜…';
                    break;

                case 'uploadPlainNodes':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('plainNodeFile').value.trim();
                    uploadFunc = () => uploadPlainNodes();
                    uploadType = 'åˆå¹¶æ˜æ–‡è®¢é˜…';
                    break;

                case 'uploadMergedBase64':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('mainNodeFile').value.trim();
                    uploadFunc = () => uploadMergedBase64();
                    uploadType = 'åˆå¹¶ä¸»è¦è®¢é˜…';
                    break;

                case 'uploadMergedOptimal':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    targetPath = document.getElementById('optimalNodeFile').value.trim();
                    uploadFunc = () => uploadMergedOptimal();
                    uploadType = 'åˆå¹¶ä¼˜é€‰è®¢é˜…';
                    break;

                case 'uploadMergedToPath':
                    nodeCount = data.uniqueNodes.length;
                    if (nodeCount === 0) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'warning');
                        return;
                    }
                    const pathSelect = document.getElementById('uploadPathSelect');
                    let selectedPath = pathSelect.value;
                    if (selectedPath === 'custom') {
                        const customPath = document.getElementById('customUploadPath').value.trim();
                        if (!customPath) {
                            showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                            return;
                        }
                        targetPath = customPath;
                    } else {
                        targetPath = selectedPath;
                    }
                    uploadFunc = () => uploadMergedToPath();
                    uploadType = 'åˆå¹¶è®¢é˜…åˆ°æŒ‡å®šè·¯å¾„';
                    break;
            }

            if (nodeCount === 0) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'warning');
                return;
            }

            showConfirmDialog(
                'ç¡®è®¤ä¸Šä¼ ',
                `å°† <strong>${nodeCount} ä¸ªèŠ‚ç‚¹</strong> ä¸Šä¼ åˆ° <strong>${targetPath}</strong><br><br>ä¸Šä¼ ç±»å‹ï¼š${uploadType}<br><br>æ˜¯å¦ç»§ç»­ï¼Ÿ<br><br>æç¤ºï¼šä¸Šä¼ åå°†æ›´æ–°è¿œç¨‹æ–‡ä»¶ï¼Œè¯·ç¡®ä¿æœ‰æ­£ç¡®çš„GitHubæƒé™ã€‚`,
                uploadFunc,
                () => {
                    showNotification('æç¤º', 'å·²å–æ¶ˆä¸Šä¼ æ“ä½œ', 'info');
                },
                'info'
            );
        }

        // ä¿®å¤ï¼šä¸‹è½½è¿œç¨‹è®¢é˜…åŠŸèƒ½ - ä½¿ç”¨æ›´ç®€å•å¯é çš„é€»è¾‘
        async function downloadRemote() {
            showLoading(true);
            try {
                const token = document.getElementById('githubToken').value.trim();
                if (!token) {
                    showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆè¾“å…¥GitHub Tokenï¼Œå¦åˆ™æ— æ³•è®¿é—®è¿œç¨‹ä»“åº“', 'error');
                    showLoading(false);
                    return;
                }

                const repo = document.getElementById('githubRepo').value.trim();
                if (!repo) {
                    showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆè¾“å…¥GitHubä»“åº“åç§°ï¼Œæ ¼å¼ä¸ºï¼šç”¨æˆ·å/ä»“åº“å', 'error');
                    showLoading(false);
                    return;
                }

                const branch = document.getElementById('githubBranch').value.trim() || 'main';

                // è·å–é€‰æ‹©çš„ä¸‹è½½è·¯å¾„
                const urlSelect = document.getElementById('downloadUrlSelect');
                const selectedOption = urlSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customDownloadUrl').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸‹è½½å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                // æ ¹æ®é€‰æ‹©çš„è·¯å¾„è®¾ç½®è¦ä¸‹è½½çš„æ–‡ä»¶
                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();

                let downloadFiles = [];

                if (targetFile === 'MainNode') {
                    downloadFiles = [{ file: mainNodeFile, type: 'base64' }];
                } else if (targetFile === 'PlainNode') {
                    downloadFiles = [{ file: plainNodeFile, type: 'plain' }];
                } else if (targetFile === 'OptimalNode') {
                    downloadFiles = [{ file: optimalNodeFile, type: 'base64' }];
                } else {
                    // è‡ªå®šä¹‰è·¯å¾„ï¼Œå°è¯•ä¸‹è½½
                    downloadFiles = [{ file: targetFile, type: 'unknown' }];
                }

                // æ¸…é™¤å½“å‰è¿œç¨‹èŠ‚ç‚¹æ•°æ®ï¼Œå‡†å¤‡é‡æ–°ä¸‹è½½
                data.remoteNodes = [];

                let totalDownloaded = 0;
                let successCount = 0;

                for (const fileInfo of downloadFiles) {
                    try {
                        // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                        const timestamp = Date.now();
                        const fileUrl = `https://api.github.com/repos/${repo}/contents/${fileInfo.file}?ref=${branch}&t=${timestamp}`;

                        console.log(`æ­£åœ¨ä¸‹è½½æ–‡ä»¶: ${fileInfo.file}`, fileUrl);

                        const fileRes = await fetch(fileUrl, {
                            headers: {
                                Authorization: `token ${token}`,
                                Accept: 'application/vnd.github.v3+json'
                            }
                        });

                        if (fileRes.ok) {
                            const fileJson = await fileRes.json();
                            const fileContent = atob(fileJson.content.replace(/\n/g, ''));

                            console.log(`âœ… æ–‡ä»¶ ${fileInfo.file} ä¸‹è½½æˆåŠŸï¼ŒåŸå§‹å†…å®¹é•¿åº¦: ${fileContent.length}`);

                            let nodes = [];

                            // ç®€åŒ–è§£æé€»è¾‘ï¼šé¦–å…ˆå°è¯•Base64è§£ç 
                            try {
                                // å…ˆå°è¯•è§£ç ä¸€æ¬¡Base64
                                const decodedContent = atob(fileContent);

                                // æ£€æŸ¥è§£ç åçš„å†…å®¹æ˜¯å¦åŒ…å«vless://
                                if (decodedContent.includes('vless://')) {
                                    // æˆåŠŸæ‰¾åˆ°vlessé“¾æ¥
                                    nodes = decodedContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                    console.log(`âœ… Base64è§£ç æˆåŠŸï¼Œæ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                } else {
                                    // å¯èƒ½è¿˜æœ‰ä¸€å±‚Base64ç¼–ç ï¼ˆåŒé‡Base64ï¼‰
                                    try {
                                        const doubleDecoded = atob(decodedContent);
                                        if (doubleDecoded.includes('vless://')) {
                                            nodes = doubleDecoded.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                            console.log(`âœ… åŒé‡Base64è§£ç æˆåŠŸï¼Œæ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                        } else {
                                            // å¦‚æœéƒ½ä¸æ˜¯ï¼Œå°è¯•ç›´æ¥è§£æåŸå§‹å†…å®¹
                                            nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                            console.log(`âœ… ç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                        }
                                    } catch (e2) {
                                        // åŒé‡Base64è§£ç å¤±è´¥ï¼Œå°è¯•ç›´æ¥è§£æ
                                        nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                        console.log(`âœ… åŒé‡Base64è§£ç å¤±è´¥ï¼Œç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                                    }
                                }
                            } catch (e) {
                                // Base64è§£ç å¤±è´¥ï¼Œç›´æ¥è§£æåŸå§‹å†…å®¹
                                console.log(`âš ï¸ Base64è§£ç å¤±è´¥ï¼Œå°è¯•ç›´æ¥è§£æ: ${e.message}`);
                                nodes = fileContent.split(/\r?\n/).filter(l => l.trim().startsWith('vless://'));
                                console.log(`âœ… ç›´æ¥è§£ææ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                            }

                            // å¦‚æœè¿˜æ²¡æœ‰èŠ‚ç‚¹ï¼Œå°è¯•æœ€ç›´æ¥çš„è§£ææ–¹å¼
                            if (nodes.length === 0) {
                                // ç›´æ¥æŒ‰è¡Œåˆ†å‰²ï¼Œå°è¯•æŸ¥æ‰¾vlessé“¾æ¥
                                const lines = fileContent.split(/\r?\n/);
                                for (const line of lines) {
                                    if (line.includes('vless://')) {
                                        // æå–vlessé“¾æ¥
                                        const vlessMatch = line.match(/vless:\/\/[^\s]+/);
                                        if (vlessMatch) {
                                            nodes.push(vlessMatch[0]);
                                        }
                                    }
                                }
                                console.log(`âœ… ç›´æ¥æœç´¢vlessé“¾æ¥æ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);
                            }

                            data.remoteNodes = [...data.remoteNodes, ...nodes];
                            totalDownloaded += nodes.length;
                            successCount++;

                            // ä¿å­˜shaå€¼
                            if (fileInfo.file === mainNodeFile) {
                                data.nodeSha = fileJson.sha;
                            } else if (fileInfo.file === plainNodeFile) {
                                data.plainSha = fileJson.sha;
                            } else if (fileInfo.file === optimalNodeFile) {
                                data.optimalSha = fileJson.sha;
                            }
                        } else {
                            console.log(`âŒ ${fileInfo.file} æ–‡ä»¶ä¸‹è½½å¤±è´¥: ${fileRes.status}`);
                            if (fileRes.status === 404) {
                                showNotification('æ–‡ä»¶ä¸å­˜åœ¨', `æ–‡ä»¶ ${fileInfo.file} ä¸å­˜åœ¨äºä»“åº“ä¸­`, 'info');
                            } else {
                                const err = await fileRes.json();
                                console.log('é”™è¯¯è¯¦æƒ…:', err);
                            }
                        }
                    } catch (e) {
                        console.log(`âŒ ${fileInfo.file} æ–‡ä»¶ä¸‹è½½å¤±è´¥:`, e);
                    }
                }

                // å»é‡
                const seen = new Set();
                const uniqueNodes = [];
                data.remoteNodes.forEach(node => {
                    // æå–IPå’Œç«¯å£ä½œä¸ºå”¯ä¸€æ ‡è¯†
                    const match = node.match(/@([^:]+):(\d+)/);
                    const key = match ? `${match[1]}:${match[2]}` : node;
                    if (!seen.has(key)) {
                        seen.add(key);
                        uniqueNodes.push(node);
                    }
                });

                data.remoteNodes = uniqueNodes;
                data.stats.remote = data.remoteNodes.length;

                // æ›´æ–°ç¼“å­˜
                data.cache.remoteNodes = [...data.remoteNodes];
                data.cache.lastDownloadTime = Date.now();
                data.cache.downloadPath = targetFile;
                data.cache.needsUpdate = false;

                updateStats();

                if (data.remoteNodes.length === 0) {
                    showNotification('ä¸‹è½½å®Œæˆ', `ä» ${targetFile} è·å–åˆ° 0 ä¸ªèŠ‚ç‚¹ï¼Œæ–‡ä»¶å¯èƒ½ä¸ºç©ºã€ä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ”¯æŒ`, 'info');
                    addLog('ä¸‹è½½è¿œç¨‹', `ä» ${targetFile} è·å– 0 ä¸ªèŠ‚ç‚¹`, 'info');
                } else {
                    showNotification('ä¸‹è½½æˆåŠŸ', `æˆåŠŸä» ${targetFile} ä¸‹è½½ ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹ï¼Œå·²è‡ªåŠ¨å»é‡`, 'success');
                    addLog('ä¸‹è½½è¿œç¨‹', `ä» ${targetFile} è·å– ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹`, 'success');

                    // å¦‚æœæœ¬åœ°å·²æœ‰èŠ‚ç‚¹ï¼Œæç¤ºåˆå¹¶
                    if (data.vlessLinks.length > 0) {
                        setTimeout(() => {
                            showNotification('æç¤º', `æœ¬åœ°æœ‰ ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹ï¼Œè¿œç¨‹æœ‰ ${data.remoteNodes.length} ä¸ªèŠ‚ç‚¹ï¼Œç‚¹å‡»"åˆå¹¶èŠ‚ç‚¹"æŒ‰é’®è¿›è¡Œåˆå¹¶`, 'info');
                        }, 500);
                    }
                }
            } catch (e) {
                console.error('âŒ ä¸‹è½½å¤±è´¥:', e);
                showNotification('ä¸‹è½½å¤±è´¥', 'ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸‹è½½è¿œç¨‹', 'ä¸‹è½½å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        // æ–°å¢ï¼šæ£€æµ‹åˆ«åæ˜¯å¦æ˜¯æ ¼å¼åŒ–çš„åˆ«å
        function isFormattedAlias(remark) {
            if (!remark) return false;

            // æ ¼å¼1ï¼šåœ°åŒºå+åºå·+ç«¯å£ (å¦‚ï¼šæ—¥æœ¬01-443, é¦™æ¸¯02-8080)
            const pattern1 = /^[^\d]+\d{2,}-\d+$/;

            // æ ¼å¼2ï¼šåœ°åŒºå-åºå·-ç«¯å£ (å¦‚ï¼šæ—¥æœ¬-01-443)
            const pattern2 = /^[^-]+-\d{2,}-\d+$/;

            // æ ¼å¼3ï¼šåŒ…å«ä¸­æ–‡æˆ–è‹±æ–‡åç§°ï¼Œä¸æ˜¯IP:ç«¯å£æ ¼å¼
            const isIpPort = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d+$/.test(remark);

            return (pattern1.test(remark) || pattern2.test(remark)) && !isIpPort;
        }

        // æ–°å¢ï¼šæå–åˆ«åä¸­çš„åœ°åŒºå
        function extractRegionFromAlias(remark) {
            if (!remark) return null;

            // å°è¯•åŒ¹é…æ ¼å¼ï¼šåœ°åŒºå+åºå· æˆ– åœ°åŒºå-åºå·
            const match1 = remark.match(/^([^\d]+)\d{2,}/); // æ—¥æœ¬01-443
            if (match1) return match1[1].trim();

            const match2 = remark.match(/^([^-]+)-\d{2,}/); // æ—¥æœ¬-01-443
            if (match2) return match2[1].trim();

            return null;
        }

        function mergeAndShow() {
            const all = [...data.vlessLinks, ...data.remoteNodes];
            const seen = new Set();
            data.uniqueNodes = [];

            // æå–æ‰€æœ‰èŠ‚ç‚¹çš„IPã€ç«¯å£å’Œåˆ«åä¿¡æ¯
            const nodeInfos = all.map(node => {
                // ä½¿ç”¨æ›´å®½æ¾çš„æ­£åˆ™åŒ¹é…
                const ipPortMatch = node.match(/@([^:]+):(\d+)/);
                const remarkMatch = node.match(/#([^"]+)/);

                if (ipPortMatch) {
                    const ip = ipPortMatch[1];
                    const port = ipPortMatch[2];
                    const remark = remarkMatch ? decodeURIComponent(remarkMatch[1]) : `${ip}:${port}`;

                    return {
                        ip: ip,
                        port: port,
                        remark: remark,
                        full: node,
                        source: data.vlessLinks.includes(node) ? 'local' : 'remote'
                    };
                }
                return null;
            }).filter(info => info !== null);

            // å»é‡ï¼šåŸºäºIPå’Œç«¯å£
            const uniqueNodeMap = new Map();

            nodeInfos.forEach(info => {
                const key = `${info.ip}:${info.port}`;

                if (!uniqueNodeMap.has(key)) {
                    // ç¬¬ä¸€ä¸ªé‡åˆ°è¿™ä¸ªIP:ç«¯å£çš„èŠ‚ç‚¹ï¼Œç›´æ¥ä½¿ç”¨
                    uniqueNodeMap.set(key, info);
                } else {
                    // å¦‚æœå·²ç»å­˜åœ¨ï¼Œé€‰æ‹©æ›´å¥½çš„åˆ«åï¼ˆä¼˜å…ˆä¿ç•™æœ‰å…·ä½“åç§°çš„ï¼‰
                    const existing = uniqueNodeMap.get(key);
                    const existingHasName = existing.remark && !existing.remark.includes(':');
                    const newHasName = info.remark && !info.remark.includes(':');

                    // è§„åˆ™ï¼šä¼˜å…ˆä¿ç•™æœ‰å…·ä½“åç§°çš„åˆ«åï¼Œè€Œä¸æ˜¯IP:ç«¯å£æ ¼å¼
                    if (newHasName && !existingHasName) {
                        uniqueNodeMap.set(key, info);
                    }
                    // å¦‚æœéƒ½æœ‰åç§°æˆ–éƒ½æ²¡æœ‰åç§°ï¼Œä¼˜å…ˆä¿ç•™æœ¬åœ°èŠ‚ç‚¹çš„åˆ«å
                    else if (info.source === 'local' && existing.source === 'remote') {
                        uniqueNodeMap.set(key, info);
                    }
                }
            });

            // è½¬æ¢ä¸ºæ•°ç»„
            const uniqueInfos = Array.from(uniqueNodeMap.values());

            // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°è®¾ç½®åˆ«å
            const shouldRename = document.getElementById('renameOnMerge').checked;

            if (shouldRename && uniqueInfos.length > 0) {
                // æ™ºèƒ½é‡å‘½åï¼šåªé‡å‘½åé‚£äº›åˆ«åæ˜¯IP:ç«¯å£æ ¼å¼çš„èŠ‚ç‚¹
                const config = getConfig();
                const nodesToRename = [];
                const nodesToKeep = [];

                // åˆ†ç±»èŠ‚ç‚¹ï¼šå“ªäº›éœ€è¦é‡å‘½åï¼Œå“ªäº›ä¿ç•™
                uniqueInfos.forEach(info => {
                    // åˆ¤æ–­æ˜¯å¦æ˜¯IP:ç«¯å£æ ¼å¼
                    const isIpPortFormat = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d+$/.test(info.remark);

                    if (isIpPortFormat) {
                        // IP:ç«¯å£æ ¼å¼ï¼Œéœ€è¦é‡å‘½å
                        nodesToRename.push(info);
                    } else {
                        // å…¶ä»–æ ¼å¼çš„åˆ«åï¼ˆå¯èƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æˆ–å·²æ ¼å¼åŒ–çš„ï¼‰ï¼Œä¿ç•™
                        nodesToKeep.push(info);
                    }
                });

                // å¯¹éœ€è¦é‡å‘½åçš„èŠ‚ç‚¹æŒ‰åœ°åŒºåˆ†ç»„
                const regionGroups = {};
                nodesToRename.forEach(info => {
                    const regionName = getLocation(info.ip);
                    const finalRegion = regionName !== 'æœªçŸ¥' ? regionName : config.prefix;

                    if (!regionGroups[finalRegion]) {
                        regionGroups[finalRegion] = {
                            nodes: [],
                            counter: 1
                        };
                    }

                    regionGroups[finalRegion].nodes.push({
                        ip: info.ip,
                        port: info.port,
                        config: config,
                        sequence: regionGroups[finalRegion].counter++
                    });
                });

                // ç”Ÿæˆé‡å‘½ååçš„èŠ‚ç‚¹
                const renamedNodes = [];
                Object.keys(regionGroups).forEach(regionName => {
                    regionGroups[regionName].nodes.forEach(node => {
                        const sequence = node.sequence.toString().padStart(2, '0');
                        // åªæœ‰IPå’Œç«¯å£çš„æƒ…å†µï¼Œä½¿ç”¨æ ¼å¼ï¼šåœ°åŒºååºå·-ç«¯å£-IP
                        const remark = `${regionName}${sequence}-${node.port}-${node.ip}`;
                        renamedNodes.push(generateLink(node.ip, node.port, node.config, remark));
                    });
                });

                // ä¿ç•™ä¸éœ€è¦é‡å‘½åçš„èŠ‚ç‚¹
                const keptNodes = nodesToKeep.map(info => info.full);

                // åˆå¹¶æ‰€æœ‰èŠ‚ç‚¹
                data.uniqueNodes = [...renamedNodes, ...keptNodes];

                // æ˜¾ç¤ºé‡å‘½åç»Ÿè®¡
                if (renamedNodes.length > 0) {
                    showNotification('æ™ºèƒ½åˆå¹¶å®Œæˆ',
                        `å…± ${uniqueInfos.length} ä¸ªèŠ‚ç‚¹ï¼š${renamedNodes.length} ä¸ªIP:ç«¯å£æ ¼å¼çš„èŠ‚ç‚¹å·²é‡å‘½åï¼Œ${keptNodes.length} ä¸ªèŠ‚ç‚¹ä¿ç•™åŸæœ‰åˆ«å`,
                        'success');
                }

            } else {
                // ä¸é‡å‘½åï¼Œç›´æ¥ä½¿ç”¨åŸæœ‰åˆ«å
                data.uniqueNodes = uniqueInfos.map(info => info.full);
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            data.stats.merged = all.length;
            data.stats.unique = data.uniqueNodes.length;

            // å¦‚æœåˆå¹¶åèŠ‚ç‚¹æ•°é‡ä¸º0ï¼Œä½¿ç”¨æœ¬åœ°å’Œè¿œç¨‹èŠ‚ç‚¹æ•°é‡ä¸­è¾ƒå¤§çš„ä¸€ä¸ª
            if (data.stats.unique === 0) {
                data.stats.unique = Math.max(data.vlessLinks.length, data.remoteNodes.length);
            }

            updateStats();

            const plainText = data.uniqueNodes.join('\n');
            data.autoBase64Content = btoa(plainText);

            document.getElementById('autoBase64Output').textContent = data.autoBase64Content;
            document.getElementById('autoBase64Output').classList.toggle('empty', data.uniqueNodes.length === 0);
            document.getElementById('mergedResult').textContent = data.uniqueNodes.length ? data.uniqueNodes.join('\n\n') : 'æ— èŠ‚ç‚¹';

            // æ˜¾ç¤ºåˆå¹¶å®Œæˆé€šçŸ¥
            if (data.uniqueNodes.length > 0) {
                addLog('åˆå¹¶èŠ‚ç‚¹', `åˆå¹¶å®Œæˆï¼å…± ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`, 'success');
            } else {
                addLog('åˆå¹¶èŠ‚ç‚¹', 'åˆå¹¶å®Œæˆï¼Œä½†æœªç”Ÿæˆä»»ä½•èŠ‚ç‚¹', 'info');
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ æœ¬åœ°ç”ŸæˆBase64åˆ°æŒ‡å®šè·¯å¾„ - ä¿®æ­£æ–‡ä»¶æ ¼å¼é—®é¢˜
        async function uploadLocalBase64ToPath() {
            showLoading(true);
            try {
                if (data.vlessLinks.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆç”Ÿæˆæœ¬åœ°èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                // è·å–é€‰æ‹©çš„ä¸Šä¼ è·¯å¾„
                const pathSelect = document.getElementById('uploadPathSelect');
                const selectedOption = pathSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customUploadPath').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                // æ ¹æ®ç›®æ ‡è·¯å¾„å†³å®šä¸Šä¼ æ ¼å¼
                let contentToUpload = '';

                if (targetFile === 'PlainNode') {
                    // PlainNodeï¼šä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹
                    const plainText = data.vlessLinks.join('\n');
                    contentToUpload = btoa(plainText);
                } else if (targetFile === 'OptimalNode' || targetFile === 'MainNode') {
                    // OptimalNode å’Œ MainNodeï¼šä¸Šä¼ åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(data.vlessLinks.join('\n'));
                    contentToUpload = btoa(firstBase64);
                } else {
                    // å…¶ä»–è‡ªå®šä¹‰è·¯å¾„ï¼šä½¿ç”¨æœ¬åœ°ç”Ÿæˆçš„Base64å†…å®¹
                    contentToUpload = data.localBase64Content || btoa(data.vlessLinks.join('\n'));
                }

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    targetFile,
                    contentToUpload,
                    targetFile !== 'PlainNode',
                    `ä¸Šä¼ æœ¬åœ°è®¢é˜…åˆ° ${targetFile} - ${new Date().toLocaleString()} (${data.vlessLinks.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºæœ¬åœ°è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°æœ¬åœ°è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.vlessLinks.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ æœ¬åœ°è®¢é˜…', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ æœ¬åœ°è®¢é˜…', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ åˆå¹¶Base64åˆ°MainNode
        async function uploadMergedBase64() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // ä¿®å¤ï¼šåŒé‡Base64ç¼–ç ï¼ˆç¬¦åˆè®¢é˜…æ ¼å¼ï¼‰
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    mainNodeFile,
                    finalContent,
                    true,
                    `ä¸Šä¼ åˆå¹¶Base64è®¢é˜…åˆ° ${mainNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºBase64è®¢é˜…æ–‡ä»¶ ${mainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°Base64è®¢é˜…æ–‡ä»¶ ${mainNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶Base64', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶Base64', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¿®å¤ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°OptimalNode
        async function uploadMergedOptimal() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // åŒé‡Base64ç¼–ç ï¼ˆç¬¦åˆè®¢é˜…æ ¼å¼ï¼‰
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    optimalNodeFile,
                    finalContent,
                    true,
                    `ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…åˆ° ${optimalNodeFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºä¼˜é€‰è®¢é˜…æ–‡ä»¶ ${optimalNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°ä¼˜é€‰è®¢é˜…æ–‡ä»¶ ${optimalNodeFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶ä¼˜é€‰è®¢é˜…', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ–°å¢ï¼šä¸Šä¼ åˆå¹¶è®¢é˜…è‡³æŒ‡å®šè·¯å¾„
        async function uploadMergedToPath() {
            showLoading(true);
            try {
                if (data.uniqueNodes.length === 0) {
                    showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·å…ˆåˆå¹¶èŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„åˆå¹¶èŠ‚ç‚¹æ•°æ®', 'error');
                    showLoading(false);
                    return;
                }

                // è·å–é€‰æ‹©çš„ä¸Šä¼ è·¯å¾„
                const pathSelect = document.getElementById('uploadPathSelect');
                const selectedOption = pathSelect.value;
                let targetFile = '';

                if (selectedOption === 'custom') {
                    targetFile = document.getElementById('customUploadPath').value.trim();
                    if (!targetFile) {
                        showNotification('ä¸Šä¼ å¤±è´¥', 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ï¼Œæˆ–é€‰æ‹©é¢„å®šä¹‰è·¯å¾„', 'error');
                        showLoading(false);
                        return;
                    }
                } else {
                    targetFile = selectedOption;
                }

                const plainText = data.uniqueNodes.join('\n');
                let contentToUpload = '';

                // æ ¹æ®ç›®æ ‡è·¯å¾„å†³å®šä¸Šä¼ æ ¼å¼
                if (targetFile === 'PlainNode') {
                    // PlainNodeï¼šä¸Šä¼ æ˜æ–‡èŠ‚ç‚¹
                    contentToUpload = btoa(plainText);
                } else if (targetFile === 'OptimalNode' || targetFile === 'MainNode') {
                    // OptimalNode å’Œ MainNodeï¼šä¸Šä¼ åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(plainText);
                    contentToUpload = btoa(firstBase64);
                } else {
                    // å…¶ä»–è‡ªå®šä¹‰è·¯å¾„ï¼šä½¿ç”¨åŒé‡Base64ç¼–ç 
                    const firstBase64 = btoa(plainText);
                    contentToUpload = btoa(firstBase64);
                }

                // ä½¿ç”¨é€šç”¨ä¸Šä¼ å‡½æ•°
                const result = await uploadToGitHub(
                    targetFile,
                    contentToUpload,
                    targetFile !== 'PlainNode',
                    `ä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°æŒ‡å®šè·¯å¾„ ${targetFile} - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–°
                data.cache.needsUpdate = true;

                const message = result.isNew
                    ? `âœ… æ–°å»ºåˆå¹¶è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`
                    : `âœ… æ›´æ–°åˆå¹¶è®¢é˜…æ–‡ä»¶ ${targetFile} æˆåŠŸï¼åŒ…å« ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹`;

                showNotification('ä¸Šä¼ æˆåŠŸ', message, 'success');
                addLog('ä¸Šä¼ åˆå¹¶è‡³æŒ‡å®šè·¯å¾„', `${message} (SHA: ${result.sha.substring(0, 8)}...)`, 'success');
            } catch (e) {
                showNotification('ä¸Šä¼ å¤±è´¥', 'ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸Šä¼ åˆå¹¶è‡³æŒ‡å®šè·¯å¾„', 'ä¸Šä¼ å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        //ä¸€é”®åŒæ­¥(è¿œç«¯æ˜æ–‡å’Œæœ¬åœ°æ˜æ–‡)å’Œ(è¿œç«¯Base64å’Œæœ¬åœ°Base64)æ–¹æ³•
        async function oneClickSync() {
            showLoading(true);
            try {
                // 1. è§£ææœ¬åœ°èŠ‚ç‚¹
                if (data.vlessLinks.length === 0) {
                    await generateVless();
                    if (data.vlessLinks.length === 0) throw new Error('æ— æœ¬åœ°èŠ‚ç‚¹å¯åŒæ­¥');
                }

                // 2. ä»GitHubä¸‹è½½è¿œç¨‹èŠ‚ç‚¹
                await downloadRemote();

                // 3. åˆå¹¶å»é‡
                mergeAndShow();

                // 4. ä¿å­˜ä»¤ç‰Œ
                const token = document.getElementById('githubToken').value.trim();
                if (!token) throw new Error('ç¼ºå°‘GitHub Token');
                if (document.getElementById('saveToken').checked) localStorage.setItem('github_token', token);

                // 5. è·å–é…ç½®
                const mainNodeFile = document.getElementById('mainNodeFile').value.trim();
                const plainNodeFile = document.getElementById('plainNodeFile').value.trim();
                const optimalNodeFile = document.getElementById('optimalNodeFile').value.trim();
                const plainText = data.uniqueNodes.join('\n');

                // åŒé‡Base64ç¼–ç 
                const firstBase64 = btoa(plainText);
                const finalContent = btoa(firstBase64);

                // 6. ä¸Šä¼ Base64è®¢é˜…æ–‡ä»¶ï¼ˆMainNodeï¼‰- åŒé‡Base64ç¼–ç 
                const mainResult = await uploadToGitHub(
                    mainNodeFile,
                    finalContent,
                    true,
                    `ä¸€é”®åŒæ­¥æ›´æ–°MainNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                );

                console.log('âœ… MainNode ä¸Šä¼ æˆåŠŸ');

                // 7. ä¸Šä¼ æ˜æ–‡æ–‡ä»¶ï¼ˆPlainNodeï¼‰
                try {
                    await uploadToGitHub(
                        plainNodeFile,
                        btoa(plainText),
                        false,
                        `ä¸€é”®åŒæ­¥æ˜æ–‡èŠ‚ç‚¹åˆ°PlainNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                    );
                    console.log('âœ… PlainNode ä¸Šä¼ æˆåŠŸ');
                } catch (e) {
                    console.warn('âš ï¸ PlainNode ä¸Šä¼ å¤±è´¥ï¼Œä½†MainNodeå·²æˆåŠŸä¸Šä¼ :', e);
                    // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                }

                // 8. ä¸Šä¼ åˆå¹¶è®¢é˜…åˆ°OptimalNode
                try {
                    await uploadToGitHub(
                        optimalNodeFile,
                        finalContent,
                        true,
                        `ä¸€é”®åŒæ­¥åˆå¹¶è®¢é˜…åˆ°OptimalNode - ${new Date().toLocaleString()} (${data.uniqueNodes.length}èŠ‚ç‚¹)`
                    );
                    console.log('âœ… OptimalNode ä¸Šä¼ æˆåŠŸ');
                } catch (e) {
                    console.warn('âš ï¸ OptimalNode ä¸Šä¼ å¤±è´¥ï¼Œä½†å…¶ä»–æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ :', e);
                    // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                }

                // 9. æ¸…é™¤ç¼“å­˜æ›´æ–°æ ‡è®°
                data.cache.needsUpdate = false;

                showNotification('ä¸€é”®åŒæ­¥æˆåŠŸ', `æˆåŠŸåŒæ­¥ ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹åˆ°GitHubä¸‰ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ“ä½œå·²å®Œæˆï¼`, 'success');
                addLog('ä¸€é”®åŒæ­¥', `æˆåŠŸåŒæ­¥ ${data.uniqueNodes.length} ä¸ªèŠ‚ç‚¹åˆ°GitHubä¸‰ä¸ªæ–‡ä»¶`, 'success');
            } catch (e) {
                showNotification('ä¸€é”®åŒæ­¥å¤±è´¥', 'åŒæ­¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                addLog('ä¸€é”®åŒæ­¥', 'åŒæ­¥å¤±è´¥: ' + e.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ–°å¢ï¼šå…¨å±€é€šçŸ¥å‡½æ•°
        function showNotification(title, message, type = 'info') {
            const notificationId = 'notification-' + Date.now();
            const notificationContainer = document.getElementById('notificationContainer');

            // é™åˆ¶é€šçŸ¥æ•°é‡
            if (notifications.active.length >= notifications.maxNotifications) {
                const oldestNotification = document.getElementById(notifications.active[0]);
                if (oldestNotification) {
                    oldestNotification.remove();
                    notifications.active.shift();
                }
            }

            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification ${type}`;

            const time = new Date().toLocaleTimeString();

            notification.innerHTML = `
            <div class="notification-header">
                <div class="notification-title">${title}</div>
                <div class="notification-time">${time}</div>
                <button class="notification-close" onclick="closeNotification('${notificationId}')">&times;</button>
            </div>
            <div class="notification-message">${message}</div>
        `;

            notificationContainer.appendChild(notification);
            notifications.active.push(notificationId);

            // è‡ªåŠ¨å…³é—­é€šçŸ¥ï¼ˆé”™è¯¯é€šçŸ¥ä¸è‡ªåŠ¨å…³é—­ï¼‰
            if (type !== 'error') {
                let timeoutDuration = 6000; // é»˜è®¤6ç§’

                // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒæ—¶é—´
                if (type === 'success') {
                    timeoutDuration = 3000; // æˆåŠŸé€šçŸ¥æ˜¾ç¤º3ç§’
                } else if (type === 'info') {
                    timeoutDuration = 4000; // ä¿¡æ¯é€šçŸ¥æ˜¾ç¤º4ç§’
                } else if (type === 'warning') {
                    timeoutDuration = 8000; // è­¦å‘Šé€šçŸ¥æ˜¾ç¤º8ç§’
                }

                setTimeout(() => {
                    closeNotification(notificationId);
                }, timeoutDuration);
            } else {
                setTimeout(() => {
                    closeNotification(notificationId);
                }, 15000); // é”™è¯¯é€šçŸ¥æ˜¾ç¤º15ç§’
            }
        }

        // æ–°å¢ï¼šå…³é—­é€šçŸ¥å‡½æ•°
        function closeNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    notification.remove();
                    const index = notifications.active.indexOf(id);
                    if (index > -1) {
                        notifications.active.splice(index, 1);
                    }
                }, 300);
            }
        }

        // æ–°å¢ï¼šæ·»åŠ æ—¥å¿—å‡½æ•°
        function addLog(action, message, level = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = {
                time,
                action,
                message,
                level,
                timestamp: Date.now()
            };

            logData.entries.unshift(logEntry);

            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            if (logData.entries.length > logData.maxEntries) {
                logData.entries.pop();
            }

            updateLogDisplay();
        }

        // æ–°å¢ï¼šæ›´æ–°æ—¥å¿—æ˜¾ç¤º
        function updateLogDisplay() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = '';

            logData.entries.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';

                const levelClass = {
                    'info': 'info',
                    'success': 'success',
                    'error': 'error'
                }[entry.level] || 'info';

                logEntry.innerHTML = `
                <span class="log-time">[${entry.time}]</span>
                <span class="log-level ${levelClass}">${levelClass}</span>
                <span class="log-message">${entry.action}: ${entry.message}</span>
            `;

                logContent.appendChild(logEntry);
            });

            // è‡ªåŠ¨æ˜¾ç¤ºæ—¥å¿—åŒºåŸŸ
            const logSection = document.getElementById('logSection');
            if (logData.entries.length > 1) { // ä¸æ­¢æœ‰å¯åŠ¨æ—¥å¿—
                logSection.classList.add('show');
            }
        }

        // æ–°å¢ï¼šæ¸…ç©ºæ—¥å¿—
        function clearLog() {
            logData.entries = [];
            updateLogDisplay();
            showNotification('æ—¥å¿—å·²æ¸…ç©º', 'æ‰€æœ‰æ“ä½œæ—¥å¿—è®°å½•å·²è¢«æ¸…é™¤', 'info');
            addLog('ç³»ç»Ÿ', 'æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // æ–°å¢ï¼šåˆ‡æ¢æ—¥å¿—æ˜¾ç¤º
        function toggleLog() {
            const logSection = document.getElementById('logSection');
            const toggleBtn = document.getElementById('toggleLogBtn');

            if (logSection.classList.contains('show')) {
                logSection.classList.remove('show');
                toggleBtn.innerHTML = '<span>ğŸ“‹</span> æ”¶èµ·æ—¥å¿—';
            } else {
                logSection.classList.add('show');
                toggleBtn.innerHTML = '<span>ğŸ“‹</span> å±•å¼€æ—¥å¿—';
            }
        }

        function loadSavedToken() {
            const token = localStorage.getItem('github_token');
            if (token) {
                document.getElementById('githubToken').value = token;
                console.log('âœ… ä»æœ¬åœ°å­˜å‚¨åŠ è½½GitHubä»¤ç‰Œ');
            }
        }

        function updateStats() {
            const s = data.stats;
            const el = document.getElementById('githubStats');
            el.style.display = s.local + s.remote > 0 ? 'flex' : 'none';
            document.getElementById('localNodes').textContent = s.local;
            document.getElementById('remoteNodes').textContent = s.remote;
            document.getElementById('mergedNodes').textContent = s.merged;
            document.getElementById('uniqueNodes').textContent = s.unique;
            document.getElementById('syncNodeCount').textContent = `${s.unique}èŠ‚ç‚¹`;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function copyText(text) {
            if (!text) {
                showNotification('å¤åˆ¶å¤±è´¥', 'æ— å†…å®¹å¯å¤åˆ¶ï¼Œè¯·å…ˆç”Ÿæˆæˆ–è·å–èŠ‚ç‚¹æ•°æ®', 'error');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showNotification('å¤åˆ¶æˆåŠŸ', 'å†…å®¹å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ°å…¶ä»–åº”ç”¨äº†', 'success');
                addLog('å¤åˆ¶æ“ä½œ', 'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                showNotification('å¤åˆ¶å¤±è´¥', 'æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿: ' + err.message, 'error');
                addLog('å¤åˆ¶æ“ä½œ', 'å¤åˆ¶å¤±è´¥: ' + err.message, 'error');
            });
        }

        // ç§»é™¤downloadVlesså‡½æ•°ï¼Œåªä¿ç•™downloadAllå‡½æ•°
        function downloadAll() {
            if (!data.vlessLinks.length) {
                showNotification('ä¸‹è½½å¤±è´¥', 'è¯·å…ˆç”ŸæˆèŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®', 'error');
                return;
            }
            const t = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            downloadBlob(data.vlessLinks.join('\n'), `vless_${t}.txt`);
            downloadBlob(data.localBase64Content || btoa(data.vlessLinks.join('\n')), `subscription_${t}.txt`);
            showNotification('ä¸‹è½½æˆåŠŸ', 'å·²ä¸‹è½½Vlessé“¾æ¥å’Œè®¢é˜…æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œè¯·æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶å¤¹', 'success');
            addLog('ä¸‹è½½', 'å·²ä¸‹è½½Vlessé“¾æ¥å’Œè®¢é˜…æ–‡ä»¶åˆ°æœ¬åœ°', 'success');
        }

        function downloadBlob(content, name) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);
        }

        function readFile(file) {
            return new Promise((res, rej) => {
                const r = new FileReader();
                r.onload = e => res(e.target.result);
                r.onerror = rej;
                r.readAsText(file);
            });
        }

        function formatSize(b) {
            const units = ['B', 'KB', 'MB', 'GB'];
            let i = 0;
            while (b >= 1024 && i < units.length - 1) { b /= 1024; i++; }
            return b.toFixed(1) + ' ' + units[i];
        }

        function isValidIP(ip) {
            if (!ip || typeof ip !== 'string') return false;

            const parts = ip.split('.');
            if (parts.length !== 4) return false;

            for (let i = 0; i < 4; i++) {
                const part = parseInt(parts[i], 10);
                if (isNaN(part) || part < 0 || part > 255) return false;
                // æ£€æŸ¥å‰å¯¼é›¶ï¼ˆé™¤äº†0æœ¬èº«ï¼‰
                if (parts[i].length > 1 && parts[i][0] === '0') return false;
            }

            return true;
        }


        function copyGitToken() {
            const token = "ghp_q914mARHjefJJ8XDKoNFauxzubjcjV0nlLt";
            const input = document.createElement('input');
            input.value = token;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            showNotification('å¤åˆ¶æˆåŠŸ', 'ç¤ºä¾‹ä»¤ç‰Œå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }
        // ä¿®å¤ï¼šgetLocationå‡½æ•°è¿”å›ä¸­æ–‡åœ°åŒºå
        function getLocation(ip) {
            // 1. åŸºç¡€éªŒè¯
            if (!ip || typeof ip !== 'string') return 'æœªçŸ¥';

            const parts = ip.split('.');
            if (parts.length !== 4) return 'æœªçŸ¥';

            // éªŒè¯æ¯ä¸ªéƒ¨åˆ†
            for (let i = 0; i < 4; i++) {
                const part = parseInt(parts[i], 10);
                if (isNaN(part) || part < 0 || part > 255) return 'æœªçŸ¥';
            }

            const p1 = parseInt(parts[0], 10);
            const p2 = parseInt(parts[1], 10);

            // 2. ç§æœ‰åœ°å€åˆ¤æ–­
            if (p1 === 10) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 172 && p2 >= 16 && p2 <= 31) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 192 && p2 === 168) return 'å†…éƒ¨ç½‘ç»œ';
            if (p1 === 169 && p2 === 254) return 'å†…éƒ¨ç½‘ç»œ';

            // 3. ç‰¹æ®ŠIPå¤„ç†
            if (ip === '1.1.1.1' || ip === '1.0.0.1') return 'ç¾å›½';  // CloudFlare
            if (ip === '8.8.8.8' || ip === '8.8.4.4') return 'ç¾å›½';  // Google DNS
            if (ip === '9.9.9.9' || ip === '149.112.112.112') return 'ç¾å›½';  // Quad9

            // 4. ç‰¹æ®Šç½‘æ®µå¤„ç†
            if (ip.startsWith('203.119.')) return 'è¶Šå—';
            if (ip.startsWith('202.44.')) return 'æ³°å›½';
            if (ip.startsWith('202.55.')) return 'æ–°åŠ å¡';
            if (ip.startsWith('165.246.')) return 'éŸ©å›½';
            if (ip.startsWith('202.12.')) return 'æ—¥æœ¬';


            // 5. 61.x.x.xç³»åˆ—ï¼ˆäºšæ´²ï¼‰
            if (p1 === 61) {
                // æ—¥æœ¬
                if ((p2 >= 112 && p2 <= 127) || p2 === 231) return 'æ—¥æœ¬';
                // éŸ©å›½
                if ((p2 >= 128 && p2 <= 143) || p2 === 233) return 'éŸ©å›½';
                // é¦™æ¸¯
                if ((p2 >= 144 && p2 <= 159) || p2 === 235) return 'é¦™æ¸¯';
                // æ–°åŠ å¡
                if (p2 === 234) return 'æ–°åŠ å¡';
                // å°æ¹¾
                if ((p2 >= 32 && p2 <= 63) || p2 === 236) return 'å°æ¹¾';
                // é©¬æ¥è¥¿äºš
                if (p2 === 238 || p2 === 239) return 'é©¬æ¥è¥¿äºš';
                // å°åº¦å°¼è¥¿äºš
                if (p2 === 240 || p2 === 241) return 'å°åº¦å°¼è¥¿äºš';
                // æ³°å›½
                if (p2 === 242 || p2 === 243) return 'æ³°å›½';
                // è²å¾‹å®¾
                if (p2 === 244 || p2 === 245) return 'è²å¾‹å®¾';
                // è¶Šå—
                if (p2 === 246 || p2 === 247) return 'è¶Šå—';
                // ä¸­å›½
                return 'ä¸­å›½';
            }

            // 6. æ ¸å¿ƒå›½å®¶åˆ¤æ–­
            // ä¸­å›½
            if (
                (p1 >= 114 && p1 <= 126) ||
                p1 === 180 || p1 === 182 || p1 === 183 ||
                (p1 >= 202 && p1 <= 203) || (p1 >= 210 && p1 <= 223)
            ) return 'ä¸­å›½';

            // ç¾å›½
            if (
                p1 === 8 || p1 === 13 || p1 === 23 || p1 === 34 || p1 === 35 ||
                p1 === 40 || p1 === 45 || p1 === 50 || p1 === 52 || p1 === 54 ||
                p1 === 63 || p1 === 64 || p1 === 65 || p1 === 66 || p1 === 67 ||
                p1 === 68 || p1 === 69 || p1 === 70 || p1 === 71 || p1 === 72 ||
                p1 === 73 || p1 === 74 || p1 === 75 || p1 === 76 || p1 === 96 ||
                p1 === 97 || p1 === 98 || p1 === 99 || p1 === 104 || p1 === 107 ||
                p1 === 108 || p1 === 131 || p1 === 132 || p1 === 134 || p1 === 136 ||
                p1 === 140 || p1 === 142 || p1 === 146 || p1 === 147 || p1 === 148 ||
                p1 === 149 || p1 === 150 || p1 === 152 || p1 === 155 || p1 === 156 ||
                p1 === 157 || p1 === 158 || p1 === 159 || p1 === 160 || p1 === 161 ||
                p1 === 162 || p1 === 164 || p1 === 165 || p1 === 166 || p1 === 167 ||
                p1 === 168 || p1 === 169 || p1 === 170 || p1 === 172 || p1 === 173 ||
                p1 === 174 || p1 === 184 || p1 === 192 || p1 === 198 || p1 === 199 ||
                p1 === 204 || p1 === 205 || p1 === 206 || p1 === 207 || p1 === 208 ||
                p1 === 209 || p1 === 216
            ) return 'ç¾å›½';

            // æ—¥æœ¬
            if (p1 === 133 || p1 === 157 || p1 === 202 || p1 === 210) return 'æ—¥æœ¬';

            // éŸ©å›½
            if (p1 === 175 || (p1 === 211 && p2 >= 32 && p2 <= 63)) return 'éŸ©å›½';

            // æ–°åŠ å¡
            if (p1 === 128 || p1 === 165 || (p1 === 203 && p2 >= 112 && p2 <= 127)) return 'æ–°åŠ å¡';

            // é¦™æ¸¯
            if (p1 === 203 || (p1 === 43 && p2 >= 129 && p2 <= 136)) return 'é¦™æ¸¯';

            // å°æ¹¾
            if ((p1 === 60 && p2 >= 192 && p2 <= 207) || (p1 === 211 && p2 >= 72 && p2 <= 79)) return 'å°æ¹¾';

            // æ¾³å¤§åˆ©äºš
            if (
                (p1 >= 1 && p1 <= 14) || (p1 >= 27 && p1 <= 43) ||
                (p1 >= 49 && p1 <= 60) || (p1 >= 101 && p1 <= 126) ||
                (p1 >= 139 && p1 <= 144) || p1 === 153 || p1 === 171 ||
                p1 === 175 || p1 === 180 || p1 === 182 || p1 === 183 ||
                p1 === 202 || p1 === 203
            ) return 'æ¾³å¤§åˆ©äºš';

            // 7. å…¶ä»–ä¸»è¦åœ°åŒº
            // æ¬§æ´²
            if ((p1 >= 77 && p1 <= 95) || (p1 >= 109 && p1 <= 126) ||
                (p1 >= 176 && p1 <= 191) || (p1 >= 193 && p1 <= 199)) {
                // è¿›ä¸€æ­¥ç»†åˆ†æ¬§æ´²å›½å®¶
                if (p1 === 77 || p1 === 78 || p1 === 79 || p1 === 80) return 'å¾·å›½';
                if (p1 === 81 || p1 === 82 || p1 === 83) return 'æ³•å›½';
                if (p1 === 84 || p1 === 85 || p1 === 86) return 'è‹±å›½';
                if (p1 === 87 || p1 === 88 || p1 === 89) return 'è·å…°';
                if (p1 === 90 || p1 === 91 || p1 === 92) return 'æ„å¤§åˆ©';
                return 'æ¬§æ´²';
            }
            // Cloudflareæ‰˜ç®¡IPä¼˜åŒ–æ˜ å°„ï¼ˆæ‚¨çš„æ ¸å¿ƒéœ€æ±‚ï¼‰
            if (ip.startsWith('23.227.')) return 'åŠ æ‹¿å¤§';      // Shopify
            if (ip.startsWith('45.60.')) return 'ç¾å›½';        // Cloudflareåˆä½œä¼™ä¼´
            if (ip.startsWith('76.76.')) return 'ç¾å›½';        // Vercel
            if (ip.startsWith('134.209.')) return 'ç¾å›½';      // DigitalOcean
            if (ip.startsWith('157.230.')) return 'å¾·å›½';      // DigitalOceanå¾·å›½
            if (ip.startsWith('159.89.')) return 'æ–°åŠ å¡';     // DigitalOceanæ–°åŠ å¡

            // 8. åŸºäºIPé¦–å­—èŠ‚çš„ç²—ç•¥åˆ¤æ–­
            if (p1 >= 1 && p1 <= 126) {
                if (p1 === 24 || p1 === 99 || p1 === 142) return 'åŠ æ‹¿å¤§';
                return 'åŒ—ç¾';
            }
            if (p1 >= 128 && p1 <= 191) {
                if (p1 === 128 || p1 === 129) return 'æ¾³å¤§åˆ©äºš';
                if (p1 === 150 || p1 === 151) return 'æ–°è¥¿å…°';
                return 'æ¬§æ´²';
            }
            if (p1 >= 192 && p1 <= 223) return 'äºšæ´²';

            return 'æœªçŸ¥';
        }
    </script>
</body>

</html>